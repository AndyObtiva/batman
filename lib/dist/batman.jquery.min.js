(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V=Array.prototype.slice,W=Object.prototype.hasOwnProperty,X=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1},Y=function(a,b){function d(){this.constructor=a}for(var c in b)W.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},Z=function(a,b){return function(){return a.apply(b,arguments)}};x=function(){var a;a=1<=arguments.length?V.call(arguments,0):[];return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(x.Object,a,function(){})},x.typeOf=t=function(a){if(typeof a=="undefined")return"Undefined";return S.call(a).slice(8,-1)},S=Object.prototype.toString,x.mixin=k=function(){var a,b,c,d,e,f,g,h;e=arguments[0],d=2<=arguments.length?V.call(arguments,1):[],a=typeof e.set=="function";for(g=0,h=d.length;g<h;g++){c=d[g];if(t(c)!=="Object")continue;for(b in c){if(!W.call(c,b))continue;f=c[b];if(b==="initialize"||b==="uninitialize"||b==="prototype")continue;a?e.set(b,f):e.nodeName!=null?x.data(e,b,f):e[b]=f}typeof c.initialize=="function"&&c.initialize.call(e)}return e},x.unmixin=w=function(){var a,b,c,d,e,f;a=arguments[0],d=2<=arguments.length?V.call(arguments,1):[];for(e=0,f=d.length;e<f;e++){c=d[e];for(b in c){if(b==="initialize"||b==="uninitialize")continue;delete a[b]}typeof c.uninitialize=="function"&&c.uninitialize.call(a)}return a},x._block=c=function(a,b){var c,d;b!=null?c=a:b=a;return d=function(){var a,d,e;a=1<=arguments.length?V.call(arguments,0):[],d=this,e=function(c){a.push(c);return b.apply(d,a)};return typeof a[a.length-1]=="function"||c&&a.length>=c?e(a.pop()):e}},x._findName=f=function(a,b){var c,d;if(!a.displayName)for(c in b){d=b[c];if(d===a){a.displayName=c;break}}return a.displayName},x._functionName=g=function(a){var b;if(a.__name__)return a.__name__;if(a.name)return a.name;return(b=a.toString().match(/\W*function\s+([\w\$]+)\(/))!=null?b[1]:void 0},x._preventDefault=m=function(a){return typeof a.preventDefault=="function"?a.preventDefault():a.returnValue=!1},x._isChildOf=j=function(a,b){var c;c=b.parentNode;while(c){if(c===a)return!0;c=c.parentNode}return!1},Q=function(){var a,b,c,d,e,f,g,h,i;c=function(){var a,b;if(!E.postMessage)return!1;a=!0,b=E.onmessage,E.onmessage=function(){return a=!1},E.postMessage("","*"),E.onmessage=b;return a},i=new x.SimpleHash,d=0,f=function(){return"go"+ ++d},E.setImmediate?(b=E.setImmediate,a=E.clearImmediate):E.msSetImmediate?(b=msSetImmediate,a=msClearImmediate):c()?(h="com.batman.",e=new x.SimpleHash,g=function(a){var b,c;if(!!~a.data.search(h)){b=a.data.substring(h.length);return typeof (c=i.unset(b))=="function"?c():void 0}},E.addEventListener?E.addEventListener("message",g,!1):E.attachEvent("onmessage",g),b=function(a){var b;i.set(b=f(),a),E.postMessage(h+b,"*");return b},a=function(a){return i.unset(a)}):typeof document!="undefined"&&X.call(document.createElement("script"),"onreadystatechange")>=0?(b=function(a){var b,c;b=f(),c=document.createElement("script"),c.onreadystatechange=function(){var a;typeof (a=i.get(b))=="function"&&a(),c.onreadystatechange=null,c.parentNode.removeChild(c);return c=null},document.documentElement.appendChild(c);return b},a=function(a){return i.unset(a)}):(b=function(a){return setTimeout(a,0)},a=function(a){return clearTimeout(a)}),x.setImmediate=b;return x.clearImmediate=a},x.setImmediate=q=function(){Q();return x.setImmediate.apply(this,arguments)},x.clearImmediate=d=function(){Q();return x.clearImmediate.apply(this,arguments)},x.translate=function(a,b){b==null&&(b={});return H.interpolate(h(x.translate.messages,a),b)},x.translate.messages={},L=function(){return x.translate.apply(x,arguments)},C=/(?:^|_|\-)(.)/g,D=/(^|\s)([a-z])/g,M=/([A-Z]+)([A-Z][a-z])/g,N=/([a-z\d])([A-Z])/g,H=x.helpers={camelize:function(a,b){a=a.replace(C,function(a,b){return b.toUpperCase()});return b?a.substr(0,1).toLowerCase()+a.substr(1):a},underscore:function(a){return a.replace(M,"$1_$2").replace(N,"$1_$2").replace("-","_").toLowerCase()},singularize:function(a){var b;b=a.length;return a.substr(b-3)==="ies"?a.substr(0,b-3)+"y":a.substr(b-1)==="s"?a.substr(0,b-1):a},pluralize:function(a,b){var c,d;if(b){if(a===1)return b}else b=a;d=b.length,c=b.substr(d-1);return c==="y"?""+b.substr(0,d-1)+"ies":c==="s"?b:""+b+"s"},capitalize:function(a){return a.replace(D,function(a,b,c){return b+c.toUpperCase()})},trim:function(a){return a?a.trim():""},interpolate:function(a,b){var c,d,e;typeof a=="object"?(d=a[b.count],d||(d=a.other)):d=a;for(c in b)e=b[c],d=d.replace(new RegExp("%\\{"+c+"\\}","g"),e);return d}},x.Event=function(){function a(a,b){this.base=a,this.key=b,this.handlers=new x.SimpleSet,this._preventCount=0}a.forBaseAndKey=function(a,b){return a.isEventEmitter?a.event(b):new x.Event(a,b)},a.prototype.isEvent=!0,a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key},a.prototype.hashKey=function(){var a;this.hashKey=function(){return a};return a="<Batman.Event base: "+x.Hash.prototype.hashKeyFor(this.base)+', key: "'+x.Hash.prototype.hashKeyFor(this.key)+'">'},a.prototype.addHandler=function(a){this.handlers.add(a),this.oneShot&&this.autofireHandler(a);return this},a.prototype.removeHandler=function(a){this.handlers.remove(a);return this},a.prototype.eachHandler=function(a){var b,c;this.handlers.forEach(a);if((c=this.base)!=null?c.isEventEmitter:void 0){b=this.key;return this.base._batman.ancestors(function(c){var d;if(c.isEventEmitter&&c.hasEvent(b)){d=c.event(b).handlers;return d.forEach(a)}})}},a.prototype.handlerContext=function(){return this.base},a.prototype.prevent=function(){return++this._preventCount},a.prototype.allow=function(){this._preventCount&&--this._preventCount;return this._preventCount},a.prototype.isPrevented=function(){return this._preventCount>0},a.prototype.autofireHandler=function(a){if(this._oneShotFired&&this._oneShotArgs!=null)return a.apply(this.handlerContext(),this._oneShotArgs)},a.prototype.resetOneShot=function(){this._oneShotFired=!1;return this._oneShotArgs=null},a.prototype.fire=function(){var a,b;if(this.isPrevented()||this._oneShotFired)return!1;b=this.handlerContext(),a=arguments,this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=arguments);return this.eachHandler(function(c){return c.apply(b,a)})};return a}(),x.EventEmitter={isEventEmitter:!0,hasEvent:function(a){var b,c;return(b=this._batman)!=null?typeof b.get=="function"?(c=b.get("events"))!=null?c.hasKey(a):void 0:void 0:void 0},event:function(a){var b,c,d,e,f,g,h;x.initializeObject(this),b=this.eventClass||x.Event,c=(g=this._batman).events||(g.events=new x.SimpleHash);if(c.hasKey(a))return d=c.get(a);e=this._batman.get("events"),f=c.set(a,new b(this,a)),f.oneShot=e!=null?(h=e.get(a))!=null?h.oneShot:void 0:void 0;return f},on:function(a,b){return this.event(a).addHandler(b)},registerAsMutableSource:function(){return x.Property.registerSource(this)},mutation:function(a){return function(){var b;b=a.apply(this,arguments),this.event("change").fire(this,this);return b}},prevent:function(a){this.event(a).prevent();return this},allow:function(a){this.event(a).allow();return this},isPrevented:function(a){return this.event(a).isPrevented()},fire:function(){var a,b,c;b=arguments[0],a=2<=arguments.length?V.call(arguments,1):[];return(c=this.event(b)).fire.apply(c,a)}},x.PropertyEvent=function(){function a(){a.__super__.constructor.apply(this,arguments)}Y(a,x.Event),a.prototype.eachHandler=function(a){return this.base.eachObserver(a)},a.prototype.handlerContext=function(){return this.base.base};return a}(),x.Property=function(){function a(a,b){this.base=a,this.key=b}k(a.prototype,x.EventEmitter),a._sourceTrackerStack=[],a.sourceTracker=function(){var a;return(a=this._sourceTrackerStack)[a.length-1]},a.defaultAccessor={get:function(a){return this[a]},set:function(a,b){return this[a]=b},unset:function(a){var b;b=this[a],delete this[a];return b}},a.forBaseAndKey=function(a,b){return a.isObservable?a.property(b):new x.Keypath(a,b)},a.registerSource=function(a){var b;if(!!a.isEventEmitter)return(b=this.sourceTracker())!=null?b.add(a):void 0},a.prototype._isolationCount=0,a.prototype.cached=!1,a.prototype.value=null,a.prototype.sources=null,a.prototype.isProperty=!0,a.prototype.eventClass=x.PropertyEvent,a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key},a.prototype.hashKey=function(){var a;this.hashKey=function(){return a};return a="<Batman.Property base: "+x.Hash.prototype.hashKeyFor(this.base)+', key: "'+x.Hash.prototype.hashKeyFor(this.key)+'">'},a.prototype.changeEvent=function(){var a;a=this.event("change"),this.changeEvent=function(){return a};return a},a.prototype.accessor=function(){var a,b,c,d,e;b=(d=this.base._batman)!=null?d.get("keyAccessors"):void 0,a=b&&(c=b.get(this.key))?c:((e=this.base._batman)!=null?e.getFirst("defaultAccessor"):void 0)||x.Property.defaultAccessor,this.accessor=function(){return a};return a},a.prototype.eachObserver=function(a){var b;b=this.key,this.changeEvent().handlers.forEach(a);if(this.base.isObservable)return this.base._batman.ancestors(function(c){var d,e;if(c.isObservable&&c.hasProperty(b)){e=c.property(b),d=e.event("change").handlers;return d.forEach(a)}})},a.prototype.pushSourceTracker=function(){return x.Property._sourceTrackerStack.push(new x.SimpleSet)},a.prototype.pushDummySourceTracker=function(){return x.Property._sourceTrackerStack.push(null)},a.prototype.popSourceTracker=function(){return x.Property._sourceTrackerStack.pop()},a.prototype.updateSourcesFromTracker=function(){var a,b;b=this.popSourceTracker(),a=this.sourceChangeHandler(),this._eachSourceChangeEvent(function(b){return b.removeHandler(a)}),this.sources=b;return this._eachSourceChangeEvent(function(b){return b.addHandler(a)})},a.prototype._eachSourceChangeEvent=function(a){if(this.sources!=null)return this.sources.forEach(function(b){return a(b.event("change"))})},a.prototype.getValue=function(){this.registerAsMutableSource(),this.cached||(this.pushSourceTracker(),this.value=this.valueFromAccessor(),this.cached=!0,this.updateSourcesFromTracker());return this.value},a.prototype.refresh=function(){var a,b;this.cached=!1,a=this.value,b=this.getValue();if(b!==a&&!this.isIsolated())return this.fire(b,a)},a.prototype.sourceChangeHandler=function(){var a;a=Z(function(){return this._handleSourceChange()},this),this.sourceChangeHandler=function(){return a};return a},a.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:this.changeEvent().handlers.isEmpty()?this.cached=!1:this.refresh()},a.prototype.valueFromAccessor=function(){var a;return(a=this.accessor().get)!=null?a.call(this.base,this.key):void 0},a.prototype.setValue=function(a){var b,c;this.pushDummySourceTracker(),this.cached=!1,b=(c=this.accessor().set)!=null?c.call(this.base,this.key,a):void 0,this.refresh(),this.popSourceTracker();return b},a.prototype.unsetValue=function(){var a,b;this.pushDummySourceTracker(),a=(b=this.accessor().unset)!=null?b.call(this.base,this.key):void 0,this.refresh(),this.popSourceTracker();return a},a.prototype.forget=function(a){return a!=null?this.changeEvent().removeHandler(a):this.changeEvent().handlers.clear()},a.prototype.observeAndFire=function(a){this.observe(a);return a.call(this.base,this.value,this.value)},a.prototype.observe=function(a){this.changeEvent().addHandler(a),this.getValue();return this},a.prototype.removeSourceHandlers=function(){var a;a=this.sourceChangeHandler(),this._eachSourceChangeEvent(function(b){return b.removeHandler(a)});return this.forget()},a.prototype.fire=function(){var a;return(a=this.changeEvent()).fire.apply(a,arguments)},a.prototype.isolate=function(){this._isolationCount===0&&(this._preIsolationValue=this.getValue());return this._isolationCount++},a.prototype.expose=function(){if(this._isolationCount===1){this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue);return this._preIsolationValue=null}if(this._isolationCount>0)return this._isolationCount--},a.prototype.isIsolated=function(){return this._isolationCount>0};return a}(),x.Keypath=function(){function a(b,c){t(c)==="String"?(this.segments=c.split("."),this.depth=this.segments.length):(this.segments=[c],this.depth=1),a.__super__.constructor.apply(this,arguments)}Y(a,x.Property),a.prototype.slice=function(a,b){var c,d,e,f,g;b==null&&(b=this.depth),c=this.base,g=this.segments.slice(0,a);for(e=0,f=g.length;e<f;e++){d=g[e];if(c==null||!(c=x.Property.forBaseAndKey(c,d).getValue()))return}return x.Property.forBaseAndKey(c,this.segments.slice(a,b).join("."))},a.prototype.terminalProperty=function(){return this.slice(-1)},a.prototype.valueFromAccessor=function(){var b;return this.depth===1?a.__super__.valueFromAccessor.apply(this,arguments):(b=this.terminalProperty())!=null?b.getValue():void 0},a.prototype.setValue=function(b){var c;return this.depth===1?a.__super__.setValue.apply(this,arguments):(c=this.terminalProperty())!=null?c.setValue(b):void 0},a.prototype.unsetValue=function(){var b;return this.depth===1?a.__super__.unsetValue.apply(this,arguments):(b=this.terminalProperty())!=null?b.unsetValue():void 0};return a}(),x.Observable={isObservable:!0,hasProperty:function(a){var b,c;return(b=this._batman)!=null?(c=b.properties)!=null?typeof c.hasKey=="function"?c.hasKey(a):void 0:void 0:void 0},property:function(a){var b,c,d;x.initializeObject(this),c=this.propertyClass||x.Keypath,b=(d=this._batman).properties||(d.properties=new x.SimpleHash);return b.get(a)||b.set(a,new c(this,a))},get:function(a){return this.property(a).getValue()},set:function(a,b){return this.property(a).setValue(b)},unset:function(a){return this.property(a).unsetValue()},getOrSet:function(a,b){var c;c=this.get(a),c||(c=b(),this.set(a,c));return c},forget:function(a,b){a?this.property(a).forget(b):this._batman.properties.forEach(function(a,b){return b.forget()});return this},observe:function(){var a,b,c;b=arguments[0],a=2<=arguments.length?V.call(arguments,1):[],(c=this.property(b)).observe.apply(c,a);return this},observeAndFire:function(){var a,b,c;b=arguments[0],a=2<=arguments.length?V.call(arguments,1):[],(c=this.property(b)).observeAndFire.apply(c,a);return this}},h=x.get=function(a,b){return a.get!=null&&typeof a.get=="function"?a.get(b):x.Property.forBaseAndKey(a,b).getValue()},x.initializeObject=function(a){return a._batman!=null?a._batman.check(a):a._batman=new O(a)},x._Batman=O=function(){function a(){var a,b;b=arguments[0],a=2<=arguments.length?V.call(arguments,1):[],this.object=b,a.length>0&&k.apply(null,[this].concat(V.call(a)))}a.prototype.check=function(b){if(b!==this.object){b._batman=new a(b);return!1}return!0},a.prototype.get=function(a){var b;b=this.getAll(a);switch(b.length){case 0:return;case 1:return b[0];default:b[0].concat!=null?b=b.reduceRight(function(a,b){return a.concat(b)}):b[0].merge!=null&&(b=b.reduceRight(function(a,b){return a.merge(b)}));return b}},a.prototype.getFirst=function(a){var b;b=this.getAll(a);return b[0]},a.prototype.getAll=function(a){var b,c,d;typeof a=="function"?b=a:b=function(b){var c;return(c=b._batman)!=null?c[a]:void 0},c=this.ancestors(b),(d=b(this.object))&&c.unshift(d);return c},a.prototype.ancestors=function(a){var b,c,d,e,f,g;a==null&&(a=function(a){return a}),e=[],b=!!this.object.prototype,c=b?(g=this.object.__super__)!=null?g.constructor:void 0:(d=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:d,c!=null&&(f=a(c),f!=null&&e.push(f),c._batman!=null&&(e=e.concat(c._batman.ancestors(a))));return e},a.prototype.set=function(a,b){return this[a]=b};return a}(),y=function(){function c(){var a;a=1<=arguments.length?V.call(arguments,0):[],this._batman=new O(this),this.mixin.apply(this,a)}var a,b;x.initializeObject(c),x.initializeObject(c.prototype),c.global=function(a){if(a!==!1)return E[g(this)]=this},c.classMixin=function(){return k.apply(null,[this].concat(V.call(arguments)))},c.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},c.prototype.mixin=c.classMixin,a=0,c.prototype._objectID=function(){var b;this._objectID=function(){return b};return b=a++},c.prototype.hashKey=function(){var a;if(typeof this.isEqual!="function"){this.hashKey=function(){return a};return a="<Batman.Object "+this._objectID()+">"}},c.prototype.toJSON=function(){var a,b,c;b={};for(a in this){if(!W.call(this,a))continue;c=this[a],a!=="_batman"&&a!=="hashKey"&&a!=="_objectID"&&(b[a]=c.toJSON?c.toJSON():c)}return b},b=function(a){!a.get&&!a.set&&!a.unset&&(a={get:a});return a},c.classAccessor=function(){var a,c,d,e,f,g,h,i;d=2<=arguments.length?V.call(arguments,0,f=arguments.length-1):(f=0,[]),a=arguments[f++],x.initializeObject(this);if(d.length===0)return this._batman.defaultAccessor=b(a);(e=this._batman).keyAccessors||(e.keyAccessors=new x.SimpleHash),i=[];for(g=0,h=d.length;g<h;g++)c=d[g],i.push(this._batman.keyAccessors.set(c,b(a)));return i},c.accessor=function(){return this.classAccessor.apply(this.prototype,arguments)},c.prototype.accessor=c.classAccessor,c.classMixin(x.EventEmitter,x.Observable),c.mixin(x.EventEmitter,x.Observable),c.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},c.singleton=function(a){a==null&&(a="sharedInstance");return this.classAccessor(a,{get:function(){var b;return this[b="_"+a]||(this[b]=new this)}})};return c}(),x.Object=y,x.Accessible=function(){function a(){this.accessor.apply(this,arguments)}Y(a,x.Object);return a}(),x.TerminalAccessible=function(){function a(){a.__super__.constructor.apply(this,arguments)}Y(a,x.Accessible),a.prototype.propertyClass=x.Property;return a}(),x.Enumerable={isEnumerable:!0,map:function(a,b){var c;b==null&&(b=E),c=[],this.forEach(function(){return c.push(a.apply(b,arguments))});return c},every:function(a,b){var c;b==null&&(b=E),c=!0,this.forEach(function(){return c=c&&a.apply(b,arguments)});return c},some:function(a,b){var c;b==null&&(b=E),c=!1,this.forEach(function(){return c=c||a.apply(b,arguments)});return c},reduce:function(a,b){var c,d;c=0,d=this,this.forEach(function(){return b!=null?b=a.apply(null,[b].concat(V.call(arguments),[c],[d])):b=arguments[0]});return b},filter:function(a){var b,c;b=new this.constructor,b.add?c=function(b,c){a(c)&&b.add(c);return b}:b.set?c=function(b,c,d){a(c,d)&&b.set(c,d);return b}:(b.push||(b=[]),c=function(b,c){a(c)&&b.push(c);return b});return this.reduce(c,b)}},e=function(a){var b,c,d,e;d=x.Enumerable,e=[];for(b in d)c=d[b],e.push(a[b]=c);return e},x.SimpleHash=function(){function a(){this._storage={},this.length=0}e(a.prototype),a.prototype.propertyClass=x.Property,a.prototype.hasKey=function(a){var b,c,d,e;if(c=this._storage[this.hashKeyFor(a)])for(d=0,e=c.length;d<e;d++){b=c[d];if(this.equality(b[0],a))return!0}return!1},a.prototype.get=function(a){var b,c,d,e;if(c=this._storage[this.hashKeyFor(a)])for(d=0,e=c.length;d<e;d++){b=c[d];if(this.equality(b[0],a))return b[1]}},a.prototype.set=function(a,b){var c,d,e,f,g,h;d=(e=this._storage)[h=this.hashKeyFor(a)]||(e[h]=[]);for(f=0,g=d.length;f<g;f++){c=d[f];if(this.equality(c[0],a))return c[1]=b}this.length++,d.push([a,b]);return b},a.prototype.unset=function(a){var b,c,d,e,f,g,h,i;b=this.hashKeyFor(a);if(f=this._storage[b])for(c=0,h=f.length;c<h;c++){i=f[c],d=i[0],g=i[1];if(this.equality(d,a)){e=f.splice(c,1),f.length||delete this._storage[b],this.length--;return e[0][1]}}},a.prototype.getOrSet=x.Observable.getOrSet,a.prototype.hashKeyFor=function(a){return(a!=null?typeof a.hashKey=="function"?a.hashKey():void 0:void 0)||a},a.prototype.equality=function(a,b){if(a===b)return!0;if(a!==a&&b!==b)return!0;if((a!=null?typeof a.isEqual=="function"?a.isEqual(b):void 0:void 0)&&(b!=null?typeof b.isEqual=="function"?b.isEqual(a):void 0:void 0))return!0;return!1},a.prototype.forEach=function(a){var b,c,d,e,f,g;f=this._storage,g=[];for(b in f)e=f[b],g.push(function(){var b,f,g,h,i;g=e.slice(),i=[];for(b=0,f=g.length;b<f;b++)h=g[b],c=h[0],d=h[1],i.push(a(c,d));return i}());return g},a.prototype.keys=function(){var a;a=[],x.SimpleHash.prototype.forEach.call(this,function(b){return a.push(b)});return a},a.prototype.clear=function(){this._storage={};return this.length=0},a.prototype.isEmpty=function(){return this.length===0},a.prototype.merge=function(){var a,b,c,d,e;c=1<=arguments.length?V.call(arguments,0):[],b=new this.constructor,c.unshift(this);for(d=0,e=c.length;d<e;d++)a=c[d],a.forEach(function(a,c){return b.set(a,c)});return b};return a}(),x.Hash=function(){function h(){var a;x.SimpleHash.apply(this,arguments),this.meta=new x.Object,a=this,this.meta.accessor("length",function(){a.registerAsMutableSource();return a.length}),this.meta.accessor("isEmpty",function(){return a.isEmpty()}),this.meta.accessor("keys",function(){return a.keys()}),h.__super__.constructor.apply(this,arguments)}var a,b,c,d,f,g;Y(h,x.Object),e(h.prototype),h.prototype.propertyClass=x.Property,h.accessor({get:x.SimpleHash.prototype.get,set:h.mutation(function(a,b){var c;c=x.SimpleHash.prototype.set.call(this,a,b),this.fire("itemsWereAdded",a);return c}),unset:h.mutation(function(a){var b;b=x.SimpleHash.prototype.unset.call(this,a),b!=null&&this.fire("itemsWereRemoved",a);return b})}),h.prototype.clear=h.mutation(function(){var a,b;a=this.meta.get("keys"),b=x.SimpleHash.prototype.clear.call(this),this.fire.apply(this,["itemsWereRemoved"].concat(V.call(a)));return b}),h.prototype.equality=x.SimpleHash.prototype.equality,h.prototype.hashKeyFor=x.SimpleHash.prototype.hashKeyFor,h.prototype.toJSON=function(){var a;a={},this.keys().forEach(Z(function(b){var c;c=this.get(b);return a[b]=c.toJSON?c.toJSON():c},this));return a},g=["hasKey","forEach","isEmpty","keys","merge"],c=function(a){return b[a]=function(){this.registerAsMutableSource();return x.SimpleHash.prototype[a].apply(this,arguments)}};for(d=0,f=g.length;d<f;d++)a=g[d],b=h.prototype,c(a);return h}(),x.SimpleSet=function(){function a(){this._storage=new x.SimpleHash,this._indexes=new x.SimpleHash,this._sorts=new x.SimpleHash,this.length=0,arguments.length>0&&this.add.apply(this,arguments)}e(a.prototype),a.prototype.has=function(a){return this._storage.hasKey(a)},a.prototype.add=function(){var a,b,c,d,e;c=1<=arguments.length?V.call(arguments,0):[],a=[];for(d=0,e=c.length;d<e;d++)b=c[d],this._storage.hasKey(b)||(this._storage.set(b,!0),a.push(b),this.length++);this.fire&&a.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereAdded"].concat(V.call(a))));return a},a.prototype.remove=function(){var a,b,c,d,e;b=1<=arguments.length?V.call(arguments,0):[],c=[];for(d=0,e=b.length;d<e;d++)a=b[d],this._storage.hasKey(a)&&(this._storage.unset(a),c.push(a),this.length--);this.fire&&c.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(V.call(c))));return c},a.prototype.forEach=function(a){return this._storage.forEach(function(b,c){return a(b)})},a.prototype.isEmpty=function(){return this.length===0},a.prototype.clear=function(){var a;a=this.toArray(),this._storage=new x.SimpleHash,this.length=0,this.fire&&a.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(V.call(a))));return a},a.prototype.toArray=function(){return this._storage.keys()},a.prototype.merge=function(){var a,b,c,d,e;b=1<=arguments.length?V.call(arguments,0):[],a=new this.constructor,b.unshift(this);for(d=0,e=b.length;d<e;d++)c=b[d],c.forEach(function(b){return a.add(b)});return a},a.prototype.indexedBy=function(a){return this._indexes.get(a)||this._indexes.set(a,new x.SetIndex(this,a))},a.prototype.sortedBy=function(a,b){var c;b==null&&(b="asc"),b=b.toLowerCase()==="desc"?"desc":"asc",c=this._sorts.get(a)||this._sorts.set(a,new x.Object);return c.get(b)||c.set(b,new x.SetSort(this,a,b))};return a}(),x.Set=function(){function k(){x.SimpleSet.apply(this,arguments)}var a,b,c,d,f,g,h,i,j;Y(k,x.Object),e(k.prototype),i=["add","remove","clear","indexedBy","sortedBy"];for(d=0,g=i.length;d<g;d++)a=i[d],k.prototype[a]=x.SimpleSet.prototype[a];j=["merge","forEach","toArray","isEmpty","has"],c=function(a){return b[a]=function(){this.registerAsMutableSource();return x.SimpleSet.prototype[a].apply(this,arguments)}};for(f=0,h=j.length;f<h;f++)a=j[f],b=k.prototype,c(a);k.prototype.toJSON=k.prototype.toArray,k.accessor("indexedBy",function(){return new x.TerminalAccessible(Z(function(a){return this.indexedBy(a)},this))}),k.accessor("sortedBy",function(){return new x.TerminalAccessible(Z(function(a){return this.sortedBy(a)},this))}),k.accessor("sortedByDescending",function(){return new x.TerminalAccessible(Z(function(a){return this.sortedBy(a,"desc")},this))}),k.accessor("isEmpty",function(){return this.isEmpty()}),k.accessor("toArray",function(){return this.toArray()}),k.accessor("length",function(){this.registerAsMutableSource();return this.length});return k}(),x.SetObserver=function(){function a(a){this.base=a,this._itemObservers=new x.SimpleHash,this._setObservers=new x.SimpleHash,this._setObservers.set("itemsWereAdded",Z(function(){return this.fire.apply(this,["itemsWereAdded"].concat(V.call(arguments)))},this)),this._setObservers.set("itemsWereRemoved",Z(function(){return this.fire.apply(this,["itemsWereRemoved"].concat(V.call(arguments)))},this)),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}Y(a,x.Object),a.prototype.observedItemKeys=[],a.prototype.observerForItemAndKey=function(a,b){},a.prototype._getOrSetObserverForItemAndKey=function(a,b){return this._itemObservers.getOrSet(a,Z(function(){var c;c=new x.SimpleHash;return c.getOrSet(b,Z(function(){return this.observerForItemAndKey(a,b)},this))},this))},a.prototype.startObserving=function(){this._manageItemObservers("observe");return this._manageSetObservers("addHandler")},a.prototype.stopObserving=function(){this._manageItemObservers("forget");return this._manageSetObservers("removeHandler")},a.prototype.startObservingItems=function(){var a,b,c,d,e;b=1<=arguments.length?V.call(arguments,0):[],e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._manageObserversForItem(a,"observe"));return e},a.prototype.stopObservingItems=function(){var a,b,c,d,e;b=1<=arguments.length?V.call(arguments,0):[],e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._manageObserversForItem(a,"forget"));return e},a.prototype._manageObserversForItem=function(a,b){var c,d,e,f;if(!!a.isObservable){f=this.observedItemKeys;for(d=0,e=f.length;d<e;d++)c=f[d],a[b](c,this._getOrSetObserverForItemAndKey(a,c));if(b==="forget")return this._itemObservers.unset(a)}},a.prototype._manageItemObservers=function(a){return this.base.forEach(Z(function(b){return this._manageObserversForItem(b,a)},this))},a.prototype._manageSetObservers=function(a){if(!!this.base.isObservable)return this._setObservers.forEach(Z(function(b,c){return this.base.event(b)[a](c)},this))};return a}(),x.SetProxy=function(){function o(){o.__super__.constructor.call(this),this.length=0}var a,b,c,d,f,g,h,i,j,k,l,m,n;Y(o,x.Object),e(o.prototype),o.prototype.filter=function(a){var b;b=new x.Set;return this.reduce(function(b,c){a(c)&&b.add(c);return b},b)},l=["add","remove","clear"],b=Z(function(a){return this.prototype[a]=function(){var b,c;b=(c=this.base)[a].apply(c,arguments),this.length=this.set("length",this.base.get("length"));return b}},o);for(f=0,i=l.length;f<i;f++)a=l[f],b(a);m=["has","merge","toArray","isEmpty"],c=Z(function(a){return this.prototype[a]=function(){var b;return(b=this.base)[a].apply(b,arguments)}},o);for(g=0,j=m.length;g<j;g++)a=m[g],c(a);n=["isEmpty","toArray"],d=Z(function(a){return this.accessor(a,function(){return this.base.get(a)})},o);for(h=0,k=n.length;h<k;h++)a=n[h],d(a);o.accessor("length",{get:function(){this.registerAsMutableSource();return this.length},set:function(a,b){return this.length=b}});return o}.call(this),x.SetSort=function(){function a(b,c,d){var e;this.base=b,this.key=c,d==null&&(d="asc"),a.__super__.constructor.call(this),this.descending=d.toLowerCase()==="desc",this.base.isObservable&&(this._setObserver=new x.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],e=this._reIndex.bind(this),this._setObserver.observerForItemAndKey=function(){return e},this._setObserver.on("itemsWereAdded",e),this._setObserver.on("itemsWereRemoved",e),this.startObserving()),this._reIndex()}Y(a,x.SetProxy),a.prototype.startObserving=function(){var a;return(a=this._setObserver)!=null?a.startObserving():void 0},a.prototype.stopObserving=function(){var a;return(a=this._setObserver)!=null?a.stopObserving():void 0},a.prototype.toArray=function(){return this.get("_storage")},a.accessor("toArray",a.prototype.toArray),a.prototype.forEach=function(a){var b,c,d,e,f;e=this.get("_storage"),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(a(b,c));return f},a.prototype.compare=function(a,b){var c;if(a===b)return 0;if(a===void 0)return 1;if(b===void 0)return-1;if(a===null)return 1;if(b===null)return-1;if((typeof a.isEqual=="function"?a.isEqual(b):void 0)&&(typeof b.isEqual=="function"?b.isEqual(a):void 0))return 0;c=x.SetSort.prototype.compare(t(a),t(b));if(c!==0)return c;if(a!==a)return 1;if(b!==b)return-1;if(a>b)return 1;if(a<b)return-1;return 0},a.prototype._reIndex=function(){var a,b;a=this.base.toArray().sort(Z(function(a,b){var c,d,e;d=h(a,this.key),d!=null&&(d=d.valueOf()),e=h(b,this.key),e!=null&&(e=e.valueOf()),c=this.descending?-1:1;return this.compare.call(this,d,e)*c},this)),(b=this._setObserver)!=null&&b.startObservingItems.apply(b,a);return this.set("_storage",a)};return a}(),x.SetIndex=function(){function a(b,c){this.base=b,this.key=c,a.__super__.constructor.call(this),this._storage=new x.SimpleHash,this.base.isEventEmitter&&(this._setObserver=new x.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",Z(function(){var a,b,c,d,e;b=1<=arguments.length?V.call(arguments,0):[],e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._addItem(a));return e},this)),this._setObserver.on("itemsWereRemoved",Z(function(){var a,b,c,d,e;b=1<=arguments.length?V.call(arguments,0):[],e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._removeItem(a));return e},this))),this.base.forEach(this._addItem.bind(this)),this.startObserving()}Y(a,x.Object),a.accessor(function(a){return this._resultSetForKey(a)}),a.prototype.startObserving=function(){var a;return(a=this._setObserver)!=null?a.startObserving():void 0},a.prototype.stopObserving=function(){var a;return(a=this._setObserver)!=null?a.stopObserving():void 0},a.prototype.observerForItemAndKey=function(a,b){return Z(function(b,c){this._removeItemFromKey(a,c);return this._addItemToKey(a,b)},this)},a.prototype._addItem=function(a){return this._addItemToKey(a,this._keyForItem(a))},a.prototype._addItemToKey=function(a,b){return this._resultSetForKey(b).add(a)},a.prototype._removeItem=function(a){return this._removeItemFromKey(a,this._keyForItem(a))},a.prototype._removeItemFromKey=function(a,b){var c;c=this._resultSetForKey(b),c.remove(a);if(c.isEmpty())return this._storage.unset(b)},a.prototype._resultSetForKey=function(a){return this._storage.getOrSet(a,function(){return new x.Set})},a.prototype._keyForItem=function(a){return x.Keypath.forBaseAndKey(a,this.key).getValue()};return a}(),x.UniqueSetIndex=function(){function a(){this._uniqueIndex=new x.Hash,a.__super__.constructor.apply(this,arguments)}Y(a,x.SetIndex),a.accessor(function(a){return this._uniqueIndex.get(a)}),a.prototype._addItemToKey=function(a,b){this._resultSetForKey(b).add(a);if(!this._uniqueIndex.hasKey(b))return this._uniqueIndex.set(b,a)},a.prototype._removeItemFromKey=function(b,c){var d;d=this._resultSetForKey(c),a.__super__._removeItemFromKey.apply(this,arguments);return d.isEmpty()?this._uniqueIndex.unset(c):this._uniqueIndex.set(c,d.toArray()[0])};return a}(),x.StateMachine={initialize:function(){x.initializeObject(this);if(!this._batman.states)return this._batman.states=new x.SimpleHash},state:function(a,b){x.StateMachine.initialize.call(this);if(!a)return this._batman.getFirst("state");this[a]||(this[a]=function(b){return U.call(this,a)});if(typeof b=="function")return this.on(a,b)},transition:function(a,b,c){x.StateMachine.initialize.call(this),this.state(a),this.state(b);if(c)return this.on(""+a+"->"+b,c)}},x.Object.actsAsStateMachine=function(a){a==null&&(a=!0),x.StateMachine.initialize.call(this),x.StateMachine.initialize.call(this.prototype),this.classState=function(){return x.StateMachine.state.apply(this,arguments)},this.state=function(){return this.classState.apply(this.prototype,arguments)},a&&(this.prototype.state=this.classState),this.classTransition=function(){return x.StateMachine.transition.apply(this,arguments)},this.transition=function(){return this.classTransition.apply(this.prototype,arguments)};if(a)return this.prototype.transition=this.classTransition},U=function(a){var b,c,d;x.StateMachine.initialize.call(this);if(this._batman.isTransitioning){((c=this._batman).nextState||(c.nextState=[])).push(a);return!1}this._batman.isTransitioning=!0,b=this.state(),this._batman.state=a,a&&b&&this.fire(""+b+"->"+a,a,b),a&&this.fire(a,a,b),this._batman.isTransitioning=!1,((d=this._batman.nextState)!=null?d.length:void 0)&&this[this._batman.nextState.shift()]();return a},x.Request=function(){function a(b){var c,d,e;d={};for(e in b){c=b[e];if(e==="success"||e==="error"||e==="loading"||e==="loaded")d[e]=c,delete b[e]}a.__super__.constructor.call(this,b);for(e in d)c=d[e],this.on(e,c)}Y(a,x.Object),a.objectToFormData=function(a){var b,c,d,e,f,g,h,i;d=function(a,b,c){var e,f,g;c==null&&(c=!1);return f=function(){switch(x.typeOf(b)){case"Object":f=function(){var f;f=[];for(e in b)g=b[e],f.push(d(c?e:""+a+"["+e+"]",g));return f}();return f.reduce(function(a,b){return a.concat(b)},[]);case"Array":return b.reduce(function(b,c){return b.concat(d(""+a+"[]",c))},[]);default:return[[a,b]]}}()},b=new FormData,h=d("",a,!0);for(f=0,g=h.length;f<g;f++)i=h[f],c=i[0],e=i[1],b.append(c,e);return b},a.prototype.url="",a.prototype.data="",a.prototype.method="get",a.prototype.formData=!1,a.prototype.response=null,a.prototype.status=null,a.prototype.contentType="application/x-www-form-urlencoded",a.observeAll("url",function(){return this._autosendTimeout=q(Z(function(){return this.send()},this))}),a.prototype.send=function(){},a.prototype.cancel=function(){if(this._autosendTimeout)return clearTimeout(this._autosendTimeout)};return a}(),x.App=function(){function a(){a.__super__.constructor.apply(this,arguments)}Y(a,x.Object),a.requirePath="",a.layout=void 0,a.event("ready").oneShot=!0,a.event("run").oneShot=!0,a.run=function(){if(x.currentApp){if(x.currentApp===this)return;x.currentApp.stop()}if(this.hasRun)return!1;if(this.isPrevented("run")){this.wantsToRun=!0;return!1}delete this.wantsToRun,x.currentApp=this,typeof this.dispatcher=="undefined"&&(this.dispatcher||(this.dispatcher=new x.Dispatcher(this))),this.observe("layout",Z(function(a){return a!=null?a.on("ready",Z(function(){return this.fire("ready")},this)):void 0},this)),typeof this.layout=="undefined"?this.set("layout",new x.View({contexts:[this],node:document})):typeof this.layout=="string"&&this.set("layout",new(this[H.camelize(this.layout)+"View"])),typeof this.historyManager=="undefined"&&this.dispatcher.routeMap&&this.on("run",Z(function(){this.historyManager=x.historyManager=new x.HashHistory(this);return this.historyManager.start()},this)),this.hasRun=!0,this.fire("run");return this},a.event("ready").oneShot=!0,a.event("stop").oneShot=!0,a.stop=function(){var a;(a=this.historyManager)!=null&&a.stop(),x.historyManager=null,this.hasRun=!1,this.fire("stop");return this};return a}.call(this),x.Route=function(){function f(){var g;f.__super__.constructor.apply(this,arguments),this.pattern=this.url.replace(a,"\\$&"),this.regexp=new RegExp("^"+this.pattern.replace(c,"([^/]*)").replace(e,"(.*?)")+d+"$"),this.namedArguments=[];while((g=b.exec(this.pattern))!=null)g[1]&&this.namedArguments.push(g[1])}var a,b,c,d,e;Y(f,x.Object),c=/:([\w\d]+)/g,e=/\*([\w\d]+)/g,d="(?:\\?.+)?",b=/[:|\*]([\w\d]+)/g,a=/[-[\]{}()+?.,\\^$|#\s]/g,f.accessor("action",{get:function(){var a,b,c;if(this.action)return this.action;if(this.options){b=k({},this.options);if(c=b.signature)a=c.split("#"),b.controller=a[0],b.action=a[1]||"index";b.target=this.dispatcher.get(b.controller);return this.set("action",b)}},set:function(a,b){return this.action=b}}),f.prototype.parameterize=function(a){var b,c,d,e,f,g,h,i,j,l,m,n,o,p,q,r;o=a.split("?"),a=o[0],h=o[1],c=(p=this.regexp.exec(a))!=null?p.slice(1):void 0,g={url:a},b=this.get("action"),typeof b=="function"?g.action=b:k(g,b);if(c)for(d=0,m=c.length;d<m;d++)f=c[d],g[this.namedArguments[d]]=f;if(h){q=h.split("&");for(l=0,n=q.length;l<n;l++)i=q[l],r=i.split("="),e=r[0],j=r[1],g[e]=j}return g},f.prototype.dispatch=function(a){var b,c,d,e;t(a)==="String"&&(c=this.parameterize(a)),!(b=c.action)&&a!=="/404"&&n("/404");if(typeof b=="function")return b(c);if((d=c.target)!=null?d.dispatch:void 0)return c.target.dispatch(b,c);return(e=c.target)!=null?e[b](c):void 0};return f}(),x.Dispatcher=function(){function a(a){var b,c,d;this.app=a,this.app.route(this),this.app.controllers=new x.Object,d=this.app;for(c in d){b=d[c];if(!((b!=null?b.prototype:void 0)instanceof x.Controller))continue;this.prepareController(b)}}Y(a,x.Object),a.prototype.prepareController=function(a){var b,c;c=H.underscore(g(a).replace("Controller",""));if(!!c){b=function(){return this[c]=a.get("sharedController")},this.accessor(c,b);return this.app.controllers.accessor(c,b)}},a.prototype.register=function(a,b){var c;a.indexOf("/")!==0&&(a="/"+a),c=t(b)==="Function"?new x.Route({url:a,action:b,dispatcher:this}):new x.Route({url:a,options:b,dispatcher:this}),this.routeMap||(this.routeMap={});return this.routeMap[a]=c},a.prototype.findRoute=function(a){var b,c,d;a.indexOf("/")!==0&&(a="/"+a);if(b=this.routeMap[a])return b;d=this.routeMap;for(c in d){b=d[c];if(b.regexp.test(a))return b}},a.prototype.findUrl=function(a){var b,c,d,e,f,g,h,i,j,l,m,n,o;n=this.routeMap;for(l in n){j=n[l],e=!1,f=j.options,a.resource?e=f.resource===a.resource&&f.action===a.action:(b=j.get("action"),typeof b=="function"?e=!0:(o=b,c=o.controller,b=o.action,c===a.controller&&b===(a.action||"index")&&(e=!0)));if(!e)continue;k(g={},a),w(g,{controller:null,action:null,resource:null,url:null,signature:null,target:null});for(d in a){m=a[d],i=new RegExp("[:|*]"+d);if(!i.test(l))continue;l=l.replace(i,m),g[d]=null,delete g[d]}h="";for(d in g)m=g[d],h+=h?"&":"?",h+=d+"="+m;return l+h}},a.prototype.dispatch=function(a){var b;b=this.findRoute(a),b?b.dispatch(a):a!=="/404"&&n("/404"),this.app.set("currentURL",a);return this.app.set("currentRoute",b)};return a}(),x.HistoryManager=function(){function a(a){this.app=a}a.prototype.dispatch=function(a){a.indexOf("/")!==0&&(a="/"+a),this.app.dispatcher.dispatch(a);return a},a.prototype.redirect=function(a){t(a)!=="String"&&(a=this.app.dispatcher.findUrl(a));return this.dispatch(a)};return a}(),x.HashHistory=function(){function b(){this.parseHash=Z(this.parseHash,this),this.stop=Z(this.stop,this),this.start=Z(this.start,this),b.__super__.constructor.apply(this,arguments)}Y(b,x.HistoryManager),b.prototype.HASH_PREFIX="#!",b.prototype.start=function(){if(typeof window!="undefined"){if(this.started)return;this.started=!0,"onhashchange"in window?a(window,"hashchange",this.parseHash):this.interval=setInterval(this.parseHash,100),this.first=!0,x.currentApp.prevent("ready");return q(this.parseHash)}},b.prototype.stop=function(){this.interval?this.interval=clearInterval(this.interval):o(window,"hashchange",this.parseHash);return this.started=!1},b.prototype.urlFor=function(a){return this.HASH_PREFIX+a},b.prototype.parseHash=function(){var a,b;a=window.location.hash.replace(this.HASH_PREFIX,"");if(a!==this.cachedHash){b=this.dispatch(this.cachedHash=a),this.first&&(x.currentApp.allow("ready"),x.currentApp.fire("ready"),this.first=!1);return b}},b.prototype.redirect=function(a){var c;c=b.__super__.redirect.apply(this,arguments),this.cachedHash=c;return window.location.hash=this.HASH_PREFIX+c};return b}(),x.redirect=n=function(a){var b;return(b=x.historyManager)!=null?b.redirect(a):void 0},x.App.classMixin({route:function(a,b,c){var d,e,f,g;c==null&&(c={});if(!!a){if(a instanceof x.Dispatcher){d=a,g=this._dispatcherCache;for(e in g)f=g[e],d.register(e,f);this._dispatcherCache=null;return d}t(b)==="String"?c.signature=b:t(b)==="Function"?c=b:b&&k(c,b),this._dispatcherCache||(this._dispatcherCache={});return this._dispatcherCache[a]=c}},root:function(a,b){return this.route("/",a,b)},resources:function(a,b,c){var d,e,f;b==null&&(b={}),typeof b=="function"&&(c=b,b={}),a=H.pluralize(a),e=b.controller||a,b.parentResource&&(a=""+b.parentResource+"/:"+H.singularize(b.parentResource)+"Id/"+a),b.index!==!1&&this.route(a,""+e+"#index",{resource:e,action:"index"}),b["new"]!==!1&&this.route(""+a+"/new",""+e+"#new",{resource:e,action:"new"}),b.show!==!1&&this.route(""+a+"/:id",""+e+"#show",{resource:e,action:"show"}),b.edit!==!1&&this.route(""+a+"/:id/edit",""+e+"#edit",{resource:e,action:"edit"});if(c){d=this,f={collection:function(b){return b!=null?b.call({route:function(b,c){return d.route(""+a+"/"+b,""+e+"#"+(c||b))}}):void 0},member:function(b){return b!=null?b.call({route:function(b,c){return d.route(""+a+"/:id/"+b,""+e+"#"+(c||b))}}):void 0},resources:Z(function(b,c,d){c==null&&(c={}),typeof c=="function"&&(d=c,c={}),c.parentResource=a;return this.resources(b,c,d)},this)};return c.call(f)}},redirect:n}),x.Controller=function(){function a(){this.redirect=Z(this.redirect,this),a.__super__.constructor.apply(this,arguments)}Y(a,x.Object),a.singleton("sharedController"),a.beforeFilter=function(a){var b,c;x.initializeObject(this),b=(c=this._batman).beforeFilters||(c.beforeFilters=[]);if(b.indexOf(a)===-1)return b.push(a)},a.accessor("controllerName",{get:function(){return this._controllerName||(this._controllerName=H.underscore(g(this.constructor).replace("Controller","")))}}),a.afterFilter=function(a){var b,c;x.initializeObject(this),b=(c=this._batman).afterFilters||(c.afterFilters=[]);if(b.indexOf(a)===-1)return b.push(a)},a.accessor("action",{get:function(){return this._currentAction},set:function(a,b){return this._currentAction=b}}),a.prototype.dispatch=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,o,p;b==null&&(b={}),b.controller||(b.controller=this.get("controllerName")),b.action||(b.action=a),b.target||(b.target=this),e=(k=x.historyManager)!=null?k.redirect:void 0,(l=x.historyManager)!=null&&(l.redirect=this.redirect),this._actedDuringAction=!1,this.set("action",a);if(d=(m=this.constructor._batman)!=null?m.get("beforeFilters"):void 0)for(g=0,i=d.length;g<i;g++)c=d[g],typeof c=="function"?c.call(this,b):this[c](b);this[a](b),this._actedDuringAction||this.render();if(d=(o=this.constructor._batman)!=null?o.get("afterFilters"):void 0)for(h=0,j=d.length;h<j;h++)c=d[h],typeof c=="function"?c.call(this,b):this[c](b);delete this._actedDuringAction,this.set("action",null),(p=x.historyManager)!=null&&(p.redirect=e),f=this._afterFilterRedirect,delete this._afterFilterRedirect;if(f)return n(f)},a.prototype.redirect=function(a){if(this._actedDuringAction)throw"DoubleRedirectError";if(this.get("action")){this._actedDuringAction=!0;return this._afterFilterRedirect=a}t(a)==="Object"&&(a.controller||(a.controller=this));return n(a)},a.prototype.render=function(a){var b,c;a==null&&(a={});if(this._actedDuringAction)throw"DoubleRenderError";this._actedDuringAction=!0;if(a!==!1){a.view||(a.contexts||(a.contexts=[]),a.contexts.push(this),a.source||(a.source=H.underscore(g(this.constructor).replace("Controller",""))+"/"+this._currentAction+".html"),a.view=new x.View(a));if(b=a.view)(c=x.currentApp)!=null&&c.prevent("ready"),b.on("ready",function(){var c,d;x.DOM.replace(a.into||"main",b.get("node")),(c=x.currentApp)!=null&&c.allow("ready");return(d=x.currentApp)!=null?d.fire("ready"):void 0});return b}};return a}(),x.Model=function(){function i(a){a==null&&(a={}),this.destroy=Z(this.destroy,this),this.save=Z(this.save,this),this.load=Z(this.load,this),this.dirtyKeys=new x.Hash,this.errors=new x.ErrorsSet,t(a)==="Object"?i.__super__.constructor.call(this,a):(i.__super__.constructor.call(this),this.set("id",a)),this.state()||this.empty()}var a,b,c,d,e,f,h;Y(i,x.Object),i.primaryKey="id",i.storageKey=null,i.persist=function(){var a,b,c,d,e;b=1<=arguments.length?V.call(arguments,0):[],x.initializeObject(this.prototype),d=(e=this.prototype._batman).storage||(e.storage=[]),c=function(){var c,e,f;f=[];for(c=0,e=b.length;c<e;c++)a=b[c],a=a.isStorageAdapter?a:new a(this),d.push(a),f.push(a);return f}.call(this);return c.length>1?c:c[0]},i.encode=function(){var a,b,c,d,e,f,g,h,i,j,k;e=2<=arguments.length?V.call(arguments,0,h=arguments.length-1):(h=0,[]),c=arguments[h++],x.initializeObject(this.prototype),(f=this.prototype._batman).encoders||(f.encoders=new x.SimpleHash),(g=this.prototype._batman).decoders||(g.decoders=new x.SimpleHash);switch(t(c)){case"String":e.push(c);break;case"Function":b=c;break;default:b=c.encode,a=c.decode}typeof b=="undefined"&&(b=this.defaultEncoder.encode),typeof a=="undefined"&&(a=this.defaultEncoder.decode),k=[];for(i=0,j=e.length;i<j;i++)d=e[i],b&&this.prototype._batman.encoders.set(d,b),k.push(a?this.prototype._batman.decoders.set(d,a):void 0);return k},i.defaultEncoder={encode:function(a){return a},decode:function(a){return a}},i.observeAndFire("primaryKey",function(a){return this.encode(a,{encode:!1,decode:this.defaultEncoder.decode})}),i.validate=function(){var a,b,c,d,e,f,g,h,i,j,k,l;a=2<=arguments.length?V.call(arguments,0,i=arguments.length-1):(i=0,[]),e=arguments[i++],x.initializeObject(this.prototype),g=(h=this.prototype._batman).validators||(h.validators=[]);if(typeof e=="function")return g.push({keys:a,callback:e});d=e,l=[];for(j=0,k=A.length;j<k;j++)f=A[j],l.push(function(){var e,h;if(c=f.matches(d)){for(e=0,h=c.length;e<h;e++)b=c[e],delete d[b];return g.push({keys:a,validator:new f(c)})}}());return l},i.classAccessor("all",{get:function(){var a;this.prototype.hasStorage()&&(a=this.classState())!=="loaded"&&a!=="loading"&&this.load();return this.get("loaded")},set:function(a,b){return this.set("loaded",b)}}),i.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new x.Set)},set:function(a,b){return this._loaded=b}}),i.classAccessor("first",function(){return this.get("all").toArray()[0]}),i.classAccessor("last",function(){var a;a=this.get("all").toArray();return a[a.length-1]}),i.find=function(a,b){var c,d;d=new this,d.set("id",a),c=this._mapIdentity(d),c.load(b);return c},i.load=function(a,b){t(a)==="Function"&&(b=a,a={}),this.loading();return this.prototype._doStorageOperation("readAll",a,Z(function(a,c){var d,e;if(a!=null)return typeof b=="function"?b(a,[]):void 0;d=function(){var a,b,d;d=[];for(a=0,b=c.length;a<b;a++)e=c[a],d.push(this._mapIdentity(e));return d}.call(this),this.loaded();return typeof b=="function"?b(a,d):void 0},this))},i.create=function(a,b){var c,d;b||(d=[{},a],a=d[0],b=d[1]),c=new this(a),c.save(b);return c},i.findOrCreate=function(a,b){var c,d;d=new this(a);if(d.isNew())return d.save(b);c=this._mapIdentity(d),c.updateAttributes(a);return b(void 0,c)},i._mapIdentity=function(a){var b,c,d;if(typeof (c=a.get("id"))=="undefined"||c==="")return a;b=(d=this.get("loaded.indexedBy.id").get(c))!=null?d.toArray()[0]:void 0;if(b){b.updateAttributes(a._batman.attributes||{});return b}this.get("loaded").add(a);return a},i.accessor("id",{get:function(){var a;a=this.constructor.primaryKey;return a==="id"?this.id:this.get(a)},set:function(a,b){var c,d;typeof b=="string"&&!isNaN(c=parseInt(b,10))&&(b=c),d=this.constructor.primaryKey;return d==="id"?this.id=b:this.set(d,b)}}),i.accessor("dirtyKeys","errors",x.Property.defaultAccessor),i.accessor("batmanState",{get:function(){return this.state()},set:function(a,b){return this.state(b)}}),i.accessor(i.defaultAccessor={get:function(a){var b;return((b=this._batman).attributes||(b.attributes={}))[a]||this[a]},set:function(a,b){var c;return((c=this._batman).attributes||(c.attributes={}))[a]=b},unset:function(a){var b,c;b=((c=this._batman).attributes||(c.attributes={}))[a],delete this._batman.attributes[a];return b}}),i.prototype.set=function(a,b){var c,d,e;c=this.get(a);if(c!==b){d=i.__super__.set.apply(this,arguments),this.dirtyKeys.set(a,c),(e=this.state())!=="dirty"&&e!=="loading"&&e!=="creating"&&this.dirty();return d}},i.prototype.updateAttributes=function(a){this.mixin(a);return this},i.prototype.toString=function(){return""+g(this.constructor)+": "+this.get("id")},i.prototype.toJSON=function(){var a,b;b={},a=this._batman.get("encoders"),!!a&&!a.isEmpty()&&a.forEach(Z(function(a,c){var d,e;e=this.get(a);if(typeof e!="undefined"){d=c(this.get(a));if(typeof d!="undefined")return b[a]=d}},this));return b},i.prototype.fromJSON=function(a){var b,c,d,e;d={},b=this._batman.get("decoders");if(!b||b.isEmpty())for(c in a)e=a[c],d[c]=e;else b.forEach(function(b,c){if(a[b])return d[b]=c(a[b])});return this.mixin(d)},i.actsAsStateMachine(!0),f=["empty","dirty","loading","loaded","saving","saved","creating","created","validating","validated","destroying","destroyed"];for(b=0,d=f.length;b<d;b++)a=f[b],i.state(a);h=["loading","loaded"];for(c=0,e=h.length;c<e;c++)a=h[c],i.classState(a);i.prototype._doStorageOperation=function(a,b,c){var d,e,f,g;e=this._batman.get("storage");for(f=0,g=e.length;f<g;f++)d=e[f],d[a](this,b,c);return!0},i.prototype.hasStorage=function(){return(this._batman.get("storage")||[]).length>0},i.prototype.load=function(a){var b;if((b=this.state())==="destroying"||b==="destroyed")typeof a=="function"&&a(new Error("Can't load a destroyed record!"));else{this.loading();return this._doStorageOperation("read",{},Z(function(b,c){b||(this.loaded(),c=this.constructor._mapIdentity(c));return typeof a=="function"?a(b,c):void 0},this))}},i.prototype.save=function(a){var b;if((b=this.state())==="destroying"||b==="destroyed")typeof a=="function"&&a(new Error("Can't save a destroyed record!"));else return this.validate(Z(function(b,c){var d;if(!b)typeof a=="function"&&a(c);else{d=this.isNew(),this.saving(),d&&this.creating();return this._doStorageOperation(d?"create":"update",{},Z(function(b,c){b||(d&&this.created(),this.saved(),this.dirtyKeys.clear(),c=this.constructor._mapIdentity(c));return typeof a=="function"?a(b,c):void 0},this))}},this))},i.prototype.destroy=function(a){this.destroying();return this._doStorageOperation("destroy",{},Z(function(b,c){b||(this.constructor.get("all").remove(this),this.destroyed());return typeof a=="function"?a(b):void 0},this))},i.prototype.validate=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;e=this.state(),this.errors.clear(),this.validating(),c=Z(function(){this.validated(),this[e]();return typeof a=="function"?a(this.errors.length===0,this.errors):void 0},this),i=this._batman.get("validators")||[];if(i.length>0){b=i.length,g=Z(function(){if(--b===0)return c()},this);for(j=0,l=i.length;j<l;j++){h=i[j],f=h.validator,n=h.keys;for(k=0,m=n.length;k<m;k++)d=n[k],f?f.validateEach(this.errors,this,d,g):h.callback(this.errors,this,d,g)}}else c()},i.prototype.isNew=function(){return typeof this.get("id")=="undefined"};return i}(),x.ValidationError=function(){function a(b,c){a.__super__.constructor.call(this,{attribute:b,message:c})}Y(a,x.Object);return a}(),x.ErrorsSet=function(){function a(){a.__super__.constructor.apply(this,arguments)}Y(a,x.Set),a.accessor(function(a){return this.indexedBy("attribute").get(a)}),a.prototype.add=function(b,c){return a.__super__.add.call(this,new x.ValidationError(b,c))};return a}(),x.Validator=function(){function a(){var b,c;c=arguments[0],b=2<=arguments.length?V.call(arguments,1):[],this.options=c,a.__super__.constructor.apply(this,b)}Y(a,x.Object),a.prototype.validate=function(a){},a.prototype.format=function(a,b,c){return L("errors.format",{attribute:a,message:L("errors.messages."+b,c)})},a.options=function(){var a;a=1<=arguments.length?V.call(arguments,0):[],x.initializeObject(this);return this._batman.options?this._batman.options.concat(a):this._batman.options=a},a.matches=function(a){var b,c,d,e,f,g;c={},d=!1;for(b in a)e=a[b],~((f=this._batman)!=null?(g=f.options)!=null?g.indexOf(b):void 0:void 0)&&(c[b]=e,d=!0);if(d)return c};return a}(),A=x.Validators=[x.LengthValidator=function(){function a(b){var c;if(c=b.lengthIn||b.lengthWithin)b.minLength=c[0],b.maxLength=c[1]||-1,delete b.lengthWithin,delete b.lengthIn;a.__super__.constructor.apply(this,arguments)}Y(a,x.Validator),a.options("minLength","maxLength","length","lengthWithin","lengthIn"),a.prototype.validateEach=function(a,b,c,d){var e,f;e=this.options,f=b.get(c),e.minLength&&f.length<e.minLength&&a.add(c,this.format(c,"too_short",{count:e.minLength})),e.maxLength&&f.length>e.maxLength&&a.add(c,this.format(c,"too_long",{count:e.maxLength})),e.length&&f.length!==e.length&&a.add(c,this.format(c,"wrong_length",{count:e.length}));return d()};return a}(),x.PresenceValidator=function(){function a(){a.__super__.constructor.apply(this,arguments)}Y(a,x.Validator),a.options("presence"),a.prototype.validateEach=function(a,b,c,d){var e;e=b.get(c),this.options.presence&&e==null&&a.add(c,this.format(c,"blank"));return d()};return a}()],k(x.translate.messages,{errors:{format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank"}}}),x.StorageAdapter=function(){function k(a){k.__super__.constructor.call(this,{model:a,modelKey:a.get("storageKey")||H.pluralize(H.underscore(g(a)))})}var a,b,c,d,e,f,h,i,j;Y(k,x.Object),k.prototype.isStorageAdapter=!0,k.prototype._batman.check(k.prototype),i=["all","create","read","readAll","update","destroy"];for(d=0,f=i.length;d<f;d++){a=i[d],j=["before","after"],c=Z(function(a,b){var c;c=""+b+H.capitalize(a);return this.prototype[c]=function(a){var b,d;this._batman.check(this);return((b=this._batman)[d=""+c+"Filters"]||(b[d]=[])).push(a)}},k);for(e=0,h=j.length;e<h;e++)b=j[e],c(a,b)}k.prototype.before=function(){var a,b,c,d,e,f,g;c=2<=arguments.length?V.call(arguments,0,d=arguments.length-1):(d=0,[]),a=arguments[d++],g=[];for(e=0,f=c.length;e<f;e++)b=c[e],g.push(this["before"+H.capitalize(b)](a));return g},k.prototype.after=function(){var a,b,c,d,e,f,g;c=2<=arguments.length?V.call(arguments,0,d=arguments.length-1):(d=0,[]),a=arguments[d++],g=[];for(e=0,f=c.length;e<f;e++)b=c[e],g.push(this["after"+H.capitalize(b)](a));return g},k.prototype._filterData=function(){var a,b,c;c=arguments[0],a=arguments[1],b=3<=arguments.length?V.call(arguments,2):[];return(this._batman.get(""+c+H.capitalize(a)+"Filters")||[]).concat(this._batman.get(""+c+"AllFilters")||[]).reduce(Z(function(a,b){return b.call(this,a)},this),b)},k.prototype.getRecordFromData=function(a){var b;b=new this.model,b.fromJSON(a);return b};return k}.call(this),l=function(a){return function(b){var c;if(b[0])return b;c=b.shift(),b=a.call(this,b),b.unshift(c);return b}},x.LocalStorage=function(){function a(){if(typeof window.localStorage=="undefined")return null;a.__super__.constructor.apply(this,arguments),this.storage=localStorage,this.key_re=new RegExp("^"+this.modelKey+"(\\d+)$"),this.nextId=1,this._forAllRecords(function(a,b){var c;if(c=this.key_re.exec(a))return this.nextId=Math.max(this.nextId,parseInt(c[1],10)+1)});return}Y(a,x.StorageAdapter),a.prototype.before("create","update",l(function(a){var b,c;c=a[0],b=a[1];return[JSON.stringify(c),b]})),a.prototype.after("read",l(function(a){var b,c,d;d=a[0],b=a[1],c=a[2];return[d.fromJSON(JSON.parse(b)),b,c]})),a.prototype._forAllRecords=function(a){var b,c,d,e;e=[];for(b=0,d=this.storage.length;0<=d?b<d:b>d;0<=d?b++:b--)c=this.storage.key(b),e.push(a.call(this,c,this.storage.getItem(c)));return e},a.prototype.getRecordFromData=function(b){var c;c=a.__super__.getRecordFromData.apply(this,arguments),this.nextId=Math.max(this.nextId,parseInt(c.get("id"),10)+1);return c},a.prototype.update=function(a,b,c){var d,e,f,g;g=this._filterData("before","update",void 0,a,b),d=g[0],f=g[1],d||(e=a.get("id"),e!=null?this.storage.setItem(this.modelKey+e,f):d=new Error("Couldn't get record primary key."));return c.apply(null,this._filterData("after","update",d,a,b))},a.prototype.create=function(a,b,c){var d,e,f,g,h;h=this._filterData("before","create",void 0,a,b),d=h[0],g=h[1],d||(e=a.get("id")||a.set("id",this.nextId++),e!=null?(f=this.modelKey+e,this.storage.getItem(f)?d=new Error("Can't create because the record already exists!"):this.storage.setItem(f,g)):d=new Error("Couldn't set record primary key on create!"));return c.apply(null,this._filterData("after","create",d,a,b))},a.prototype.read=function(a,b,c){var d,e,f,g;g=this._filterData("before","read",void 0,a,b),e=g[0],a=g[1],f=a.get("id"),e||(f!=null?(d=this.storage.getItem(this.modelKey+f),d||(e=new Error("Couldn't find record!"))):e=new Error("Couldn't get record primary key."));return c.apply(null,this._filterData("after","read",e,a,d,b))},a.prototype.readAll=function(a,b,c){var d,e,f;e=[],f=this._filterData("before","readAll",void 0,b),d=f[0],b=f[1],d||this._forAllRecords(function(a,b){var c;if(c=this.key_re.exec(a))return e.push({data:b,id:c[1]})});return c.apply(null,this._filterData("after","readAll",d,e,b))},a.prototype.after("readAll",l(function(a){var b,c,d,e;b=a[0],e=a[1],b=function(){var a,e,f,g;g=[];for(a=0,e=b.length;a<e;a++)c=b[a],d=JSON.parse(c.data),d[f=this.model.primaryKey]||(d[f]=parseInt(c.id,10)),g.push(d);return g}.call(this);return[b,e]})),a.prototype.after("readAll",l(function(a){var b,c,d,e,f,g,h,i,j;b=a[0],g=a[1],f=[];for(i=0,j=b.length;i<j;i++){c=b[i],e=!0;for(d in g){h=g[d];if(c[d]!==h){e=!1;break}}e&&f.push(c)}return[f,g]})),a.prototype.after("readAll",l(function(a){var b,c,d;c=a[0],d=a[1];return[function(){var a,d,e;e=[];for(a=0,d=c.length;a<d;a++)b=c[a],e.push(this.getRecordFromData(b));return e}.call(this),c,d]})),a.prototype.destroy=function(a,b,c){var d,e,f,g;g=this._filterData("before","destroy",void 0,a,b),d=g[0],a=g[1],d||(e=a.get("id"),e!=null?(f=this.modelKey+e,this.storage.getItem(f)?this.storage.removeItem(f):d=new Error("Can't delete nonexistant record!")):d=new Error("Can't delete record without an primary key!"));return c.apply(null,this._filterData("after","destroy",d,a,b))};return a}(),x.RestStorage=function(){function a(){a.__super__.constructor.apply(this,arguments),this.defaultOptions=k({},this.defaultOptions),this.recordJsonNamespace=H.singularize(this.modelKey),this.collectionJsonNamespace=H.pluralize(this.modelKey)}Y(a,x.StorageAdapter),a.prototype.defaultOptions={type:"json"},a.prototype.recordJsonNamespace=!1,a.prototype.collectionJsonNamespace=!1,a.prototype.serializeAsForm=!0,a.prototype.before("create","update",l(function(a){var b,c,d,e;d=a[0],c=a[1],b=d.toJSON(),d=this.recordJsonNamespace?(e={},e[this.recordJsonNamespace]=b,e):b,this.serializeAsForm||(d=JSON.stringify(d));return[d,c]})),a.prototype.after("create","read","update",l(function(a){var b,c,d;d=a[0],b=a[1],c=a[2],b[this.recordJsonNamespace]&&(b=b[this.recordJsonNamespace]);return[d,b,c]})),a.prototype.after("create","read","update",l(function(a){var b,c,d;d=a[0],b=a[1],c=a[2],d.fromJSON(b);return[d,b,c]})),a.prototype.optionsForRecord=function(a,b,c){var d,e,f;if(a.url)e=(typeof a.url=="function"?a.url(a):void 0)||a.url;else{e=(typeof (f=this.model).url=="function"?f.url():void 0)||this.model.url||"/"+this.modelKey;if(b||!a.isNew()){d=a.get("id");if(d==null){c.call(this,new Error("Couldn't get record primary key!"));return}e=e+"/"+d}}return e?c.call(this,void 0,k({},this.defaultOptions,{url:e})):c.call(this,new Error("Couldn't get model url!"))},a.prototype.optionsForCollection=function(a,b){var c,d;c=(typeof (d=this.model).url=="function"?d.url():void 0)||this.model.url||"/"+this.modelKey;return c?b.call(this,void 0,k({},this.defaultOptions,{url:c,data:k({},this.defaultOptions.data,a)})):b.call(this,new Error("Couldn't get collection url!"))},a.prototype.create=function(a,b,c){return this.optionsForRecord(a,!1,function(d,e){var f,g;g=this._filterData("before","create",d,a,b),d=g[0],f=g[1];if(d)c(d);else return new x.Request(k(e,{data:f,method:"POST",success:Z(function(d){return c.apply(null,this._filterData("after","create",void 0,a,d,b))},this),error:Z(function(d){return c.apply(null,this._filterData("after","create",d,a,d.request.get("response"),b))},this)}))})},a.prototype.update=function(a,b,c){return this.optionsForRecord(a,!0,function(d,e){var f,g;g=this._filterData("before","update",d,a,b),d=g[0],f=g[1];if(d)c(d);else return new x.Request(k(e,{data:f,method:"PUT",success:Z(function(d){return c.apply(null,this._filterData("after","update",void 0,a,d,b))},this),error:Z(function(d){return c.apply(null,this._filterData("after","update",d,a,d.request.get("response"),b))},this)}))})},a.prototype.read=function(a,b,c){return this.optionsForRecord(a,!0,function(d,e){var f;f=this._filterData("before","read",d,a,b),d=f[0],a=f[1],b=f[2];if(d)c(d);else return new x.Request(k(e,{data:b,method:"GET",success:Z(function(d){return c.apply(null,this._filterData("after","read",void 0,a,d,b))},this),error:Z(function(d){return c.apply(null,this._filterData("after","read",d,a,d.request.get("response"),b))},this)}))})},a.prototype.readAll=function(a,b,c){return this.optionsForCollection(b,function(a,d){var e;e=this._filterData("before","readAll",a,b),a=e[0],b=e[1];if(a)c(a);else{b&&b.url&&(d.url=b.url,delete b.url);return new x.Request(k(d,{data:b,method:"GET",success:Z(function(a){return c.apply(null,this._filterData("after","readAll",void 0,a,b))},this),error:Z(function(a){return c.apply(null,this._filterData("after","readAll",a,a.request.get("response"),b))},this)}))}})},a.prototype.after("readAll",l(function(a){var b,c,d;b=a[0],c=a[1],d=b[this.collectionJsonNamespace]?b[this.collectionJsonNamespace]:b;return[d,b,c]})),a.prototype.after("readAll",l(function(a){var b,c,d,e;d=a[0],e=a[1],c=a[2];return[function(){var a,c,e;e=[];for(a=0,c=d.length;a<c;a++)b=d[a],e.push(this.getRecordFromData(b));return e}.call(this),e,c]})),a.prototype.destroy=function(a,b,c){return this.optionsForRecord(a,!0,function(d,e){var f;f=this._filterData("before","destroy",d,a,b),d=f[0],a=f[1],b=f[2];if(d)c(d);else return new x.Request(k(e,{method:"DELETE",success:Z(function(d){return c.apply(null,this._filterData("after","destroy",void 0,a,d,b))},this),error:Z(function(d){return c.apply(null,this._filterData("after","destroy",d,a,d.request.get("response"),b))},this)}))})};return a}(),x.ViewSourceCache=function(){function a(){a.__super__.constructor.apply(this,arguments),this.sources={},this.requests={}}Y(a,x.Object),a.prototype.propertyClass=x.Property,a.accessor({get:function(a){var b;if(this.sources[a]!=null)return this.sources[a];this.requests[a]==null&&(this.requests=new x.Request({url:b=""+x.View.prototype.prefix+"/"+a,type:"html",success:Z(function(b){return this.set(a,b)},this),error:function(a){throw new Error("Could not load view from "+b)}}))},set:function(a,b){return this.sources[a]=b}});return a}(),x.View=function(){function a(b){var c,d;this.contexts=[],a.__super__.constructor.call(this,b);if(c=this.get("context"))this.contexts.push(c),this.unset("context");(d=this.get("node"))?this.render(d):this.observe("node",Z(function(a){return this.render(a)},this))}Y(a,x.Object),a.sourceCache=new x.ViewSourceCache,a.prototype.source="",a.prototype.html="",a.prototype.node=null,a.prototype.contentFor=null,a.prototype.event("ready").oneShot=!0,a.prototype.prefix="views",a.accessor("html",function(){var a;if(this.html&&this.html.length>0)return this.html;a=this.get("source");if(!!a)return this.html=this.constructor.sourceCache.get(a)}),a.accessor("node",{get:function(){var a;if(!this.node){a=this.get("html");if(!(a&&a.length>0))return;this.node=document.createElement("div"),r(this.node,a)}return this.node},set:function(a,b){return this.node=b}}),a.prototype.render=function(a){this.event("ready").resetOneShot(),this._renderer&&this._renderer.forgetAll();if(a){this._renderer=new x.Renderer(a,Z(function(){var c,d;d=this.contentFor,typeof d=="string"&&(this.contentFor=x.DOM._yields[d]);if(this.contentFor&&a){r(this.contentFor,"");return b(this.contentFor,a)}if(d)return(c=x.DOM._yieldContents[d])?c.push(a):x.DOM._yieldContents[d]=[a]},this),this.contexts);return this._renderer.on("rendered",Z(function(){return this.fire("ready",a)},this))}};return a}(),x.Renderer=function(){function g(a,b,c){var d;this.node=a,c==null&&(c=[]),this.resume=Z(this.resume,this),this.start=Z(this.start,this),g.__super__.constructor.call(this),b!=null&&this.on("parsed",b),this.context=c instanceof x.RenderContext?c:(d=x.RenderContext).start.apply(d,c),this.timeout=q(this.start)}var a,b,c,d,e,f;Y(g,x.Object),g.prototype.deferEvery=50,g.prototype.start=function(){this.startTime=new Date;return this.parseNode(this.node)},g.prototype.resume=function(){this.startTime=new Date;return this.parseNode(this.resumeNode)},g.prototype.finish=function(){this.startTime=null,this.fire("parsed");return this.fire("rendered")},g.prototype.stop=function(){clearTimeout(this.timeout);return this.fire("stopped")},g.prototype.forgetAll=function(){},f=["parsed","rendered","stopped"];for(d=0,e=f.length;d<e;d++)b=f[d],g.prototype.event(b).oneShot=!0;a=/^data\-(.*)/,c=function(a,b){return a[0]==="foreach"?-1:b[0]==="foreach"?1:a[0]==="formfor"?-1:b[0]==="formfor"?1:a[0]==="bind"?-1:b[0]==="bind"?1:0},g.prototype.parseNode=function(b){var d,e,f,g,h,i,j,k,l,m,n,o,p,r,s,t;if(this.deferEvery&&new Date-this.startTime>this.deferEvery)this.resumeNode=b,this.timeout=q(this.resume);else{if(b.getAttribute&&b.attributes){e=function(){var c,e,f,h,i;f=b.attributes,i=[];for(c=0,e=f.length;c<e;c++){d=f[c],g=(h=d.nodeName.match(a))!=null?h[1]:void 0;if(!g)continue;i.push(~(l=g.indexOf("-"))?[g.substr(0,l),g.substr(l+1),d.value]:[g,d.value])}return i}(),t=e.sort(c);for(o=0,p=t.length;o<p;o++){i=t[o],f=i[1],j=i.length===2?typeof (m=x.DOM.readers)[r=i[0]]=="function"?m[r](b,f,this.context,this):void 0:typeof (n=x.DOM.attrReaders)[s=i[0]]=="function"?n[s](b,f,i[2],this.context,this):void 0;if(j===!1){k=!0;break}j instanceof x.RenderContext&&(this.context=j)}}return(h=this.nextNode(b,k))?this.parseNode(h):this.finish()}},g.prototype.nextNode=function(a,b){var c,d,e,f,g;if(!b){c=a.childNodes;if(c!=null?c.length:void 0)return c[0]}typeof (g=x.data(a,"onParseExit"))=="function"&&g();if(this.node!==a){f=a.nextSibling;if(f)return f;d=a;while(d=d.parentNode){typeof d.onParseExit=="function"&&d.onParseExit();if(this.node===d)return;e=d.nextSibling;if(e)return e}}};return g}(),z=function(){function e(){var a,b,c,d;e.__super__.constructor.apply(this,arguments),this.parseFilter(),this.node&&((a=x.data(this.node,"bindings"))?a.add(this):x.data(this.node,"bindings",new x.Set(this))),this.nodeChange||(this.nodeChange=Z(function(a,b){if(this.key&&this.filterFunctions.length===0)return this.get("keyContext").set(this.key,this.node.value)},this)),this.dataChange||(this.dataChange=function(a,b){return x.DOM.valueForNode(this.node,a)}),b=!0,((c=this.only)===!1||c==="nodeChange")&&x.DOM.nodeIsEditable(this.node)&&x.DOM.events.change(this.node,Z(function(){b=!1,this.nodeChange(this.node,this.get("keyContext")||this.value,this);return b=!0},this)),((d=this.only)===!1||d==="dataChange")&&this.observeAndFire("filteredValue",Z(function(a){if(b)return this.dataChange(a,this.node,this)},this)),this}var a,b,c,d;Y(e,x.Object),d=/(^|,)\s*(?!(?:true|false)\s*(?:$|,))([a-zA-Z][\w\.]*)\s*($|,)/g,b=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,c=/(?!^\s*)\[(.*?)\]/g,a=function(a){return a instanceof x.RenderContext.ContextProxy?a.get("proxiedObject"):a},e.accessor("filteredValue",function(){var b,c;c=this.get("unfilteredValue");if(this.filterFunctions.length>0){b=this.filterFunctions.reduce(Z(function(b,c,d){var e;e=this.filterArguments[d].map(function(a){return a._keypath?a.context.get(a._keypath):a}),e.unshift(b),e=e.map(a);return c.apply(this.renderContext,e)},this),c);return b}return a(c)}),e.accessor("unfilteredValue",function(){var a;return(a=this.get("key"))?this.get("keyContext."+a):this.get("value")}),e.accessor("keyContext",function(){return this.renderContext.findKey(this.key)[1]}),e.prototype.destroy=function(){var a,b;this.forget(),this._batman.properties.forEach(function(a,b){return b.removeSourceHandlers()}),b=[];for(a in this){if(!W.call(this,a))continue;b.push(delete this[a])}return b},e.prototype.parseFilter=function(){var a,d,e,f,g,h,i,j,k;this.filterFunctions=[],this.filterArguments=[],i=this.keyPath;while(b.test(i))i=i.replace(b,"]['$1']");g=i.replace(c," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{h=this.parseSegment(j=g.shift())[0]}catch(l){}h&&h._keypath?this.key=h._keypath:this.value=h;if(g.length){while(f=g.shift()){k=f.indexOf(" "),~k?(e=f.substr(0,k),a=f.substr(k)):e=f;if(d=x.Filters[e]){this.filterFunctions.push(d);if(a)try{this.filterArguments.push(this.parseSegment(a))}catch(l){}else this.filterArguments.push([])}}return this.filterArguments=this.filterArguments.map(Z(function(a){return a.map(Z(function(a){var b,c;a._keypath&&(c=this.renderContext.findKey(a._keypath),b=c[0],a.context=c[1]);return a},this))},this))}},e.prototype.parseSegment=function(a){return JSON.parse("["+a.replace(d,'$1{"_keypath": "$2"}$3')+"]")};return e}(),x.RenderContext=function(){function b(a,b){this.object=a,this.parent=b}var a;b.start=function(){var a,b,c;b=1<=arguments.length?V.call(arguments,0):[],c=new this(window),x.currentApp&&b.push(x.currentApp);while(a=b.pop())c=c.descend(a);return c},b.prototype.findKey=function(a){var b,c,d;b=a.split(".")[0].split("|")[0].trim(),c=this;while(c){c.object.get!=null?d=c.object.get(b):d=c.object[b];if(typeof d!="undefined")return[h(c.object,a),c.object];c=c.parent}return[E.get(a),E]},b.prototype.descend=function(a,b){var c;b&&(c=a,a=new x.Object,a[b]=c);return new this.constructor(a,this)},b.prototype.descendWithKey=function(b,c){var d;d=new a(this,b);return this.descend(d,c)},b.prototype.bind=function(a,b,c,d,e){e==null&&(e=!1);return new z({renderContext:this,keyPath:b,node:a,dataChange:c,nodeChange:d,only:e})},b.prototype.chain=function(){var a,b;b=[],a=this;while(a)b.push(a.object),a=a.parent;return b},b.ContextProxy=a=function(){function a(a,b,c){this.renderContext=a,this.keyPath=b,this.localKey=c,this.binding=new z({renderContext:this.renderContext,keyPath:this.keyPath,only:"neither"})}Y(a,x.Object),a.prototype.isContextProxy=!0,a.accessor("proxiedObject",function(){return this.binding.get("filteredValue")}),a.accessor({get:function(a){return this.get("proxiedObject."+a)},set:function(a,b){return this.set("proxiedObject."+a,b)},unset:function(a){return this.unset("proxiedObject."+a)}});return a}();return b}.call(this),x.DOM={readers:{target:function(a,b,c,d){x.DOM.readers.bind(a,b,c,d,"nodeChange");return!0},source:function(a,b,c,d){x.DOM.readers.bind(a,b,c,d,"dataChange");return!0},bind:function(a,b,c,d,e){var f,g,h;switch(a.nodeName.toLowerCase()){case"input":switch(a.getAttribute("type")){case"checkbox":return x.DOM.attrReaders.bind(a,"checked",b,c,d,e);case"radio":return(f=x.DOM.binders).radio.apply(f,arguments);case"file":return(g=x.DOM.binders).file.apply(g,arguments)}break;case"select":return(h=x.DOM.binders).select.apply(h,arguments)}c.bind(a,b,void 0,void 0,e);return!0},context:function(a,b,c,d){return c.descendWithKey(b)},mixin:function(a,b,c){c.descend(x.mixins).bind(a,b,function(b){return k(a,b)},function(){});return!0},showif:function(a,b,c,d,e){var f;f=a.style.display||"",c.bind(a,b,function(b){var c,d;if(!!b==!e){(d=x.data(a,"show"))!=null&&d.call(a);return a.style.display=f}c=x.data(a,"hide");return typeof c=="function"?c.call(a):a.style.display="none"},function(){});return!0},hideif:function(){var a,b;a=1<=arguments.length?V.call(arguments,0):[],(b=x.DOM.readers).showif.apply(b,V.call(a).concat([!0]));return!0},route:function(a,b,c){var d,e,f,h,i,j,k,l,m,o,p;if(b.substr(0,1)==="/")l=b;else{i=b.indexOf("#")>1,m=i?b.split("#"):b.split("/"),b=m[0],d=m[1],o=c.findKey("dispatcher"),h=o[0],e=o[1],i||(p=c.findKey(b),j=p[0],f=p[1]),h||(h=x.currentApp.dispatcher);if(i)l=h.findUrl({controller:b,action:d});else if(j instanceof x.Model)d||(d="show"),k=H.underscore(H.pluralize(g(j.constructor))),l=h.findUrl({resource:k,id:j.get("id"),action:d});else if(j!=null?j.prototype:void 0)d||(d="index"),k=H.underscore(H.pluralize(g(j))),l=h.findUrl({resource:k,action:d})}if(!!l){a.nodeName.toUpperCase()==="A"&&(a.href=x.HashHistory.prototype.urlFor(l)),x.DOM.events.click(a,function(){return n(l)});return!0}},partial:function(a,b,c,d){var e;d.prevent("rendered"),e=new x.View({source:b+".html",contentFor:a,contexts:c.chain()}),e.on("ready",function(){d.allow("rendered");return d.fire("rendered")});return!0},yield:function(a,b){q(function(){return x.DOM.yield(b,a)});return!0},contentfor:function(a,b){q(function(){return x.DOM.contentFor(b,a)});return!0},replace:function(a,b){q(function(){return x.DOM.replace(b,a)});return!0}},_yieldContents:{},_yields:{},attrReaders:{_parseAttribute:function(a){a==="false"&&(a=!1),a==="true"&&(a=!0);return a},source:function(a,b,c,d,e){return x.DOM.attrReaders.bind(a,b,c,d,e,"dataChange")},bind:function(a,b,c,d,e,f){var g,h;switch(b){case"checked":case"disabled":case"selected":g=function(c){var d;a[b]=!!c;return typeof (d=x.data(a.parentNode,"updateBinding"))=="function"?d():void 0},h=function(a,d){return d.set(c,x.DOM.attrReaders._parseAttribute(a[b]))},x.data(a,b,{context:d,key:c});break;case"value":case"href":case"src":case"size":g=function(c){return a[b]=c},h=function(a,d){return d.set(c,x.DOM.attrReaders._parseAttribute(a[b]))};break;case"class":g=function(b){return a.className=b},h=function(a,b){return b.set(c,a.className)};break;case"style":return x.DOM.binders.style(a,b,c,d,e,f);default:g=function(c){return a.setAttribute(b,c)},h=function(a,d){return d.set(c,x.DOM.attrReaders._parseAttribute(a.getAttribute(b)))}}d.bind(a,c,g,h,f);return!0},context:function(a,b,c,d){return d.descendWithKey(c,b)},event:function(a,b,c,d){var e,f;f={callback:null,subContext:null},d.bind(a,c,function(a,b,c){var d;f.callback=a;if(c.get("key")){d=c.get("key").split("."),d.pop();return d.length>0?f.subContext=c.get("keyContext").get(d.join(".")):f.subContext=c.get("keyContext")}},function(){}),e=a.getAttribute("data-confirm"),x.DOM.events[b](a,function(){var a;if(!e||!!confirm(e))return(a=f.callback)!=null?a.apply(f.subContext,arguments):void 0});return!0},addclass:function(a,b,c,d,e,f){b=b.replace(/\|/g," "),d.bind(a,c,function(c){var d,e;d=a.className,e=d.indexOf(b)!==-1;if(!!c==!f){if(!e)return a.className=""+d+" "+b}else if(e)return a.className=d.replace(b,"")},function(){});return!0},removeclass:function(){var a,b;a=1<=arguments.length?V.call(arguments,0):[];return(b=x.DOM.attrReaders).addclass.apply(b,V.call(a).concat([!0]))},foreach:function(a,b,c,d,e){(function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d})(x.DOM.Iterator,arguments,function(){});return!1},formfor:function(a,b,c,d){x.DOM.events.submit(a,function(a,b){return m(b)});return d.descendWithKey(c,b)}},binders:{select:function(a,b,c,d,e){new x.DOM.Select(a,b,c,d,e);return!0},style:function(a,b,c,d,e,f){new x.DOM.Style(a,c,d);return!0},radio:function(a,b,c,d,e){var f,g;f=function(d){var e,f,g;g=c.findKey(b),e=g[0],f=g[1];if(e)return a.checked=e===a.value;if(a.checked)return f.set(b,a.value)},g=function(c,d){return d.set(b,x.DOM.attrReaders._parseAttribute(a.value))},c.bind(a,b,f,g,e);return!0},file:function(a,b,c,d,e){c.bind(a,b,function(){},function(a,c){var d,e,f,g,h,i,j;g=b.split("."),g.length>1?f=c.get(g.slice(0,-1).join(".")):f=c,f instanceof x.RenderContext.ContextProxy?d=f.get("proxiedObject"):d=f;if(d.hasStorage&&d.hasStorage()){j=d._batman.get("storage");for(h=0,i=j.length;h<i;h++)e=j[h],e instanceof x.RestStorage&&(e.defaultOptions.formData=!0)}return a.hasAttribute("multiple")?c.set(b,Array.prototype.slice.call(a.files)):c.set(b,a.files[0])},e);return!0}},events:{click:function(b,c,d){d==null&&(d="click"),a(b,d,function(){var a;a=1<=arguments.length?V.call(arguments,0):[],c.apply(null,[b].concat(V.call(a)));return m(a[0])}),b.nodeName.toUpperCase()==="A"&&!b.href&&(b.href="#");return b},doubleclick:function(a,b){return x.DOM.events.click(a,b,"dblclick")},change:function(b,c){var d,e,f,g,h,i;e=function(){switch(b.nodeName.toUpperCase()){case"TEXTAREA":return["keyup","change"];case"INPUT":if(b.type.toUpperCase()==="TEXT"){f=c,c=function(a){var b;if(!(a.type==="keyup"&&13<=(b=a.keyCode)&&b<=14))return f.apply(null,arguments)};return["keyup","change"]}return["change"];default:return["change"]}}(),i=[];for(g=0,h=e.length;g<h;g++)d=e[g],i.push(a(b,d,function(){var a;a=1<=arguments.length?V.call(arguments,0):[];return c.apply(null,[b].concat(V.call(a)))}));return i},submit:function(b,c){x.DOM.nodeIsEditable(b)?a(b,"keyup",function(){var a;a=1<=arguments.length?V.call(arguments,0):[];if(a[0].keyCode===13||a[0].which===13||a[0].keyIdentifier==="Enter"||a[0].key==="Enter"){m(a[0]);return c.apply(null,[b].concat(V.call(a)))}}):a(b,"submit",function(){var a;a=1<=arguments.length?V.call(arguments,0):[],m(a[0]);return c.apply(null,[b].concat(V.call(a)))});return b}},yield:function(a,c,d){var e,f,g,h;d==null&&(d=!x.data(c,"yielded")),x.DOM._yields[a]=c;if(f=x.DOM._yieldContents[a]){d&&r(c,"",!0);for(g=0,h=f.length;g<h;g++)e=f[g],x.data(e,"yielded")||(j(c,e)&&(e=e.cloneNode(!0)),b(c,e,!0),x.data(e,"yielded",!0));delete x.DOM._yieldContents[a];return x.data(c,"yielded",!0)}},contentFor:function(a,b,c){var d,e;d=x.DOM._yieldContents[a],d?d.push(b):x.DOM._yieldContents[a]=[b];if(e=x.DOM._yields[a])return x.DOM.yield(a,e,c)},replace:function(a,b){return x.DOM.contentFor(a,b,!0)},trackBinding:s=function(a,b){var c;return(c=x.data(b,"bindings"))?c.add(a):x.data(b,"bindings",new x.SimpleSet(a))},unbindNode:u=function(a){var b,c,d,e;(b=x.data(a,"bindings"))&&b.forEach(function(a){return a.destroy()});if(e=x.data(a,"listeners"))for(d in e)c=e[d],c.forEach(function(b){return o(a,d,b)});return x.removeData(a)},unbindTree:v=function(a,b){var c,d,e,f,g;b==null&&(b=!0);if((a!=null?a.nodeType:void 0)===1){b&&u(a),f=a.childNodes,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(v(c));return g}},setInnerHTML:r=function(){var a,b,c,d,e,f,g,h;e=arguments[0],d=arguments[1],a=3<=arguments.length?V.call(arguments,2):[],h=e.childNodes;for(f=0,g=h.length;f<g;f++)b=h[f],(c=x.data(b,"hide"))&&c.apply(b,a);v(e,!1);return e!=null?e.innerHTML=d:void 0},removeNode:p=function(a){var b;v(a);return a!=null?(b=a.parentNode)!=null?b.removeChild(a):void 0:void 0},appendChild:b=function(){var a,b,c,d;c=arguments[0],b=arguments[1],a=3<=arguments.length?V.call(arguments,2):[],(d=x.data(b,"show"))!=null&&d.apply(b,a);return c.appendChild(b)},valueForNode:function(a,b){var c;b==null&&(b=""),c=arguments.length>1;switch(a.nodeName.toUpperCase()){case"INPUT":return c?a.value=b:a.value;case"TEXTAREA":return c?a.innerHTML=a.value=b:a.innerHTML;case"SELECT":return a.value=b;default:return c?r(a,b):a.innerHTML}},nodeIsEditable:function(a){var b;return(b=a.nodeName.toUpperCase())==="INPUT"||b==="TEXTAREA"||b==="SELECT"},addEventListener:a=function(a,b,c){var d;(d=x.data(a,"listeners"))||(d=x.data(a,"listeners",{})),d[b]||(d[b]=new x.Set),d[b].add(c);return i?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeEventListener:o=function(a,b,c){var d,e;(e=x.data(a,"listeners"))&&(d=e[b])&&d.remove(c);return i?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},hasAddEventListener:i=typeof window!="undefined"&&window!==null?!!window.addEventListener:!!void 0},x.DOM.AbstractBinding=function(){function a(a){x.DOM.trackBinding(this,a)}a.prototype.destroy=function(){};return a}(),x.DOM.Select=function(){function a(b,c,d,e,f){this.node=b,this.key=c,this.context=d,this.renderer=e,this.only=f,this.updateOptionBindings=Z(this.updateOptionBindings,this),this.updateSelectBinding=Z(this.updateSelectBinding,this),this.nodeChange=Z(this.nodeChange,this),this.dataChange=Z(this.dataChange,this),a.__super__.constructor.apply(this,arguments),this.container=d.findKey(c)[1],e.on("rendered",Z(function(){x.data(b,"updateBinding",this.updateSelectBinding);return d.bind(b,c,this.dataChange,this.nodeChange,f)},this))}Y(a,x.DOM.AbstractBinding),a.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(a instanceof Array){f={},m=this.node.children;for(g=0,j=m.length;g<j;g++)b=m[g],b.selected=!1,d=f[b.value],d?d.push(b):d=[b],f[b.value]=d;for(h=0,k=a.length;h<k;h++){e=a[h],n=f[e];for(i=0,l=n.length;i<l;i++)c=n[i],c.selected=!0}}else this.node.value=a;return this.updateOptionBindings()},a.prototype.nodeChange=function(){this.updateSelectBinding();return this.updateOptionBindings()},a.prototype.updateSelectBinding=function(){var a,b;b=this.node.multiple?function(){var b,c,d,e;d=this.node.children,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.selected&&e.push(a.value);return e}.call(this):this.node.value,b.length===1&&(b=b[0]);return this.container.set(this.key,b)},a.prototype.updateOptionBindings=function(){var a,b,c,d,e,f,g,h,i,j,k;i=this.node.children,k=[];for(g=0,h=i.length;g<h;g++)a=i[g],k.push((b=x.data(a,"selected"))?(e=b.context)&&(f=b.key)?(j=e.findKey(f),c=j[0],d=j[1],j,a.selected!==c?d.set(f,a.selected):void 0):void 0:void 0);return k};return a}(),x.DOM.Style=function(){function a(b,c,d){this.node=b,this.key=c,this.context=d,this.unbindCurrentHash=Z(this.unbindCurrentHash,this),this.reapplyOldStyles=Z(this.reapplyOldStyles,this),this.setStyle=Z(this.setStyle,this),this.bindSingleAttribute=Z(this.bindSingleAttribute,this),this.onItemsRemoved=Z(this.onItemsRemoved,this),this.onItemsAdded=Z(this.onItemsAdded,this),this.dataChange=Z(this.dataChange,this),this.destroy=Z(this.destroy,this),a.__super__.constructor.apply(this,arguments),this.oldStyles={},d.bind(b,c,this.dataChange,function(){})}Y(a,x.DOM.AbstractBinding),a.prototype.destroy=function(){var a,b;this.unbindCurrentHash(),b=[];for(a in this){if(!W.call(this,a))continue;b.push(delete this[a])}return b},a.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(!a)this.reapplyOldStyles();else{this.unbindCurrentHash();if(typeof a=="string"&&(this.boundValueType="string")){this.reapplyOldStyles(),k=a.split(";");for(i=0,j=k.length;i<j;i++)h=k[i],l=h.split(":"),b=l[0],c=l[1],this.setStyle(b,c);return}if(a instanceof x.Hash&&(this.boundValueType="batman.hash")){this.styleHash=a,a.on("itemsWereAdded",this.onItemsAdded),a.on("itemsWereRemoved",this.onItemsRemoved);return a.keys().forEach(Z(function(a){return this.onItemsAdded(a)},this))}if(a instanceof Object&&(this.boundValueType="object")){this.reapplyOldStyles(),n=[];for(d in a){if(!W.call(a,d))continue;e=a[d],m=this.context.findKey(e),g=m[0],f=m[1],n.push(g?(this.bindSingleAttribute(d,e),this.setStyle(d,g)):this.setStyle(d,e))}return n}}},a.prototype.onItemsAdded=function(a){return this.setStyle(a,this.styleHash.get(a))},a.prototype.onItemsRemoved=function(a){return this.setStyle(a,"")},a.prototype.bindSingleAttribute=function(a,b){var c;c=Z(function(b){return this.setStyle(a,b)},this);return this.context.bind(this.node,b,c,function(){})},a.prototype.setStyle=function(a,b){if(!!a){a=a.trim(),this.oldStyles[a]=this.node.style[a];return this.node.style[a]=b?b.trim():""}},a.prototype.reapplyOldStyles=function(){var a,b,c,d;c=this.oldStyles,d=[];for(a in c){if(!W.call(c,a))continue;b=c[a],d.push(this.setStyle(a,b))}return d},a.prototype.unbindCurrentHash=function(){if(this.styleHash){this.styleHash.event("itemsWereRemoved").removeHandler(this.onItemsRemoved);return this.styleHash.event("itemsWereAdded").removeHandler(this.onItemsAdded)}};return a}(),x.DOM.Iterator=function(){function a(b,c,d,e,f){this.iteratorName=c,this.key=d,this.context=e,this.parentRenderer=f,this.arrayChanged=Z(this.arrayChanged,this),this.collectionChange=Z(this.collectionChange,this),this.nodeMap=new x.SimpleHash,this.actionMap=new x.SimpleHash,this.rendererMap=new x.SimpleHash,this.actions=[],this.prototypeNode=b.cloneNode(!0),this.prototypeNode.removeAttribute("data-foreach-"+c),this.parentNode=b.parentNode,this.siblingNode=b.nextSibling,this.parentRenderer.on("parsed",Z(function(){this.prototypeNode[x.expando]=b[x.expando],delete b[x.expando];return p(b)},this)),this.parentRenderer.prevent("rendered"),a.__super__.constructor.call(this,this.parentNode),this.fragment=document.createDocumentFragment(),e.bind(b,d,this.collectionChange,function(){})}Y(a,x.DOM.AbstractBinding),a.prototype.deferEvery=50,a.prototype.currentActionNumber=0,a.prototype.queuedActionNumber=0,a.prototype.destroy=function(){var a;u(this.prototypeNode),this.unbindCollection();for(a in this){if(!W.call(this,a))continue;delete this[a]}return this.destroyed=!0},a.prototype.unbindCollection=function(){if(this.collection){this.nodeMap.forEach(function(a,b){return p(b)}),this.nodeMap.clear(),this.rendererMap.forEach(function(a,b){return b.stop()}),this.rendererMap.clear();if(this.collection.isObservable&&this.collection.toArray)return this.collection.forget("toArray",this.arrayChanged);if(this.collection.isEventEmitter){this.collection.event("itemsWereAdded").removeHandler(this.currentAddedHandler);return this.collection.event("itemsWereRemoved").removeHandler(this.currentRemovedHandler)}}},a.prototype.collectionChange=function(a){var b,c,d;a!==this.collection&&this.unbindCollection(),this.collection=a;if(this.collection){this.collection.isObservable&&this.collection.toArray?this.collection.observe("toArray",this.arrayChanged):this.collection.isEventEmitter&&(this.collection.on("itemsWereAdded",this.currentAddedHandler=Z(function(){var a,b,c,d,e;c=1<=arguments.length?V.call(arguments,0):[],e=[];for(a=0,d=c.length;a<d;a++)b=c[a],e.push(this.addItem(b,{fragment:!0}));return e},this)),this.collection.on("itemsWereRemoved",this.currentRemovedHandler=Z(function(){var a,b,c,d,e;c=1<=arguments.length?V.call(arguments,0):[],e=[];for(a=0,d=c.length;a<d;a++)b=c[a],e.push(this.removeItem(b));return e},this)));if(this.collection.toArray)this.arrayChanged();else if(this.collection.forEach)this.collection.forEach(Z(function(a){return this.addItem(a)},this));else{d=this.collection;for(b in d){if(!W.call(d,b))continue;c=d[b],this.addItem(b)}}}return this.processActionQueue()},a.prototype.arrayChanged=function(){var a,b,c,d,e,f;c=this.collection.toArray(),d=new x.SimpleHash;for(e=0,f=c.length;e<f;e++)b=c[e],a=this.nodeMap.get(b),d.set(b,!0),a?this.insertItem(b,a,{fragment:!1,actionNumber:this.queuedActionNumber++,sync:!0}):this.addItem(b,{fragment:!1});return this.nodeMap.forEach(Z(function(a,b){if(!d.hasKey(a))return this.removeItem(a)},this))},a.prototype.addItem=function(a,b){var c,d,e;b==null&&(b={fragment:!0}),this.parentRenderer.prevent("rendered"),e=this,b.actionNumber=this.queuedActionNumber++,c=new x.Renderer(this._nodeForItem(a),function(){return e.insertItem(a,this.node,b)},this.context.descend(a,this.iteratorName)),this.rendererMap.set(a,c),d=Z(function(){if(!this.destroyed){this.parentRenderer.allow("rendered");return this.parentRenderer.fire("rendered")}},this),c.on("rendered",d),c.on("stopped",Z(function(){if(!this.destroyed){this.actions[b.actionNumber]=function(){},d();return this.processActionQueue()}},this));return a},a.prototype.removeItem=function(a){var b,c;if(!this.destroyed){this._removeOldAction(a),c=this.nodeMap.unset(a);if(c)return(b=x.data(c,"hide"))?b.call(c):p(c)}},a.prototype.insertItem=function(a,b,c){var d,e,f,g,h;c==null&&(c={});if(!this.destroyed){d=this.actionMap.get(a),d!=null&&d>c.actionNumber?this.actions[c.actionNumber]=function(){}:(this._removeOldAction(a),this.actionMap.set(a,c.actionNumber),this.nodeMap.get(a)!==b?(e=this.actions)[g=c.actionNumber]||(e[g]=function(){}):(this.rendererMap.unset(a),(f=this.actions)[h=c.actionNumber]||(f[h]=function(){var a;a=x.data(b,"show");return typeof a=="function"?a.call(b,{before:this.siblingNode}):c.fragment?this.fragment.appendChild(b):this.parentNode.insertBefore(b,this.siblingNode)}))),this.actions[c.actionNumber].item=a;return this.processActionQueue()}},a.prototype._nodeForItem=function(a){var b;b=this.prototypeNode.cloneNode(!0),this.nodeMap.set(a,b);return b},a.prototype._removeOldAction=function(a){var b;b=this.actionMap.get(a);if(b!=null&&b>this.currentActionNumber){this.actionMap.unset(a);return this.actions[b]=function(){}}},a.prototype.processActionQueue=function(){if(!this.destroyed&&!this.actionQueueTimeout)return this.actionQueueTimeout=q(Z(function(){var a,b;if(!this.destroyed){delete this.actionQueueTimeout,b=new Date;while(!!(a=this.actions[this.currentActionNumber])){this.actions[this.currentActionNumber]=!0,a.call(this),this.currentActionNumber++;if(this.deferEvery&&new Date-b>this.deferEvery)return this.processActionQueue()}this.fragment&&this.rendererMap.length===0&&this.fragment.hasChildNodes()&&(this.parentNode.insertBefore(this.fragment,this.siblingNode),this.fragment=document.createDocumentFragment());if(this.currentActionNumber===this.queuedActionNumber){this.parentRenderer.allow("rendered");return this.parentRenderer.fire("rendered")}}},this))};return a}(),B=function(a){return function(b){if(typeof b!="undefined")return a.apply(this,arguments)}},G=x.Filters={get:B(function(a,b){return a.get!=null?a.get(b):a[b]}),equals:B(function(a,b){return a===b}),not:function(a){return!a},truncate:B(function(a,b,c){c==null&&(c="..."),a.length>b&&(a=a.substr(0,b-c.length)+c);return a}),"default":function(a,b){return a||b},prepend:function(a,b){return b+a},append:function(a,b){return a+b},downcase:B(function(a){return a.toLowerCase()}),upcase:B(function(a){return a.toUpperCase()}),pluralize:B(function(a,b){return H.pluralize(b,a)}),join:B(function(a,b){b==null&&(b="");return a.join(b)}),sort:B(function(a){return a.sort()}),map:B(function(a,b){return a.map(function(a){return a[b]})}),first:B(function(a){return a[0]}),meta:B(function(a,b){return a.meta.get(b)}),interpolate:function(a,b){var c,d,e;if(a!=null){e={};for(c in b)d=b[c],e[c]=this.findKey(d)[0],e[c]==null&&(x.developer.warn("Warning! Undefined interpolation key "+c+" for interpolation",a),e[c]="");return x.helpers.interpolate(a,e)}}},T=["capitalize","singularize","underscore","camelize"];for(P=0,R=T.length;P<R;P++)J=T[P],G[J]=B(H[J]);k(x,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:!0,noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?x.cache[a[x.expando]]:a[x.expando];return!!a&&!I(a)},data:function(a,b,c,d){var e,f,g,h,i,j,l;if(!!x.acceptData(a)){h=x.expando,f=typeof b=="string",i=a.nodeType,e=i?x.cache:a,g=i?a[x.expando]:a[x.expando]&&x.expando;if((!g||d&&g&&e[g]&&!e[g][h])&&f&&c===void 0)return;g||(i?a[x.expando]=g=++x.uuid:g=x.expando),e[g]||(e[g]={});if(typeof b=="object"||typeof b=="function")d?e[g][h]=k(e[g][h],b):e[g]=k(e[g],b);l=e[g],d&&(l[h]||(l[h]={}),l=l[h]),c!==void 0&&(l[H.camelize(b,!0)]=c),f?(j=l[b],j==null&&(j=l[H.camelize(b,!0)])):j=l;return j}},removeData:function(a,b,c){var d,e,f,g,h,i;if(!!x.acceptData(a)){g=x.expando,h=a.nodeType,d=h?x.cache:a,e=h?a[x.expando]:x.expando;if(!d[e])return;if(b){i=c?d[e][g]:d[e];if(i){i[b]||(b=H.camelize(b,!0)),delete i[b];if(!I(i))return}}if(c){delete d[e][g];if(!I(d[e]))return}f=d[e][g],x.canDeleteExpando||!d.setInterval?delete d[e]:d[e]=null;if(f){d[e]={};return d[e][g]=f}if(h)return x.canDeleteExpando?delete a[x.expando]:a.removeAttribute?a.removeAttribute(x.expando):a[x.expando]=null}},_data:function(a,b,c){return x.data(a,b,c,!0)},acceptData:function(a){var b;if(a.nodeName){b=x.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),I=function(a){var b;for(b in a)return!1;return!0};try{F=document.createElement("div"),delete F.test}catch(_){x.canDeleteExpando=!1}K=x.mixins=new x.Object,x.Encoders={railsDate:{encode:function(a){return a},decode:function(a){var b;b=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(a);if(b)return new Date(Date.UTC(+b[1],+b[2]-1,+b[3],+b[4],+b[5],+b[6]))}}},x.Paginator=function(){function a(){a.__super__.constructor.apply(this,arguments)}Y(a,x.Object),a.Cache=function(){function a(a,b,c){this.offset=a,this.limit=b,this.items=c,this.length=c.length,this.reach=a+b}a.prototype.containsItemsForOffsetAndLimit=function(a,b){return a>=this.offset&&a+b<=this.reach},a.prototype.itemsForOffsetAndLimit=function(a,b){var c,d;if(!!this.containsItemsForOffsetAndLimit(a,b)){c=a-this.offset,d=c+b;return this.items.slice(c,d)}};return a}(),a.prototype.offset=0,a.prototype.limit=10,a.prototype.totalCount=0,a.prototype.offsetFromPageAndLimit=function(a,b){return Math.round((+a-1)*b)},a.prototype.pageFromOffsetAndLimit=function(a,b){return a/b+1},a.prototype.toArray=function(){var a,b,c,d;a=this.get("cache"),d=this.get("offset"),c=this.get("limit"),b=a!=null?a.itemsForOffsetAndLimit(d,c):void 0,b||this.loadItemsForOffsetAndLimit(d,c);return b||[]},a.prototype.page=function(){return this.pageFromOffsetAndLimit(this.get("offset"),this.get("limit"))},a.prototype.pageCount=function(){return Math.ceil(this.get("totalCount")/this.get("limit"))},a.prototype.previousPage=function(){return this.set("page",this.get("page")-1)},a.prototype.nextPage=function(){return this.set("page",this.get("page")+1)},a.prototype.loadItemsForOffsetAndLimit=function(a,b){},a.prototype.updateCache=function(a,b,c){return this.set("cache",new x.Paginator.Cache(a,b,c))},a.accessor("toArray",a.prototype.toArray),a.accessor("offset","limit","totalCount",{get:x.Property.defaultAccessor.get,set:function(a,b){return x.Property.defaultAccessor.set.call(this,a,+b)}}),a.accessor("page",{get:a.prototype.page,set:function(a,b){b=+b,this.set("offset",this.offsetFromPageAndLimit(b,this.get("limit")));return b}}),a.accessor("pageCount",a.prototype.pageCount);return a}(),x.ModelPaginator=function(){function a(){a.__super__.constructor.apply(this,arguments)}Y(a,x.Paginator),a.prototype.cachePadding=0,a.prototype.paddedOffset=function(a){a-=this.cachePadding;return a<0?0:a},a.prototype.paddedLimit=function(a){return a+this.cachePadding*2},a.prototype.loadItemsForOffsetAndLimit=function(a,b){var c,d,e,f;d=this.paramsForOffsetAndLimit(a,b),f=this.params;for(c in f)e=f[c],d[c]=e;return this.model.load(d,Z(function(a,b){if(a==null)return this.updateCache(this.offsetFromParams(d),this.limitFromParams(d),b)},this))},a.prototype.paramsForOffsetAndLimit=function(a,b){return{offset:this.paddedOffset(a),limit:this.paddedLimit(b)}},a.prototype.offsetFromParams=function(a){return a.offset},a.prototype.limitFromParams=function(a){return a.limit};return a}(),E=typeof exports!="undefined"&&exports!==null?(module.exports=x,global):(window.Batman=x,window),k(E,x.Observable),x.exportHelpers=function(a){var b,c,d,e;e=["mixin","unmixin","route","redirect","typeOf","redirect","setImmediate"];for(c=0,d=e.length;c<d;c++)b=e[c],a["$"+b]=x[b];return a},x.exportGlobals=function(){return x.exportHelpers(E)},x.Request.prototype.send=function(a){var b,c;b={url:this.get("url"),type:this.get("method"),dataType:this.get("type"),data:a||this.get("data"),username:this.get("username"),password:this.get("password"),beforeSend:Z(function(){return this.fire("loading")},this),success:Z(function(a,b,c){this.set("status",c.status),this.set("response",a);return this.fire("success",a)},this),error:Z(function(a,b,c){this.set("status",a.status),this.set("response",a.responseText),a.request=this;return this.fire("error",a)},this),complete:Z(function(){return this.fire("loaded")},this)};if((c=this.get("method"))==="PUT"||c==="POST")this.get("formData")?(b.contentType=!1,b.processData=!1,b.data=this.constructor.objectToFormData(b.data)):b.contentType=this.get("contentType");return jQuery.ajax(b)},x.mixins.animation={show:function(a){var b,c,d,e;b=$(this),c=function(){return b.show(600)},a?((d=a.append)!=null&&d.appendChild(this),(e=a.before)!=null&&e.parentNode.insertBefore(this,a.before),b.hide(),setTimeout(c,0)):c();return this},hide:function(a){$(this).hide(600,Z(function(){var b;if(a)return(b=this.parentNode)!=null?b.removeChild(this):void 0},this));return this}}}).call(this)
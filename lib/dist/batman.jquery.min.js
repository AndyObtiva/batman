!function(){var t,e=[].slice;t=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(t.Object,n,function(){})},t.version="0.14.1",t.config={pathToApp:"/",pathToHTML:"html",fetchRemoteHTML:!0,usePushState:!0,minificationErrors:!0},(t.container=function(){return this}()).Batman=t,"function"==typeof define&&define("batman",[],function(){return t}),t.exportHelpers=function(e){var n,r,o,i;for(i=["mixin","extend","unmixin","redirect","typeOf","redirect","setImmediate","clearImmediate"],r=0,o=i.length;o>r;r++)n=i[r],e["$"+n]=t[n];return e},t.exportGlobals=function(){return t.exportHelpers(t.container)}}.call(this),function(){var t;Batman._Batman=t=function(){function t(t){this.object=t}return t.prototype.check=function(t){return t!==this.object?(t._batman=new Batman._Batman(t),!1):!0},t.prototype.get=function(t){var e,n;switch(n=this.getAll(t),n.length){case 0:return void 0;case 1:return n[0];default:return e=null!=n[0].concat?function(t,e){return t.concat(e)}:null!=n[0].merge?function(t,e){return t.merge(e)}:n.every(function(t){return"object"==typeof t})?(n.unshift({}),function(t,e){return Batman.extend(t,e)}):void 0,e?n.reduceRight(e):n}},t.prototype.getFirst=function(t){var e;return e=this.getAll(t),e[0]},t.prototype.getAll=function(t){var e,n,r;return e="function"==typeof t?t:function(e){var n;return null!=(n=e._batman)?n[t]:void 0},n=this.ancestors(e),(r=e(this.object))&&n.unshift(r),n},t.prototype.ancestors=function(t){var e,n,r,o,i,a;if(this._allAncestors||(this._allAncestors=this.allAncestors()),t){for(n=[],a=this._allAncestors,o=0,i=a.length;i>o;o++)e=a[o],r=t(e),null!=r&&n.push(r);return n}return this._allAncestors},t.prototype.allAncestors=function(){var t,e,n,r,o,i;return r=[],t=!!this.object.prototype,e=t?null!=(o=this.object.__super__)?o.constructor:void 0:(n=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:n,null!=e&&(null!=(i=e._batman)&&i.check(e),r.push(e),null!=e._batman&&(r=r.concat(e._batman.allAncestors()))),r},t.prototype.set=function(t,e){return this[t]=e},t}()}.call(this),function(){var t,e,n,r,o,i,a,s,u=[].slice,c={}.hasOwnProperty,l=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.typeOf=function(t){return"undefined"==typeof t?"Undefined":i.call(t).slice(8,-1)},i=Object.prototype.toString,Batman.extend=function(){var t,e,n,r,o,i,a;for(r=arguments[0],n=2<=arguments.length?u.call(arguments,1):[],i=0,a=n.length;a>i;i++){e=n[i];for(t in e)o=e[t],r[t]=o}return r},Batman.mixin=function(){var t,e,n,r,o,i,a,s;for(o=arguments[0],r=2<=arguments.length?u.call(arguments,1):[],t="function"==typeof o.set,a=0,s=r.length;s>a;a++)if(n=r[a],"Object"===Batman.typeOf(n)){for(e in n)c.call(n,e)&&(i=n[e],"initialize"!==e&&"uninitialize"!==e&&"prototype"!==e&&(t?o.set(e,i):null!=o.nodeName?Batman.data(o,e,i):o[e]=i));"function"==typeof n.initialize&&n.initialize.call(o)}return o},Batman.unmixin=function(){var t,e,n,r,o,i;for(t=arguments[0],r=2<=arguments.length?u.call(arguments,1):[],o=0,i=r.length;i>o;o++){n=r[o];for(e in n)"initialize"!==e&&"uninitialize"!==e&&delete t[e];"function"==typeof n.uninitialize&&n.uninitialize.call(t)}return t},Batman._functionName=Batman.functionName=function(t){var e;return t.__name__?t.__name__:t.name?t.name:null!=(e=t.toString().match(/\W*function\s+([\w\$]+)\(/))?e[1]:void 0},Batman._isChildOf=Batman.isChildOf=function(t,e){var n;for(n=e.parentNode;n;){if(n===t)return!0;n=n.parentNode}return!1},o=function(t){var e,n,r,o,i,a,s;return e=function(){var e,n;return t.postMessage?(e=!0,n=t.onmessage,t.onmessage=function(){return e=!1},t.postMessage("","*"),t.onmessage=n,e):!1},s=new Batman.SimpleHash,n=0,o=function(){return"go"+ ++n},t.setImmediate&&t.clearImmediate?(Batman.setImmediate=function(){return t.setImmediate.apply(t,arguments)},Batman.clearImmediate=function(){return t.clearImmediate.apply(t,arguments)}):e()?(a="com.batman.",i=function(t){var e,n;if("string"==typeof t.data&&~t.data.search(a))return e=t.data.substring(a.length),"function"==typeof(n=s.unset(e))?n():void 0},t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),Batman.setImmediate=function(e){var n;return s.set(n=o(),e),t.postMessage(a+n,"*"),n},Batman.clearImmediate=function(t){return s.unset(t)}):"undefined"!=typeof document&&l.call(document.createElement("script"),"onreadystatechange")>=0?(Batman.setImmediate=function(){var t,e;return t=o(),e=document.createElement("script"),e.onreadystatechange=function(){var n;return"function"==typeof(n=s.get(t))&&n(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},document.documentElement.appendChild(e),t},Batman.clearImmediate=function(t){return s.unset(t)}):("undefined"!=typeof process&&null!==process?process.nextTick:void 0)?(r={},Batman.setImmediate=function(t){var e;return e=o(),r[e]=t,process.nextTick(function(){return"function"==typeof r[e]&&r[e](),delete r[e]}),e},Batman.clearImmediate=function(t){return delete r[t]}):(Batman.setImmediate=function(t){return setTimeout(t,0)},Batman.clearImmediate=function(t){return clearTimeout(t)})},Batman.setImmediate=function(){return o(Batman.container),Batman.setImmediate.apply(this,arguments)},Batman.clearImmediate=function(){return o(Batman.container),Batman.clearImmediate.apply(this,arguments)},Batman.forEach=function(t,e,n){var r,o,i,a,s,u,c,l;if(t.forEach)return t.forEach(e,n);if(t.indexOf){for(c=[],o=s=0,u=t.length;u>s;o=++s)r=t[o],c.push(e.call(n,r,o,t));return c}l=[];for(i in t)a=t[i],l.push(e.call(n,i,a,t));return l},Batman.objectHasKey=function(t,e){return"function"==typeof t.hasKey?t.hasKey(e):e in t},Batman.contains=function(t,e){return t.indexOf?l.call(t,e)>=0:"function"==typeof t.has?t.has(e):Batman.objectHasKey(t,e)},Batman.get=function(t,e){return"function"==typeof t.get?t.get(e):Batman.Property.forBaseAndKey(t,e).getValue()},Batman.getPath=function(t,e){var n,r,o;for(r=0,o=e.length;o>r;r++){if(n=e[r],null==t)return void 0;if(t=Batman.get(t,n),null==t)return t}return t},r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},a=[],e=[];for(t in r)a.push(t),e.push(r[t]);s=new RegExp("["+a.join("")+"]","g"),n=new RegExp("("+e.join("|")+")","g"),Batman.escapeHTML=function(){return function(t){return(""+t).replace(s,function(t){return r[t]})}}(),Batman.unescapeHTML=function(){return function(t){var e;if(null!=t)return e=Batman._unescapeHTMLNode||(Batman._unescapeHTMLNode=document.createElement("DIV")),e.innerHTML=t,Batman.DOM.textContent(e)}}(),Batman.translate=function(t,e){return null==e&&(e={}),Batman.helpers.interpolate(Batman.get(Batman.translate.messages,t),e)},Batman.translate.messages={},Batman.t=function(){return Batman.translate.apply(Batman,arguments)},Batman.redirect=function(t,e){var n;return null==e&&(e=!1),null!=(n=Batman.navigator)?n.redirect(t,e):void 0},Batman.initializeObject=function(t){return null!=t._batman?t._batman.check(t):t._batman=new Batman._Batman(t)}}.call(this),function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.Inflector=function(){function n(){this._plural=[],this._singular=[],this._uncountable=[],this._human=[]}return n.prototype.plural=function(t,e){return this._plural.unshift([t,e])},n.prototype.singular=function(t,e){return this._singular.unshift([t,e])},n.prototype.human=function(t,e){return this._human.unshift([t,e])},n.prototype.uncountable=function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],this._uncountable=this._uncountable.concat(e.map(function(t){return new RegExp(""+t+"$","i")}))},n.prototype.irregular=function(t,e){return t.charAt(0)===e.charAt(0)?(this.plural(new RegExp("("+t.charAt(0)+")"+t.slice(1)+"$","i"),"$1"+e.slice(1)),this.plural(new RegExp("("+t.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+e.slice(1)),this.singular(new RegExp("("+e.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+t.slice(1))):(this.plural(new RegExp(""+t+"$","i"),e),this.plural(new RegExp(""+e+"$","i"),e),this.singular(new RegExp(""+e+"$","i"),t))},n.prototype.ordinalize=function(t,n){var r,o;if(null==n&&(n=10),t=parseInt(t,n),r=Math.abs(t),o=r%100,e.call([11,12,13],o)>=0)return t+"th";switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd";default:return t+"th"}},n.prototype.pluralize=function(t){var e,n,r,o,i,a,s,u,c,l;for(u=this._uncountable,o=0,a=u.length;a>o;o++)if(r=u[o],r.test(t))return t;for(c=this._plural,i=0,s=c.length;s>i;i++)if(l=c[i],e=l[0],n=l[1],e.test(t))return t.replace(e,n);return t},n.prototype.singularize=function(t){var e,n,r,o,i,a,s,u,c,l;for(u=this._uncountable,o=0,a=u.length;a>o;o++)if(r=u[o],r.test(t))return t;for(c=this._singular,i=0,s=c.length;s>i;i++)if(l=c[i],e=l[0],n=l[1],e.test(t))return t.replace(e,n);return t},n.prototype.humanize=function(t){var e,n,r,o,i,a;for(i=this._human,r=0,o=i.length;o>r;r++)if(a=i[r],e=a[0],n=a[1],e.test(t))return t.replace(e,n);return t},n}()}.call(this),function(){var t,e,n,r,o,i,a,s;e=/(?:^|_|\-)(.)/g,n=/(^|\s)([a-z])/g,a=/([A-Z]+)([A-Z][a-z])/g,s=/([a-z\d])([A-Z])/g,r=/_id$/,o=/_|-/g,i=/^\w/g,Batman.helpers={ordinalize:function(){return Batman.helpers.inflector.ordinalize.apply(Batman.helpers.inflector,arguments)},singularize:function(){return Batman.helpers.inflector.singularize.apply(Batman.helpers.inflector,arguments)},pluralize:function(t,e,n,r){var o;return null==r&&(r=!0),arguments.length<2?Batman.helpers.inflector.pluralize(t):(o=1===+t?e:n||Batman.helpers.inflector.pluralize(e),r&&(o=""+(t||0)+" "+o),o)},camelize:function(t,n){return t=t.replace(e,function(t,e){return e.toUpperCase()}),n?t.substr(0,1).toLowerCase()+t.substr(1):t},underscore:function(t){return t.replace(a,"$1_$2").replace(s,"$1_$2").replace("-","_").toLowerCase()},capitalize:function(t){return t.replace(n,function(t,e,n){return e+n.toUpperCase()})},trim:function(t){return t?t.trim():""},interpolate:function(t,e){var n,r,o;"object"==typeof t?(r=t[e.count],r||(r=t.other)):r=t;for(n in e)o=e[n],r=r.replace(new RegExp("%\\{"+n+"\\}","g"),o);return r},humanize:function(t){return t=Batman.helpers.underscore(t),t=Batman.helpers.inflector.humanize(t),t.replace(r,"").replace(o," ").replace(i,function(t){return t.toUpperCase()})}},t=new Batman.Inflector,Batman.helpers.inflector=t,t.plural(/$/,"s"),t.plural(/s$/i,"s"),t.plural(/(ax|test)is$/i,"$1es"),t.plural(/(octop|vir)us$/i,"$1i"),t.plural(/(octop|vir)i$/i,"$1i"),t.plural(/(alias|status)$/i,"$1es"),t.plural(/(bu)s$/i,"$1ses"),t.plural(/(buffal|tomat)o$/i,"$1oes"),t.plural(/([ti])um$/i,"$1a"),t.plural(/([ti])a$/i,"$1a"),t.plural(/sis$/i,"ses"),t.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),t.plural(/(hive)$/i,"$1s"),t.plural(/([^aeiouy]|qu)y$/i,"$1ies"),t.plural(/(x|ch|ss|sh)$/i,"$1es"),t.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),t.plural(/([m|l])ouse$/i,"$1ice"),t.plural(/([m|l])ice$/i,"$1ice"),t.plural(/^(ox)$/i,"$1en"),t.plural(/^(oxen)$/i,"$1"),t.plural(/(quiz)$/i,"$1zes"),t.singular(/s$/i,""),t.singular(/(n)ews$/i,"$1ews"),t.singular(/([ti])a$/i,"$1um"),t.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"),t.singular(/(^analy)ses$/i,"$1sis"),t.singular(/([^f])ves$/i,"$1fe"),t.singular(/(hive)s$/i,"$1"),t.singular(/(tive)s$/i,"$1"),t.singular(/([lr])ves$/i,"$1f"),t.singular(/([^aeiouy]|qu)ies$/i,"$1y"),t.singular(/(s)eries$/i,"$1eries"),t.singular(/(m)ovies$/i,"$1ovie"),t.singular(/(x|ch|ss|sh)es$/i,"$1"),t.singular(/([m|l])ice$/i,"$1ouse"),t.singular(/(bus)es$/i,"$1"),t.singular(/(o)es$/i,"$1"),t.singular(/(shoe)s$/i,"$1"),t.singular(/(cris|ax|test)es$/i,"$1is"),t.singular(/(octop|vir)i$/i,"$1us"),t.singular(/(alias|status)es$/i,"$1"),t.singular(/^(ox)en/i,"$1"),t.singular(/(vert|ind)ices$/i,"$1ex"),t.singular(/(matr)ices$/i,"$1ix"),t.singular(/(quiz)zes$/i,"$1"),t.singular(/(database)s$/i,"$1"),t.irregular("person","people"),t.irregular("man","men"),t.irregular("child","children"),t.irregular("sex","sexes"),t.irregular("move","moves"),t.irregular("cow","kine"),t.irregular("zombie","zombies"),t.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans")}.call(this),function(){var t;Batman.developer={suppressed:!1,DevelopmentError:function(){var t;return t=function(t){return this.message=t,this.name="DevelopmentError"},t.prototype=Error.prototype,t}(),_ie_console:function(t,e){var n,r,o,i;for(1!==e.length&&"undefined"!=typeof console&&null!==console&&console[t]("..."+t+" of "+e.length+" items..."),i=[],r=0,o=e.length;o>r;r++)n=e[r],i.push("undefined"!=typeof console&&null!==console?console[t](n):void 0);return i},suppress:function(e){return t.suppressed=!0,e?(e(),t.suppressed=!1):void 0},unsuppress:function(){return t.suppressed=!1},log:function(){return t.suppressed||null==("undefined"!=typeof console&&null!==console?console.log:void 0)?void 0:console.log.apply?console.log.apply(console,arguments):t._ie_console("log",arguments)},warn:function(){return t.suppressed||null==("undefined"!=typeof console&&null!==console?console.warn:void 0)?void 0:console.warn.apply?console.warn.apply(console,arguments):t._ie_console("warn",arguments)},error:function(e){throw new t.DevelopmentError(e)},assert:function(e,n){return e?void 0:t.error(n)},"do":function(e){return t.suppressed?void 0:e()},addFilters:function(){return Batman.extend(Batman.Filters,{log:function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log(arguments),t},logStack:function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log(t.currentFilterStack),e}})},deprecated:function(t,e){return Batman.developer.warn(""+t+" has been deprecated.",e||"")}},t=Batman.developer,Batman.developer.assert(function(){}.bind,"Error! Batman needs Function.bind to work! Please shim it using something like es5-shim or augmentjs!")}.call(this),function(){Batman.Event=function(){function t(t,e){this.base=t,this.key=e,this._preventCount=0}return t.forBaseAndKey=function(t,e){return t.isEventEmitter?t.event(e):new Batman.Event(t,e)},t.prototype.isEvent=!0,t.prototype.isEqual=function(t){return this.constructor===t.constructor&&this.base===t.base&&this.key===t.key},t.prototype.hashKey=function(){var t;return this.hashKey=function(){return t},t="<Batman.Event base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">'},t.prototype.addHandler=function(t){return this.handlers||(this.handlers=[]),-1===this.handlers.indexOf(t)&&this.handlers.push(t),this.oneShot&&this.autofireHandler(t),this},t.prototype.removeHandler=function(t){var e;return this.handlers&&-1!==(e=this.handlers.indexOf(t))&&this.handlers.splice(e,1),this},t.prototype.eachHandler=function(t){var e,n,r,o,i,a,s,u,c,l,p,h,d;if(null!=(i=this.handlers)&&i.slice().forEach(t),null!=(a=this.base)?a.isEventEmitter:void 0){for(n=this.key,u=null!=(s=this.base._batman)?s.ancestors():void 0,d=[],r=0,o=u.length;o>r;r++)e=u[r],e.isEventEmitter&&(null!=(c=e._batman)?null!=(l=c.events)?l.hasOwnProperty(n):void 0:void 0)?d.push(null!=(p=e.event(n,!1))?null!=(h=p.handlers)?h.slice().forEach(t):void 0:void 0):d.push(void 0);return d}},t.prototype.clearHandlers=function(){return this.handlers=void 0},t.prototype.handlerContext=function(){return this.base},t.prototype.prevent=function(){return++this._preventCount},t.prototype.allow=function(){return this._preventCount&&--this._preventCount,this._preventCount},t.prototype.isPrevented=function(){return this._preventCount>0},t.prototype.autofireHandler=function(t){return this._oneShotFired&&null!=this._oneShotArgs?t.apply(this.handlerContext(),this._oneShotArgs):void 0},t.prototype.resetOneShot=function(){return this._oneShotFired=!1,this._oneShotArgs=null},t.prototype.fire=function(){return this.fireWithContext(this.handlerContext(),arguments)},t.prototype.fireWithContext=function(t,e){return this.isPrevented()||this._oneShotFired?!1:(this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=e),this.eachHandler(function(n){return n.apply(t,e)}))},t.prototype.allowAndFire=function(){return this.allowAndFireWithContext(this.handlerContext,arguments)},t.prototype.allowAndFireWithContext=function(t,e){return this.allow(),this.fireWithContext(t,e)},t}()}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PropertyEvent=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.eachHandler=function(t){return this.eachObserver(t)},r.prototype.handlerContext=function(){return this.base},r}(Batman.Event)}.call(this),function(){var t=[].slice;Batman.EventEmitter={isEventEmitter:!0,hasEvent:function(t){var e,n;return null!=(e=this._batman)?"function"==typeof e.get?null!=(n=e.get("events"))?n.hasOwnProperty(t):void 0:void 0:void 0},event:function(t,e){var n,r,o,i,a,s,u,c,l,p,h,d;if(null==e&&(e=!0),Batman.initializeObject(this),r=this.eventClass||Batman.Event,null!=(l=this._batman.events)?l.hasOwnProperty(t):void 0)return i=this._batman.events[t];for(p=this._batman.ancestors(),u=0,c=p.length;c>u&&(n=p[u],!(i=null!=(h=n._batman)?null!=(d=h.events)?d[t]:void 0:void 0));u++);return e||(null!=i?i.oneShot:void 0)?(o=(s=this._batman).events||(s.events={}),a=o[t]=new r(this,t),a.oneShot=null!=i?i.oneShot:void 0,a):i},on:function(){var e,n,r,o,i,a,s;for(r=2<=arguments.length?t.call(arguments,0,o=arguments.length-1):(o=0,[]),e=arguments[o++],s=[],i=0,a=r.length;a>i;i++)n=r[i],s.push(this.event(n).addHandler(e));return s},off:function(){var e,n,r,o,i,a,s;for(r=2<=arguments.length?t.call(arguments,0,o=arguments.length-1):(o=0,[]),e=arguments[o++],r.length||(n=e,this.event(n).clearHandlers()),s=[],i=0,a=r.length;a>i;i++)n=r[i],s.push(this.event(n).removeHandler(e));return s},once:function(t,e){var n,r;return n=this.event(t),r=function(){return e.apply(this,arguments),n.removeHandler(r)},n.addHandler(r)},registerAsMutableSource:function(){return Batman.Property.registerSource(this)},mutation:function(t){return function(){var e,n;return e=t.apply(this,arguments),null!=(n=this.event("change",!1))&&n.fire(this,this),e}},prevent:function(t){return this.event(t).prevent(),this},allow:function(t){return this.event(t).allow(),this},isPrevented:function(t){var e;return null!=(e=this.event(t,!1))?e.isPrevented():void 0},fire:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],null!=(r=this.event(n,!1))?r.fireWithContext(this,e):void 0},allowAndFire:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],null!=(r=this.event(n,!1))?r.allowAndFireWithContext(this,e):void 0}}}.call(this),function(){var t=[].slice;Batman.Enumerable={isEnumerable:!0,map:function(t,e){var n;return null==e&&(e=Batman.container),n=[],this.forEach(function(){return n.push(t.apply(e,arguments))}),n},mapToProperty:function(t){var e;return e=[],this.forEach(function(n){return e.push(n.get(t))}),e},every:function(t,e){var n;return null==e&&(e=Batman.container),n=!0,this.forEach(function(){return n=n&&t.apply(e,arguments)}),n},some:function(t,e){var n;return null==e&&(e=Batman.container),n=!1,this.forEach(function(){return n=n||t.apply(e,arguments)}),n},reduce:function(e,n){var r,o,i;return r=0,i=this,o=null!=n?!0:!1,this.forEach(function(){return o?n=e.apply(null,[n].concat(t.call(arguments),[r],[i])):(n=arguments[0],o=!0,void 0)}),n},filter:function(t){var e,n;return e=new this.constructor,e.add?n=function(e,n){return t(n)&&e.add(n),e}:e.set?n=function(e,n,r){return t(n,r)&&e.set(n,r),e}:(e.push||(e=[]),n=function(e,n){return t(n)&&e.push(n),e}),this.reduce(n,e)},inGroupsOf:function(t){var e,n,r;return r=[],e=!1,n=0,this.forEach(function(o){return 0===n++%t&&(e=[],r.push(e)),e.push(o)}),r}}}.call(this),function(){var t,e=[].slice;t=Object.prototype.toString,Batman.SimpleHash=function(){function n(t){this._storage={},this.length=0,null!=t&&this.update(t)}return Batman.extend(n.prototype,Batman.Enumerable),n.prototype.hasKey=function(t){var e,n,r,o;if(this.objectKey(t)){if(!this._objectStorage)return!1;if(n=this._objectStorage[this.hashKeyFor(t)])for(r=0,o=n.length;o>r;r++)if(e=n[r],this.equality(e[0],t))return!0;return!1}return t=this.prefixedKey(t),this._storage.hasOwnProperty(t)},n.prototype.get=function(t){var e,n,r,o;if(!this.objectKey(t))return this._storage[this.prefixedKey(t)];if(!this._objectStorage)return void 0;if(n=this._objectStorage[this.hashKeyFor(t)])for(r=0,o=n.length;o>r;r++)if(e=n[r],this.equality(e[0],t))return e[1]},n.prototype.set=function(t,e){var n,r,o,i,a,s;if(this.objectKey(t)){for(this._objectStorage||(this._objectStorage={}),r=(o=this._objectStorage)[s=this.hashKeyFor(t)]||(o[s]=[]),i=0,a=r.length;a>i;i++)if(n=r[i],this.equality(n[0],t))return n[1]=e;return this.length++,r.push([t,e]),e}return t=this.prefixedKey(t),null==this._storage[t]&&this.length++,this._storage[t]=e},n.prototype.unset=function(t){var e,n,r,o,i,a,s,u,c,l;if(!this.objectKey(t))return t=this.prefixedKey(t),a=this._storage[t],null!=this._storage[t]&&(this.length--,delete this._storage[t]),a;if(!this._objectStorage)return void 0;if(e=this.hashKeyFor(t),i=this._objectStorage[e])for(n=u=0,c=i.length;c>u;n=++u)if(l=i[n],r=l[0],s=l[1],this.equality(r,t))return o=i.splice(n,1),i.length||delete this._objectStorage[e],this.length--,o[0][1]},n.prototype.getOrSet=function(t,e){var n;return n=this.get(t),n||(n=e(),this.set(t,n)),n},n.prototype.prefixedKey=function(t){return"_"+t},n.prototype.unprefixedKey=function(t){return t.slice(1)},n.prototype.hashKeyFor=function(e){var n,r;return(n=null!=e?"function"==typeof e.hashKey?e.hashKey():void 0:void 0)?n:(r=t.call(e),"[object Array]"===r?r:e)},n.prototype.equality=function(t,e){return t===e?!0:t!==t&&e!==e?!0:(null!=t?"function"==typeof t.isEqual?t.isEqual(e):void 0:void 0)&&(null!=e?"function"==typeof e.isEqual?e.isEqual(t):void 0:void 0)?!0:!1},n.prototype.objectKey=function(t){return"string"!=typeof t},n.prototype.forEach=function(t,e){var n,r,o,i,a,s,u,c,l,p,h;if(o=[],this._objectStorage){c=this._objectStorage;for(n in c)for(a=c[n],l=a.slice(),s=0,u=l.length;u>s;s++)p=l[s],r=p[0],i=p[1],o.push(t.call(e,r,i,this))}h=this._storage;for(n in h)i=h[n],o.push(t.call(e,this.unprefixedKey(n),i,this));return o},n.prototype.keys=function(){var t;return t=[],Batman.SimpleHash.prototype.forEach.call(this,function(e){return t.push(e)}),t},n.prototype.toArray=n.prototype.keys,n.prototype.clear=function(){return this._storage={},delete this._objectStorage,this.length=0},n.prototype.isEmpty=function(){return 0===this.length},n.prototype.merge=function(){var t,n,r,o,i;for(r=1<=arguments.length?e.call(arguments,0):[],n=new this.constructor,r.unshift(this),o=0,i=r.length;i>o;o++)t=r[o],t.forEach(function(t,e){return n.set(t,e)});return n},n.prototype.update=function(t){var e,n,r;r=[];for(e in t)n=t[e],r.push(this.set(e,n));return r},n.prototype.replace=function(t){var e=this;return this.forEach(function(n){return n in t?void 0:e.unset(n)}),this.update(t)},n.prototype.toObject=function(){var t,e,n,r,o,i;e={},o=this._storage;for(t in o)r=o[t],e[this.unprefixedKey(t)]=r;if(this._objectStorage){i=this._objectStorage;for(t in i)n=i[t],e[t]=n[0][1]}return e},n.prototype.toJSON=n.prototype.toObject,n}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.AssociationCurator=function(t){function r(t){this.model=t,r.__super__.constructor.call(this),this._byTypeStorage=new Batman.SimpleHash}return e(r,t),r.availableAssociations=["belongsTo","hasOne","hasMany"],r.prototype.add=function(t){var e;return this.set(t.label,t),(e=this._byTypeStorage.get(t.associationType))||(e=new Batman.SimpleSet,this._byTypeStorage.set(t.associationType,e)),e.add(t)},r.prototype.getByType=function(t){return this._byTypeStorage.get(t)},r.prototype.getByLabel=function(t){return this.get(t)},r.prototype.reset=function(){return this.forEach(function(t,e){return e.reset()}),!0},r.prototype.merge=function(){var t,e;return t=1<=arguments.length?n.call(arguments,0):[],e=r.__super__.merge.apply(this,arguments),e._byTypeStorage=this._byTypeStorage.merge(t.map(function(t){return t._byTypeStorage})),e},r.prototype._markDirtyAttribute=function(t,e){var n;if("loading"!==(n=this.lifecycle.get("state"))&&"creating"!==n&&"saving"!==n&&"saved"!==n){if(this.lifecycle.startTransition("set"))return this.dirtyKeys.set(t,e);throw new Batman.StateMachine.InvalidTransitionError("Can't set while in state "+this.lifecycle.get("state"))}},r}(Batman.SimpleHash)}.call(this),function(){var t=[].slice;Batman.SimpleSet=function(){function e(){var t,e;this._storage=[],this.length=0,e=function(){var e,n,r;for(r=[],e=0,n=arguments.length;n>e;e++)t=arguments[e],null!=t&&r.push(t);return r}.apply(this,arguments),e.length>0&&this.add.apply(this,e)}return Batman.extend(e.prototype,Batman.Enumerable),e.prototype.has=function(t){return!!~this._indexOfItem(t)},e.prototype.add=function(){var e,n,r,o,i;for(r=1<=arguments.length?t.call(arguments,0):[],e=[],o=0,i=r.length;i>o;o++)n=r[o],~this._indexOfItem(n)||(this._storage.push(n),e.push(n));return this.length=this._storage.length,this.fire&&0!==e.length&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereAdded"].concat(t.call(e)))),e},e.prototype.remove=function(){var e,n,r,o,i,a;for(r=1<=arguments.length?t.call(arguments,0):[],o=[],i=0,a=r.length;a>i;i++)n=r[i],~(e=this._indexOfItem(n))&&(this._storage.splice(e,1),o.push(n));return this.length=this._storage.length,this.fire&&0!==o.length&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(t.call(o)))),o},e.prototype.find=function(t){var e,n,r,o;for(o=this._storage,n=0,r=o.length;r>n;n++)if(e=o[n],t(e))return e},e.prototype.forEach=function(t,e){var n,r,o,i,a;for(i=this._storage,a=[],r=0,o=i.length;o>r;r++)n=i[r],a.push(t.call(e,n,null,this));return a},e.prototype.isEmpty=function(){return 0===this.length},e.prototype.clear=function(){var e;return e=this._storage,this._storage=[],this.length=0,this.fire&&0!==e.length&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(t.call(e)))),e},e.prototype.replace=function(t){try{return"function"==typeof this.prevent&&this.prevent("change"),this.clear(),this.add.apply(this,t.toArray())}finally{"function"==typeof this.allowAndFire&&this.allowAndFire("change",this,this)}},e.prototype.toArray=function(){return this._storage.slice()},e.prototype.merge=function(){var e,n,r,o,i;for(n=1<=arguments.length?t.call(arguments,0):[],e=new this.constructor,n.unshift(this),o=0,i=n.length;i>o;o++)r=n[o],r.forEach(function(t){return e.add(t)});return e},e.prototype.indexedBy=function(t){return this._indexes||(this._indexes=new Batman.SimpleHash),this._indexes.get(t)||this._indexes.set(t,new Batman.SetIndex(this,t))},e.prototype.indexedByUnique=function(t){return this._uniqueIndexes||(this._uniqueIndexes=new Batman.SimpleHash),this._uniqueIndexes.get(t)||this._uniqueIndexes.set(t,new Batman.UniqueSetIndex(this,t))},e.prototype.sortedBy=function(t,e){var n;return null==e&&(e="asc"),e="desc"===e.toLowerCase()?"desc":"asc",this._sorts||(this._sorts=new Batman.SimpleHash),n=this._sorts.get(t)||this._sorts.set(t,new Batman.Object),n.get(e)||n.set(e,new Batman.SetSort(this,t,e))},e.prototype.equality=Batman.SimpleHash.prototype.equality,e.prototype._indexOfItem=function(t){var e,n,r,o,i;for(i=this._storage,e=r=0,o=i.length;o>r;e=++r)if(n=i[e],this.equality(t,n))return e;return-1},e}()}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=[],e=!0,Batman.Property=function(n){function o(t,e){this.base=t,this.key=e}return r(o,n),o._sourceTrackerStack=t,o._sourceTrackerStackValid=e,o.defaultAccessor={get:function(t){return this[t]},set:function(t,e){return this[t]=e},unset:function(t){var e;return e=this[t],delete this[t],e},cache:!1},o.defaultAccessorForBase=function(t){var e;return(null!=(e=t._batman)?e.getFirst("defaultAccessor"):void 0)||Batman.Property.defaultAccessor},o.accessorForBaseAndKey=function(t,e){var n,r,o,i,a,s,u,c,l;if(null!=(o=t._batman)&&(n=null!=(s=o.keyAccessors)?s.get(e):void 0,!n))for(u=o.ancestors(),i=0,a=u.length;a>i&&(r=u[i],!(n=null!=(c=r._batman)?null!=(l=c.keyAccessors)?l.get(e):void 0:void 0));i++);return n||this.defaultAccessorForBase(t)},o.forBaseAndKey=function(t,e){return t.isObservable?t.property(e):new Batman.Keypath(t,e)},o.withoutTracking=function(t){return this.wrapTrackingPrevention(t)()},o.wrapTrackingPrevention=function(t){return function(){Batman.Property.pushDummySourceTracker();try{return t.apply(this,arguments)}finally{Batman.Property.popSourceTracker()}}},o.registerSource=function(n){var r;if(n.isEventEmitter||n instanceof Batman.Property)return e?r=t[t.length-1]:(r=[],t.push(r),e=!0),null!=r&&r.push(n),void 0},o.pushSourceTracker=function(){return e?e=!1:t.push([])},o.popSourceTracker=function(){return e?t.pop():(e=!0,void 0)},o.pushDummySourceTracker=function(){return e||(t.push([]),e=!0),t.push(null)},o.prototype._isolationCount=0,o.prototype.cached=!1,o.prototype.value=null,o.prototype.sources=null,o.prototype.isProperty=!0,o.prototype.isDead=!1,o.prototype.registerAsMutableSource=function(){return Batman.Property.registerSource(this)},o.prototype.isEqual=function(t){return this.constructor===t.constructor&&this.base===t.base&&this.key===t.key},o.prototype.hashKey=function(){return this._hashKey||(this._hashKey="<Batman.Property base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">')},o.prototype.accessor=function(){return this._accessor||(this._accessor=this.constructor.accessorForBaseAndKey(this.base,this.key))},o.prototype.eachObserver=function(t){var e,n,r,o,i,a,s,u,c,l,p,h,d;if(r=this.key,n=null!=(l=this.handlers)?l.slice():void 0)for(a=0,u=n.length;u>a;a++)o=n[a],t(o);if(this.base.isObservable){for(p=this.base._batman.ancestors(),d=[],s=0,c=p.length;c>s;s++)e=p[s],e.isObservable&&e.hasProperty(r)?(i=e.property(r),n=null!=(h=i.handlers)?h.slice():void 0,n?d.push(function(){var e,r,i;for(i=[],e=0,r=n.length;r>e;e++)o=n[e],i.push(t(o));return i}()):d.push(void 0)):d.push(void 0);return d}},o.prototype.observers=function(){var t;return t=[],this.eachObserver(function(e){return t.push(e)}),t},o.prototype.hasObservers=function(){return this.observers().length>0},o.prototype.updateSourcesFromTracker=function(){var t,e,n,r,o,i,a,s,u;if(e=this.constructor.popSourceTracker(),t=this.sourceChangeHandler(),this.sources)for(s=this.sources,r=0,i=s.length;i>r;r++)n=s[r],null!=n&&(n.on?n.off("change",t):n.removeHandler(t));if(this.sources=e,this.sources)for(u=this.sources,o=0,a=u.length;a>o;o++)n=u[o],null!=n&&(n.on?n.on("change",t):n.addHandler(t));return null},o.prototype.getValue=function(){if(this.registerAsMutableSource(),!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor(),this.cached=!0}finally{this.updateSourcesFromTracker()}}return this.value},o.prototype.isCachable=function(){var t;return this.isFinal()?!0:(t=this.accessor().cache,null!=t?!!t:!0)},o.prototype.isCached=function(){return this.isCachable()&&this.cached},o.prototype.isFinal=function(){return!!this.accessor()["final"]},o.prototype.refresh=function(){var t,e;return this.cached=!1,t=this.value,e=this.getValue(),e===t||this.isIsolated()||this.fire(e,t,this.key),void 0!==this.value&&this.isFinal()?this.lockValue():void 0},o.prototype.sourceChangeHandler=function(){var t=this;return this._sourceChangeHandler||(this._sourceChangeHandler=this._handleSourceChange.bind(this)),Batman.developer["do"](function(){return t._sourceChangeHandler.property=t
}),this._sourceChangeHandler},o.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:this.isFinal()||this.hasObservers()?this.refresh():this.cached=!1},o.prototype.valueFromAccessor=function(){var t;return null!=(t=this.accessor().get)?t.call(this.base,this.key):void 0},o.prototype.setValue=function(t){var e;if(e=this.accessor().set)return this._changeValue(function(){return e.call(this.base,this.key,t)})},o.prototype.unsetValue=function(){var t;if(t=this.accessor().unset)return this._changeValue(function(){return t.call(this.base,this.key)})},o.prototype._changeValue=function(t){var e;this.cached=!1,this.constructor.pushDummySourceTracker();try{e=t.apply(this),this.refresh()}finally{this.constructor.popSourceTracker()}return this.isCached()||this.hasObservers()||this.die(),e},o.prototype.forget=function(t){return null!=t?this.removeHandler(t):this.clearHandlers()},o.prototype.observeAndFire=function(t){return this.observe(t),t.call(this.base,this.value,this.value,this.key)},o.prototype.observe=function(t){return this.addHandler(t),null==this.sources&&this.getValue(),this},o.prototype.observeOnce=function(t){var e,n;return n=this,e=function(){return t.apply(this,arguments),n.removeHandler(e)},this.addHandler(e),null==this.sources&&this.getValue(),this},o.prototype._removeHandlers=function(){var t,e,n,r,o;if(t=this.sourceChangeHandler(),this.sources)for(o=this.sources,n=0,r=o.length;r>n;n++)e=o[n],e.on?e.off("change",t):e.removeHandler(t);return delete this.sources,this.clearHandlers()},o.prototype.lockValue=function(){return this._removeHandlers(),this.getValue=function(){return this.value},this.setValue=this.unsetValue=this.refresh=this.observe=function(){}},o.prototype.die=function(){var t,e;return this._removeHandlers(),null!=(t=this.base._batman)&&null!=(e=t.properties)&&e.unset(this.key),this.isDead=!0},o.prototype.isolate=function(){return 0===this._isolationCount&&(this._preIsolationValue=this.getValue()),this._isolationCount++},o.prototype.expose=function(){return 1===this._isolationCount?(this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue,this.key),this._preIsolationValue=null):this._isolationCount>0?this._isolationCount--:void 0},o.prototype.isIsolated=function(){return this._isolationCount>0},o}(Batman.PropertyEvent)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Keypath=function(t){function n(t,e){"string"==typeof e?(this.segments=e.split("."),this.depth=this.segments.length):(this.segments=[e],this.depth=1),n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.isCachable=function(){return 1===this.depth?n.__super__.isCachable.apply(this,arguments):!0},n.prototype.terminalProperty=function(){var t;return t=Batman.getPath(this.base,this.segments.slice(0,-1)),null!=t?Batman.Keypath.forBaseAndKey(t,this.segments[this.depth-1]):void 0},n.prototype.valueFromAccessor=function(){return 1===this.depth?n.__super__.valueFromAccessor.apply(this,arguments):Batman.getPath(this.base,this.segments)},n.prototype.setValue=function(t){var e;return 1===this.depth?n.__super__.setValue.apply(this,arguments):null!=(e=this.terminalProperty())?e.setValue(t):void 0},n.prototype.unsetValue=function(){var t;return 1===this.depth?n.__super__.unsetValue.apply(this,arguments):null!=(t=this.terminalProperty())?t.unsetValue():void 0},n}(Batman.Property)}.call(this),function(){var t=[].slice;Batman.Observable={isObservable:!0,hasProperty:function(t){var e,n;return null!=(e=this._batman)?null!=(n=e.properties)?"function"==typeof n.hasKey?n.hasKey(t):void 0:void 0:void 0},property:function(t){var e,n,r;return Batman.initializeObject(this),n=this.propertyClass||Batman.Keypath,e=(r=this._batman).properties||(r.properties=new Batman.SimpleHash),e.get(t)||e.set(t,new n(this,t))},get:function(t){return this.property(t).getValue()},set:function(t,e){return this.property(t).setValue(e)},unset:function(t){return this.property(t).unsetValue()},getOrSet:Batman.SimpleHash.prototype.getOrSet,forget:function(t,e){var n;return t?this.property(t).forget(e):null!=(n=this._batman.properties)&&n.forEach(function(t,e){return e.forget()}),this},observe:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],(r=this.property(n)).observe.apply(r,e),this},observeAndFire:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],(r=this.property(n)).observeAndFire.apply(r,e),this},observeOnce:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],(r=this.property(n)).observeOnce.apply(r,e),this}}}.call(this),function(){Batman.DOM={textInputTypes:["text","search","tel","url","email","password"],scrollIntoView:function(t){var e;return null!=(e=document.getElementById(t))?"function"==typeof e.scrollIntoView?e.scrollIntoView():void 0:void 0},partial:function(t,e,n,r){var o;return r.prevent("rendered"),o=new Batman.View({source:e,context:n}),o.on("ready",function(){return Batman.DOM.setInnerHTML(t,""),Batman.DOM.appendChild(t,o.get("node")),r.allowAndFire("rendered")})},propagateBindingEvent:function(t,e){for(var n,r,o,i,a;n=(n||e).parentNode;)if(o=Batman._data(n,"bindings"),null!=o)for(i=0,a=o.length;a>i;i++)r=o[i],"function"==typeof r.childBindingAdded&&r.childBindingAdded(t)},propagateBindingEvents:function(t){var e,n,r,o,i,a,s,u;for(u=t.childNodes,o=0,a=u.length;a>o;o++)r=u[o],Batman.DOM.propagateBindingEvents(r);if(n=Batman._data(t,"bindings"))for(i=0,s=n.length;s>i;i++)e=n[i],Batman.DOM.propagateBindingEvent(e,t)},trackBinding:function(t,e){var n;return(n=Batman._data(e,"bindings"))?n.push(t):Batman._data(e,"bindings",[t]),Batman.DOM.fire("bindingAdded",t),Batman.DOM.propagateBindingEvent(t,e),!0},onParseExit:function(t,e){var n;return n=Batman._data(t,"onParseExit")||Batman._data(t,"onParseExit",new Batman.SimpleSet),null!=e&&n.add(e),n},forgetParseExit:function(t){return Batman.removeData(t,"onParseExit",!0)},defineView:function(t,e){var n;return n=e.innerHTML,Batman.View.store.set(Batman.Navigator.normalizePath(t),n),n},setStyleProperty:function(t,e,n,r){return t.style.setProperty?t.style.setProperty(e,n,r):t.style.setAttribute(e,n,r)},removeOrDestroyNode:function(t){var e;return e=Batman._data(t,"view"),e||(e=Batman._data(t,"yielder")),null!=e&&e.get("cached")?Batman.DOM.removeNode(t):Batman.DOM.destroyNode(t)},insertBefore:function(t,e,n){return null==n&&(n=null),!n||t.childNodes.length<=0?Batman.DOM.appendChild(t,e):(Batman.DOM.willInsertNode(e),t.insertBefore(e,n),Batman.DOM.didInsertNode(e))},valueForNode:function(t,e,n){var r,o,i,a,s,u,c;switch(null==e&&(e=""),null==n&&(n=!0),o=arguments.length>1,i=t.nodeName.toUpperCase()){case"INPUT":case"TEXTAREA":return o?t.value=e:t.value;case"SELECT":if(o)return t.value=e;if(t.multiple){for(u=t.children,c=[],a=0,s=u.length;s>a;a++)r=u[a],r.selected&&c.push(r.value);return c}return t.value;default:return o?("OPTION"===i&&(t.text=e),Batman.DOM.setInnerHTML(t,n?Batman.escapeHTML(e):e)):t.innerHTML}},nodeIsEditable:function(t){var e;return"INPUT"===(e=t.nodeName.toUpperCase())||"TEXTAREA"===e||"SELECT"===e},addEventListener:function(t,e,n){var r;return(r=Batman._data(t,"listeners"))||(r=Batman._data(t,"listeners",{})),r[e]||(r[e]=[]),r[e].push(n),Batman.DOM.hasAddEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)},removeEventListener:function(t,e,n){var r,o,i;return(i=Batman._data(t,"listeners"))&&(r=i[e])&&(o=r.indexOf(n),-1!==o&&r.splice(o,1)),Batman.DOM.hasAddEventListener?t.removeEventListener(e,n,!1):t.detachEvent("on"+e,n)},hasAddEventListener:!!("undefined"!=typeof window&&null!==window?window.addEventListener:void 0),preventDefault:function(t){return"function"==typeof t.preventDefault?t.preventDefault():t.returnValue=!1},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},willInsertNode:function(t){var e,n,r,o,i;for(n=Batman._data(t,"view"),null!=n&&n.fire("beforeAppear",t),i=t.childNodes,r=0,o=i.length;o>r;r++)e=i[r],Batman.DOM.willInsertNode(e);return!0},didInsertNode:function(t){var e,n,r,o,i;for(n=Batman._data(t,"view"),n&&(n.fire("appear",t),n.applyYields()),i=t.childNodes,r=0,o=i.length;o>r;r++)e=i[r],Batman.DOM.didInsertNode(e);return!0},willRemoveNode:function(t){var e,n,r,o,i;for(n=Batman._data(t,"view"),n&&n.fire("beforeDisappear",t),i=t.childNodes,r=0,o=i.length;o>r;r++)e=i[r],Batman.DOM.willRemoveNode(e);return!0},didRemoveNode:function(t){var e,n,r,o,i;for(n=Batman._data(t,"view"),n&&(n.retractYields(),n.fire("disappear",t)),i=t.childNodes,r=0,o=i.length;o>r;r++)e=i[r],Batman.DOM.didRemoveNode(e);return!0},willDestroyNode:function(t){var e,n,r,o,i;for(n=Batman._data(t,"view"),n&&(n.fire("beforeDestroy",t),n.get("yields").forEach(function(e,n){var r,o,i;for(i=[],r=0,o=n.length;o>r;r++)t=n[r].node,i.push(Batman.DOM.willDestroyNode(t));return i})),i=t.childNodes,r=0,o=i.length;o>r;r++)e=i[r],Batman.DOM.willDestroyNode(e);return!0},didDestroyNode:function(t){var e,n,r,o,i,a,s,u,c;if(a=Batman._data(t,"view"),a&&a.die(),(e=Batman._data(t,"bindings"))&&e.forEach(function(t){return t.die()}),i=Batman._data(t,"listeners"))for(o in i)r=i[o],r.forEach(function(e){return Batman.DOM.removeEventListener(t,o,e)});for(Batman.removeData(t,null,null,!0),c=t.childNodes,s=0,u=c.length;u>s;s++)n=c[s],Batman.DOM.didDestroyNode(n);return!0}},Batman.mixin(Batman.DOM,Batman.EventEmitter,Batman.Observable),Batman.DOM.event("bindingAdded")}.call(this),function(){Batman.DOM.ReaderBindingDefinition=function(){function t(t,e,n,r){this.node=t,this.keyPath=e,this.context=n,this.renderer=r}return t}(),Batman.BindingDefinitionOnlyObserve={Data:"data",Node:"node",All:"all",None:"none"},Batman.DOM.readers={target:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Node,Batman.DOM.readers.bind(t)},source:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.readers.bind(t)},bind:function(t){var e,n;switch(n=t.node,n.nodeName.toLowerCase()){case"input":switch(n.getAttribute("type")){case"checkbox":return t.attr="checked",Batman.DOM.attrReaders.bind(t),!0;case"radio":e=Batman.DOM.RadioBinding;break;case"file":e=Batman.DOM.FileBinding}break;case"select":e=Batman.DOM.SelectBinding}return e||(e=Batman.DOM.ValueBinding),new e(t)},context:function(t){return t.context.descendWithDefinition(t)},mixin:function(t){return t.context=t.context.descend(Batman.mixins),new Batman.DOM.MixinBinding(t)},showif:function(t){return new Batman.DOM.ShowHideBinding(t)},hideif:function(t){return t.invert=!0,new Batman.DOM.ShowHideBinding(t)},insertif:function(t){return new Batman.DOM.InsertionBinding(t)},removeif:function(t){return t.invert=!0,new Batman.DOM.InsertionBinding(t)},route:function(t){return new Batman.DOM.RouteBinding(t)},view:function(t){return new Batman.DOM.ViewBinding(t)},partial:function(t){return Batman.DOM.partial(t.node,t.keyPath,t.context,t.renderer)},defineview:function(t){var e;return e=t.node,Batman.DOM.onParseExit(e,function(){var t;return null!=(t=e.parentNode)?t.removeChild(e):void 0}),Batman.DOM.defineView(t.keyPath,e),{skipChildren:!0}},renderif:function(t){return new Batman.DOM.DeferredRenderingBinding(t)},yield:function(t){var e,n;return n=t.node,e=t.keyPath,Batman.DOM.onParseExit(n,function(){return Batman.DOM.Yield.withName(e).set("containerNode",n)})},contentfor:function(t){var e,n,r,o,i;return n=t.node,i=t.value,o=t.swapMethod,r=t.renderer,e=t.keyPath,o||(o="append"),Batman.DOM.onParseExit(n,function(){var t;return null!=(t=n.parentNode)&&t.removeChild(n),r.view.pushYieldAction(e,o,n)})},replace:function(t){return t.swapMethod="replace",Batman.DOM.readers.contentfor(t)}}}.call(this),function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.DOM.events={click:function(e,n,r,o){return null==o&&(o="click"),Batman.DOM.addEventListener(e,o,function(){var i,a;return a=arguments[0],i=2<=arguments.length?t.call(arguments,1):[],a.metaKey||a.ctrlKey||1===a.button||(Batman.DOM.preventDefault(a),!Batman.DOM.eventIsAllowed(o,a))?void 0:n.apply(null,[e,a].concat(t.call(i),[r]))}),"A"!==e.nodeName.toUpperCase()||e.href||(e.href="#"),e},doubleclick:function(t,e,n){return Batman.DOM.events.click(t,e,n,"dblclick")},change:function(n,r,o){var i,a,s,u,c,l;for(a=function(){var t;switch(n.nodeName.toUpperCase()){case"TEXTAREA":return["input","keyup","change"];case"INPUT":return t=n.type.toLowerCase(),e.call(Batman.DOM.textInputTypes,t)>=0?(s=r,r=function(t,e){return"keyup"===e.type&&Batman.DOM.events.isEnter(e)?void 0:s(t,e)},["input","keyup","change"]):["input","change"];default:return["change"]}}(),l=[],u=0,c=a.length;c>u;u++)i=a[u],l.push(Batman.DOM.addEventListener(n,i,function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],r.apply(null,[n].concat(t.call(e),[o]))}));return l},isEnter:function(t){var e,n;return 13<=(e=t.keyCode)&&14>=e||13<=(n=t.which)&&14>=n||"Enter"===t.keyIdentifier||"Enter"===t.key},submit:function(e,n,r){return Batman.DOM.nodeIsEditable(e)?(Batman.DOM.addEventListener(e,"keydown",function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],Batman.DOM.events.isEnter(n[0])?Batman.DOM._keyCapturingNode=e:void 0}),Batman.DOM.addEventListener(e,"keyup",function(){var o;return o=1<=arguments.length?t.call(arguments,0):[],Batman.DOM.events.isEnter(o[0])?(Batman.DOM._keyCapturingNode===e&&(Batman.DOM.preventDefault(o[0]),n.apply(null,[e].concat(t.call(o),[r]))),Batman.DOM._keyCapturingNode=null):void 0})):Batman.DOM.addEventListener(e,"submit",function(){var o;return o=1<=arguments.length?t.call(arguments,0):[],Batman.DOM.preventDefault(o[0]),n.apply(null,[e].concat(t.call(o),[r]))}),e},other:function(e,n,r,o){return Batman.DOM.addEventListener(e,n,function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],r.apply(null,[e].concat(t.call(n),[o]))})}},Batman.DOM.eventIsAllowed=function(t,e){var n,r,o;return(n=null!=(r=Batman.currentApp)?null!=(o=r.shouldAllowEvent)?o[t]:void 0:void 0)&&n(e)===!1?!1:!0}}.call(this),function(){Batman.DOM.AttrReaderBindingDefinition=function(){function t(t,e,n,r,o){this.node=t,this.attr=e,this.keyPath=n,this.context=r,this.renderer=o}return t}(),Batman.DOM.attrReaders={_parseAttribute:function(t){return"false"===t&&(t=!1),"true"===t&&(t=!0),t},source:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.attrReaders.bind(t)},bind:function(t){var e;return e=function(){switch(t.attr){case"checked":case"disabled":case"selected":return Batman.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return Batman.DOM.NodeAttributeBinding;case"class":return Batman.DOM.ClassBinding;case"style":return Batman.DOM.StyleBinding;default:return Batman.DOM.AttributeBinding}}(),new e(t)},context:function(t){return t.context.descendWithDefinition(t)},event:function(t){return new Batman.DOM.EventBinding(t)},addclass:function(t){return new Batman.DOM.AddClassBinding(t)},removeclass:function(t){return t.invert=!0,new Batman.DOM.AddClassBinding(t)},foreach:function(t){return new Batman.DOM.IteratorBinding(t)},formfor:function(t){return new Batman.DOM.FormBinding(t),t.context.descendWithDefinition(t)}}}.call(this),function(){var t,e,n,r,o,i=[].slice,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=function(t,e){var n,r,o,i;for("function"==typeof e&&(e={get:e}),i=["cachable","cacheable"],r=0,o=i.length;o>r;r++)n=i[r],n in e&&(Batman.developer.warn('Property accessor option "'+n+'" is deprecated. Use "cache" instead.'),"cache"in e||(e.cache=e[n]));return e},r=function(t){return function(e){return{get:function(n){var r,o,i,a,s,u,c,l=this;return null!=(o=e.get.apply(this,arguments))?o:(r=!1,i=void 0,null==(u=(a=this._batman).promises)&&(a.promises={}),null==(c=(s=this._batman.promises)[n])&&(s[n]=function(){var e,o;return e=function(t,e){return r&&l.set(n,e),i=e},o=t.call(l,e,n),null==i&&(i=o),!0}()),r=!0,i)},cache:!0}}},o=function(t,e){var n,r;e=("function"==typeof e?e(t):void 0)||e;for(n in t)r=t[n],n in e||(e[n]=r);return e},e={_defineAccessor:function(){var t,e,o,a,s,u,c,l,p;if(o=2<=arguments.length?i.call(arguments,0,s=arguments.length-1):(s=0,[]),t=arguments[s++],null==t)return Batman.Property.defaultAccessorForBase(this);if(0===o.length&&"Object"!==(l=Batman.typeOf(t))&&"Function"!==l)return Batman.Property.accessorForBaseAndKey(this,t);if("function"==typeof t.promise)return this._defineWrapAccessor.apply(this,i.call(o).concat([r(t.promise)]));if(Batman.initializeObject(this),0===o.length)return this._batman.defaultAccessor=n(this,t);for((a=this._batman).keyAccessors||(a.keyAccessors=new Batman.SimpleHash),p=[],u=0,c=o.length;c>u;u++)e=o[u],p.push(this._batman.keyAccessors.set(e,n(this,t)));return p},_defineWrapAccessor:function(){var t,e,n,r,a,s,u;if(e=2<=arguments.length?i.call(arguments,0,r=arguments.length-1):(r=0,[]),n=arguments[r++],Batman.initializeObject(this),0===e.length)return this._defineAccessor(o(this._defineAccessor(),n));for(u=[],a=0,s=e.length;s>a;a++)t=e[a],u.push(this._defineAccessor(t,o(this._defineAccessor(t),n)));return u},_resetPromises:function(){var t;if(null!=this._batman.promises)for(t in this._batman.promises)this._resetPromise(t)},_resetPromise:function(t){this.unset(t),this.property(t).cached=!1,delete this._batman.promises[t]}},t=function(t){function n(){var t;t=1<=arguments.length?i.call(arguments,0):[],this._batman=new Batman._Batman(this),this.mixin.apply(this,t)}var r;return s(n,t),Batman.initializeObject(n),Batman.initializeObject(n.prototype),Batman.mixin(n.prototype,e,Batman.EventEmitter,Batman.Observable),Batman.mixin(n,e,Batman.EventEmitter,Batman.Observable),n.classMixin=function(){return Batman.mixin.apply(Batman,[this].concat(i.call(arguments)))},n.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},n.prototype.mixin=n.classMixin,n.classAccessor=n._defineAccessor,n.accessor=function(){var t;return(t=this.prototype)._defineAccessor.apply(t,arguments)},n.prototype.accessor=n._defineAccessor,n.wrapClassAccessor=n._defineWrapAccessor,n.wrapAccessor=function(){var t;return(t=this.prototype)._defineWrapAccessor.apply(t,arguments)},n.prototype.wrapAccessor=n._defineWrapAccessor,n.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},n.singleton=function(t){return null==t&&(t="sharedInstance"),this.classAccessor(t,{get:function(){var e;return this[e="_"+t]||(this[e]=new this)}})},n.accessor("_batmanID",function(){return this._batmanID()}),r=0,n.prototype._batmanID=function(){var t,e;return this._batman.check(this),null==(e=(t=this._batman).id)&&(t.id=r++),this._batman.id},n.prototype.hashKey=function(){var t;if("function"!=typeof this.isEqual)return(t=this._batman).hashKey||(t.hashKey="<Batman.Object "+this._batmanID()+">")},n.prototype.toJSON=function(){var t,e,n;e={};for(t in this)a.call(this,t)&&(n=this[t],"_batman"!==t&&"hashKey"!==t&&"_batmanID"!==t&&(e[t]=(null!=n?n.toJSON:void 0)?n.toJSON():n));return e},n}(Object),Batman.Object=t}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Renderer=function(e){function r(e,n,o){this.node=e,this.context=n,this.view=o,this.resume=t(this.resume,this),this.start=t(this.start,this),r.__super__.constructor.call(this),this.context instanceof Batman.RenderContext||Batman.developer.error("Must pass a RenderContext to a renderer for rendering"),this.immediate=Batman.setImmediate(this.start)}var o,i,a,s,u,c,l,p,h,d,f;for(n(r,e),r.prototype.deferEvery=50,r.prototype.start=function(){return this.startTime=new Date,this.prevent("parsed"),this.prevent("rendered"),this.parseNode(this.node)},r.prototype.resume=function(){return this.startTime=new Date,this.parseNode(this.resumeNode)},r.prototype.finish=function(){return this.startTime=null,this.prevent("stopped"),this.allowAndFire("parsed"),this.allowAndFire("rendered")},r.prototype.stop=function(){return Batman.clearImmediate(this.immediate),this.fire("stopped")},f=["parsed","rendered","stopped"],l=0,h=f.length;h>l;l++)s=f[l],r.prototype.event(s).oneShot=!0;for(o=/^data\-(.*)/,i=["view","renderif","foreach","formfor","context","bind","source","target"],a={},c=p=0,d=i.length;d>p;c=++p)u=i[c],a[u]=c;return r.prototype._sortBindings=function(t,e){var n,r;return n=a[t[0]],r=a[e[0]],null==n&&(n=i.length),null==r&&(r=i.length),n>r?1:r>n?-1:t[0]>e[0]?1:e[0]>t[0]?-1:0},r.prototype.parseNode=function(t){var e,n,r,i,a,s,c,l,p,h,d,f,m,y,g,v,_,B,b,O=this;if(this.deferEvery&&new Date-this.startTime>this.deferEvery)return this.resumeNode=t,this.timeout=Batman.setImmediate(this.resume),void 0;if(t.getAttribute&&t.attributes){for(a=[],v=t.attributes,f=0,y=v.length;y>f;f++)n=v[f],u=null!=(_=n.nodeName.match(o))?_[1]:void 0,u&&a.push((s=u.split("-")).length>1?[s[0],s.slice(1,+s.length+1||9e9).join("-"),n.value]:[u,void 0,n.value]);for(B=a.sort(this._sortBindings),m=0,g=B.length;g>m;m++)if(b=B[m],u=b[0],e=b[1],d=b[2],r=e?(p=Batman.DOM.attrReaders[u])?(i=new Batman.DOM.AttrReaderBindingDefinition(t,e,d,this.context,this),p(i)):void 0:(p=Batman.DOM.readers[u])?(i=new Batman.DOM.ReaderBindingDefinition(t,d,this.context,this),p(i)):void 0,r instanceof Batman.RenderContext)l=this.context,this.context=r,Batman.DOM.onParseExit(t,function(){return O.context=l});else if(null!=r?r.skipChildren:void 0){h=!0;break}}return(c=this.nextNode(t,h))?this.parseNode(c):this.finish()},r.prototype.nextNode=function(t,e){var n,r,o,i,a,s;if(!e&&(n=t.childNodes,null!=n?n.length:void 0))return n[0];if(i=t.nextSibling,null!=(a=Batman.DOM.onParseExit(t))&&a.forEach(function(t){return t()}),Batman.DOM.forgetParseExit(t),this.node!==t){if(i)return i;for(r=t;r=r.parentNode;){if(o=r.nextSibling,null!=(s=Batman.DOM.onParseExit(r))&&s.forEach(function(t){return t()}),Batman.DOM.forgetParseExit(r),this.node===r)return;if(o)return o}}},r}(Batman.Object)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.AbstractBinding=function(e){function r(e){this._fireDataChange=t(this._fireDataChange,this),this.node=e.node,this.keyPath=e.keyPath,this.renderContext=e.context,this.renderer=e.renderer,e.onlyObserve&&(this.onlyObserve=e.onlyObserve),null!=e.skipParseFilter&&(this.skipParseFilter=e.skipParseFilter),this.skipParseFilter||this.parseFilter(),this.bindImmediately&&this.bind()}var o,i,a,s,u,c;return n(r,e),a=/(^|,)\s*(?:(true|false)|("[^"]*")|(\{[^\}]*\})|(([0-9]+[a-zA-Z\_\-]|[a-zA-Z])[\w\-\.]*[\?\!]?))\s*(?=$|,)/g,o=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,i=/(?!^\s*)\[(.*?)\]/g,r.accessor("filteredValue",{get:function(){var t,e,n,r;return r=this.get("unfilteredValue"),n=this,t=this.get("renderContext"),this.filterFunctions.length>0?(Batman.developer.currentFilterStack=t,e=this.filterFunctions.reduce(function(e,r,o){var i;for(i=n.filterArguments[o].map(function(t){return t._keypath?n.renderContext.get(t._keypath):t}),i.unshift(e);i.length<r.length-1;)i.push(void 0);return i.push(n),r.apply(t,i)},r),Batman.developer.currentFilterStack=null,e):r},set:function(t,e){return this.set("unfilteredValue",e)}}),r.accessor("unfilteredValue",{get:function(){var t;return(t=this.get("key"))?Batman.RenderContext.deProxy(Batman.getPath(this,["keyContext",t])):this.get("value")},set:function(t,e){var n,r,o;return(n=this.get("key"))?(r=this.get("keyContext"),r&&r!==Batman.container?(o=Batman.Property.forBaseAndKey(r,n),o.setValue(e)):void 0):this.set("value",e)}}),r.accessor("keyContext",function(){return this.renderContext.contextForKey(this.key)}),s=Batman.BindingDefinitionOnlyObserve.All,u=Batman.BindingDefinitionOnlyObserve.Data,c=Batman.BindingDefinitionOnlyObserve.Node,r.prototype.bindImmediately=!0,r.prototype.shouldSet=!0,r.prototype.isInputBinding=!1,r.prototype.escapeValue=!0,r.prototype.onlyObserve=s,r.prototype.skipParseFilter=!1,r.prototype.isTwoWay=function(){return null!=this.key&&0===this.filterFunctions.length},r.prototype.bind=function(){var t,e;return this.node&&((t=this.onlyObserve)===s||t===c)&&Batman.DOM.nodeIsEditable(this.node)&&(Batman.DOM.events.change(this.node,this._fireNodeChange.bind(this)),this.onlyObserve===c&&this._fireNodeChange()),((e=this.onlyObserve)===s||e===u)&&this.observeAndFire("filteredValue",this._fireDataChange),this.node?Batman.DOM.trackBinding(this,this.node):void 0},r.prototype._fireNodeChange=function(t){var e;return this.shouldSet=!1,e=this.value||this.get("keyContext"),"function"==typeof this.nodeChange&&this.nodeChange(this.node,e,t),this.fire("nodeChange",this.node,e),this.shouldSet=!0},r.prototype._fireDataChange=function(t){return this.shouldSet?("function"==typeof this.dataChange&&this.dataChange(t,this.node),this.fire("dataChange",t,this.node)):void 0},r.prototype.die=function(){var t;return this.forget(),null!=(t=this._batman.properties)&&t.forEach(function(t,e){return e.die()}),this.fire("die"),this.node=null,this.keyPath=null,this.renderContext=null,this.renderer=null,this.dead=!0,!0},r.prototype.parseFilter=function(){var t,e,n,r,a,s,u,c,l,p;for(this.filterFunctions=[],this.filterArguments=[],c=this.keyPath;o.test(c);)c=c.replace(o,"]['$1']");s=c.replace(i," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{u=this.parseSegment(l=s.shift())[0]}catch(h){e=h,Batman.developer.warn(e),Batman.developer.error("Error! Couldn't parse keypath in \""+l+'". Parsing error above.')}if(u&&u._keypath?this.key=u._keypath:this.value=u,s.length){for(;a=s.shift();){if(p=a.indexOf(" "),-1===p&&(p=a.length),r=a.substr(0,p),t=a.substr(p),!(n=Batman.Filters[r]))return Batman.developer.error("Unrecognized filter '"+r+"' in key \""+this.keyPath+'"!');this.filterFunctions.push(n);try{this.filterArguments.push(this.parseSegment(t))}catch(h){e=h,Batman.developer.error('Bad filter arguments "'+t+'"!')}}return!0}},r.prototype.parseSegment=function(t){return t=t.replace(a,function(t,e,n,r,o,i){var a;return null==e&&(e=""),a=i?'{"_keypath": "'+i+'"}':n||r||o,e+a}),JSON.parse("["+t+"]")},r}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ViewBinding=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.renderer.prevent("rendered"),this.node.removeAttribute("data-view")}return e(n,t),n.prototype.skipChildren=!0,n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){var e,n=this;if(null!=t)return t.isView?(this.view=t,this.view.set("context",this.renderContext),this.view.set("node",this.node)):this.view=new t({node:this.node,context:this.renderContext,parentView:this.renderer.view}),this.view.on("ready",function(){return n.renderer.allowAndFire("rendered")}),this.forget(),null!=(e=this._batman.properties)?e.forEach(function(t,e){return e.die()}):void 0},n.prototype.die=function(){return this.view=null,n.__super__.die.apply(this,arguments)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.ViewArgumentBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,r}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ValueBinding=function(t){function n(t){var e;this.isInputBinding="input"===(e=t.node.nodeName.toLowerCase())||"textarea"===e,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.node.value):void 0},n.prototype.dataChange=function(t){return Batman.DOM.valueForNode(this.node,t,this.escapeValue)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ShowHideBinding=function(t){function n(t){var e;e=t.node.style.display,e&&"none"!==e||(e=""),this.originalDisplay=e,this.invert=t.invert,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){var e;return e=Batman._data(this.node,"view"),!!t==!this.invert?(null!=e&&e.fire("beforeAppear",this.node),this.node.style.display=this.originalDisplay,null!=e?e.fire("appear",this.node):void 0):(null!=e&&e.fire("beforeDisappear",this.node),Batman.DOM.setStyleProperty(this.node,"display","none","important"),null!=e?e.fire("disappear",this.node):void 0)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.SelectBinding=function(e){function r(){this.updateOptionBindings=t(this.updateOptionBindings,this),this.nodeChange=t(this.nodeChange,this),this.dataChange=t(this.dataChange,this),this.childBindingAdded=t(this.childBindingAdded,this),this.selectedBindings=new Batman.SimpleSet,r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.isInputBinding=!0,r.prototype.canSetImplicitly=!0,r.prototype.childBindingAdded=function(t){var e,n=this;if(t instanceof Batman.DOM.CheckedBinding)t.on("dataChange",e=function(){return n.nodeChange()}),t.on("die",function(){return t.forget("dataChange",e),n.selectedBindings.remove(t)}),this.selectedBindings.add(t);else{if(!(t instanceof Batman.DOM.IteratorBinding))return;t.on("nodeAdded",e=function(){return n._fireDataChange(n.get("filteredValue"))}),t.on("nodeRemoved",e),t.on("die",function(){return t.forget("nodeAdded",e),t.forget("nodeRemoved",e)})}return this._fireDataChange(this.get("filteredValue"))},r.prototype.lastKeyContext=null,r.prototype.dataChange=function(t){var e,n,r,o,i,a,s;if(this.lastKeyContext||(this.lastKeyContext=this.get("keyContext")),this.lastKeyContext!==this.get("keyContext")&&(this.canSetImplicitly=!0,this.lastKeyContext=this.get("keyContext")),null!=t?t.forEach:void 0){for(r={},s=this.node.children,o=0,i=s.length;i>o;o++)e=s[o],e.selected=!1,n=r[a=e.value]||(r[a]=[]),n.push(e);t.forEach(function(t){var e,n,o,i,a;if(e=r[t]){for(a=[],o=0,i=e.length;i>o;o++)n=e[o],a.push(n.selected=!0);return a}})}else null==t&&this.canSetImplicitly?this.node.value&&(this.canSetImplicitly=!1,this.set("unfilteredValue",this.node.value)):(this.canSetImplicitly=!1,Batman.DOM.valueForNode(this.node,t,this.escapeValue));this.updateOptionBindings(),this.fixSelectElementWidth()},r.prototype.nodeChange=function(){var t;this.isTwoWay()&&(t=Batman.DOM.valueForNode(this.node),typeof t===Array&&1===t.length&&(t=t[0]),this.set("unfilteredValue",t),this.updateOptionBindings())},r.prototype.updateOptionBindings=function(){return this.selectedBindings.forEach(function(t){return t._fireNodeChange()
})},r.prototype.fixSelectElementWidth=function(){var t=this;if(-1!==window.navigator.userAgent.toLowerCase().indexOf("msie"))return this._fixWidthTimeout&&clearTimeout(this._fixWidthTimeout),this._fixWidthTimeout=setTimeout(function(){return t._fixWidthTimeout=null,t._fixSelectElementWidth()},100)},r.prototype._fixSelectElementWidth=function(){var t,e,n;return(e=null!=(n=this.get("node"))?n.style:void 0)?(t=this.get("node").currentStyle.width,e.width="100%",e.width=null!=t?t:""):void 0},r}(Batman.DOM.AbstractBinding)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Batman.DOM.RouteBinding=function(n){function o(){return this.routeClick=e(this.routeClick,this),t=o.__super__.constructor.apply(this,arguments)}return r(o,n),o.prototype.onAnchorTag=!1,o.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,o.accessor("dispatcher",function(){return this.renderContext.get("dispatcher")||Batman.App.get("current.dispatcher")}),o.prototype.bind=function(){return"A"===this.node.nodeName.toUpperCase()&&(this.onAnchorTag=!0),o.__super__.bind.apply(this,arguments),Batman.DOM.events.click(this.node,this.routeClick)},o.prototype.routeClick=function(t,e){var n;if(!e.__batmanActionTaken)return e.__batmanActionTaken=!0,n=this.pathFromValue(this.get("filteredValue")),null!=n?Batman.redirect(n):void 0},o.prototype.dataChange=function(t){var e;return t&&(e=this.pathFromValue(t)),this.onAnchorTag?(e=e&&Batman.navigator?Batman.navigator.linkTo(e):"#",this.node.href=e):void 0},o.prototype.pathFromValue=function(t){var e;return t?t.isNamedRouteQuery?t.get("path"):null!=(e=this.get("dispatcher"))?e.pathFromParams(t):void 0:void 0},o}(Batman.DOM.AbstractBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.RadioBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.accessor("parsedNodeValue",function(){return Batman.DOM.attrReaders._parseAttribute(this.node.value)}),r.prototype.firstBind=!0,r.prototype.dataChange=function(){var t;return t=this.get("filteredValue"),null!=t?this.node.checked=t===Batman.DOM.attrReaders._parseAttribute(this.node.value):this.firstBind&&this.node.checked&&this.set("filteredValue",this.get("parsedNodeValue")),this.firstBind=!1},r.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.get("parsedNodeValue")):void 0},r}(Batman.DOM.AbstractBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.MixinBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,r.prototype.dataChange=function(t){return null!=t?Batman.mixin(this.node,t):void 0},r}(Batman.DOM.AbstractBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.FileBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.isInputBinding=!0,r.prototype.nodeChange=function(t){return this.isTwoWay()?t.hasAttribute("multiple")?this.set("filteredValue",Array.prototype.slice.call(t.files)):this.set("filteredValue",t.files[0]):void 0},r}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.DeferredRenderingBinding=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.node.removeAttribute("data-renderif")}return e(n,t),n.prototype.rendered=!1,n.prototype.skipChildren=!0,n.prototype.nodeChange=function(){},n.prototype.dataChange=function(t){return t&&!this.rendered?this.render():void 0},n.prototype.render=function(){return new Batman.Renderer(this.node,this.renderContext,this.renderer.view),this.rendered=!0},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AbstractAttributeBinding=function(t){function n(t){this.attributeName=t.attr,n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.FormBinding=function(e){function r(){this.childBindingAdded=t(this.childBindingAdded,this),r.__super__.constructor.apply(this,arguments),this.contextName=this.attributeName,delete this.attributeName,Batman.DOM.events.submit(this.get("node"),function(t,e){return Batman.DOM.preventDefault(e)}),this.setupErrorsList()}return n(r,e),r.current=null,r.prototype.errorClass="error",r.prototype.defaultErrorsListSelector="div.errors",r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,r.accessor("errorsListSelector",function(){return this.get("node").getAttribute("data-errors-list")||this.defaultErrorsListSelector}),r.prototype.childBindingAdded=function(t){var e,n,r,o;return t.isInputBinding&&Batman.isChildOf(this.get("node"),t.get("node"))&&~(r=t.get("key").indexOf(this.contextName))?(o=t.get("node"),n=t.get("key").slice(r+this.contextName.length+1),e=new Batman.DOM.AttrReaderBindingDefinition(o,this.errorClass,this.get("keyPath")+(" | get 'errors."+n+".length'"),this.renderContext,this.renderer),new Batman.DOM.AddClassBinding(e)):void 0},r.prototype.setupErrorsList=function(){return(this.errorsListNode=Batman.DOM.querySelector(this.get("node"),this.get("errorsListSelector")))&&(Batman.DOM.setInnerHTML(this.errorsListNode,this.errorsListHTML()),!this.errorsListNode.getAttribute("data-showif"))?this.errorsListNode.setAttribute("data-showif",""+this.contextName+".errors.length"):void 0},r.prototype.errorsListHTML=function(){return'<ul>\n  <li data-foreach-error="'+this.contextName+'.errors" data-bind="error.fullMessage"></li>\n</ul>'},r}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.EventBinding=function(t){function n(){var t,e,r,o=this;n.__super__.constructor.apply(this,arguments),(r=this.node.getAttribute("data-confirm"))&&Batman.developer.deprecated("data-confirm"),e=function(){var t;if(!r||confirm(r))return null!=(t=o.get("filteredValue"))?t.apply(o.get("callbackContext"),arguments):void 0},(t=Batman.DOM.events[this.attributeName])?t(this.node,e,this.renderContext):Batman.DOM.events.other(this.node,this.attributeName,e,this.renderContext)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,n.accessor("callbackContext",function(){var t;return t=this.key.split("."),t.pop(),t.length>0?this.get("keyContext").get(t.join(".")):this.get("keyContext")}),n.wrapAccessor("unfilteredValue",function(t){return{get:function(){var e,n,r,o;return(n=this.get("key"))&&(o=n.split("."),o.length>1&&(e=o.pop(),r=Batman.getPath(this,["keyContext"].concat(o)),r=Batman.RenderContext.deProxy(r),null!=r))?r[e]:t.get.apply(this,arguments)}}}),n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.NodeAttributeBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.dataChange=function(t){return null==t&&(t=""),this.node[this.attributeName]=t},r.prototype.nodeChange=function(t){return this.isTwoWay()?this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(t[this.attributeName])):void 0},r}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.CheckedBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.isInputBinding=!0,r.prototype.dataChange=function(t){return this.node[this.attributeName]=!!t},r}(Batman.DOM.NodeAttributeBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.AttributeBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,r.prototype.dataChange=function(t){return this.node.setAttribute(this.attributeName,t)},r.prototype.nodeChange=function(t){return this.isTwoWay()?this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(t.getAttribute(this.attributeName))):void 0},r}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AddClassBinding=function(t){function n(t){var e;this.invert=t.invert,this.classes=function(){var n,r,o,i;for(o=t.attr.split("|"),i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push({name:e,pattern:new RegExp("(?:^|\\s)"+e+"(?:$|\\s)","i")});return i}(),n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){var e,n,r,o,i,a,s,u;for(e=this.node.className,s=this.classes,i=0,a=s.length;a>i;i++)u=s[i],r=u.name,o=u.pattern,n=o.test(e),!!t==!this.invert?n||(this.node.className=""+e+" "+r):n&&(this.node.className=e.replace(o," "));return!0},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.AbstractCollectionBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.bindCollection=function(t){var e;return t instanceof Batman.Hash&&(t=t.meta),t===this.collection?!0:(this.unbindCollection(),this.collection=t,(null!=(e=this.collection)?e.isObservable:void 0)?(this.collection.observeAndFire("toArray",this.handleArrayChanged),!0):!1)},r.prototype.unbindCollection=function(){var t;return(null!=(t=this.collection)?t.isObservable:void 0)?this.collection.forget("toArray",this.handleArrayChanged):void 0},r.prototype.handleArrayChanged=function(){},r.prototype.die=function(){return this.unbindCollection(),r.__super__.die.apply(this,arguments)},r}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.DOM.StyleBinding=function(o){function i(){this.setStyle=t(this.setStyle,this),this.handleArrayChanged=t(this.handleArrayChanged,this),this.oldStyles={},this.styleBindings={},i.__super__.constructor.apply(this,arguments)}return n(i,o),i.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,i.prototype.dataChange=function(t){var n,o,i,a,s,u,c,l,p;if(!t)return this.resetStyles(),void 0;this.unbindCollection();{if("string"!=typeof t){if(t instanceof Batman.Hash)return this.bindCollection(t);t instanceof Batman.Object&&(t=t.toJSON()),this.resetStyles(),p=[];for(i in t)e.call(t,i)&&p.push(this.bindSingleAttribute(i,""+this.keyPath+"."+i));return p}for(this.resetStyles(),c=t.split(";"),s=0,u=c.length;u>s;s++)a=c[s],l=a.split(":"),o=l[0],n=2<=l.length?r.call(l,1):[],this.setStyle(o,n.join(":"))}},i.prototype.handleArrayChanged=function(){var t=this;return this.collection.forEach(function(e){return t.bindSingleAttribute(e,""+t.keyPath+"."+e)})},i.prototype.bindSingleAttribute=function(t,e){var n;return n=new Batman.DOM.AttrReaderBindingDefinition(this.node,t,e,this.renderContext,this.renderer),this.styleBindings[t]=new Batman.DOM.StyleBinding.SingleStyleBinding(n,this)},i.prototype.setStyle=function(t,e){return t=Batman.helpers.camelize(t.trim(),!0),null==this.oldStyles[t]&&(this.oldStyles[t]=this.node.style[t]||""),(null!=e?e.trim:void 0)&&(e=e.trim()),null==e&&(e=""),this.node.style[t]=e},i.prototype.resetStyles=function(){var t,n,r,o;r=this.oldStyles,o=[];for(t in r)e.call(r,t)&&(n=r[t],o.push(this.setStyle(t,n)));return o},i.prototype.resetBindings=function(){var t,e,n;n=this.styleBindings;for(t in n)e=n[t],e._fireDataChange(""),e.die();return this.styleBindings={}},i.prototype.unbindCollection=function(){return this.resetBindings(),i.__super__.unbindCollection.apply(this,arguments)},i.SingleStyleBinding=function(t){function e(t,n){this.parent=n,e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,e.prototype.isTwoWay=function(){return!1},e.prototype.dataChange=function(t){return this.parent.setStyle(this.attributeName,t)},e}(Batman.DOM.AbstractAttributeBinding),i}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.IteratorBinding=function(e){function r(e){this.handleArrayChanged=t(this.handleArrayChanged,this);var n,o,i=this;o=e.node,this.iteratorName=e.attr,this.key=e.keyPath,this.parentRenderer=e.renderer,this.prototypeNode=o.cloneNode(!0),this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),n=o.nextSibling,this.startNode=document.createComment("start "+this.iteratorName+"-"+this.get("_batmanID")),this.endNode=document.createComment("end "+this.iteratorName+"-"+this.get("_batmanID")),this.endNode[Batman.expando]=o[Batman.expando],Batman.canDeleteExpando&&delete o[Batman.expando],Batman.DOM.insertBefore(o.parentNode,this.startNode,n),Batman.DOM.insertBefore(o.parentNode,this.endNode,n),this.parentRenderer.prevent("rendered"),Batman.DOM.onParseExit(o.parentNode,function(){return Batman.DOM.destroyNode(o),i.bind(),i.parentRenderer.allowAndFire("rendered")}),e.node=this.endNode,r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.currentActionNumber=0,r.prototype.queuedActionNumber=0,r.prototype.bindImmediately=!1,r.prototype.skipChildren=!0,r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,r.prototype.parentNode=function(){return this.endNode.parentNode},r.prototype.dataChange=function(t){var e,n;return null==t?this.handleArrayChanged([]):this.bindCollection(t)?void 0:(e=(null!=t?t.forEach:void 0)?(n=[],t.forEach(function(t){return n.push(t)}),n):Object.keys(t),this.handleArrayChanged(e))},r.prototype.handleArrayChanged=function(t){var e,n,r,o,i,a,s,u,c,l;if(this.nodes)for(c=this.nodes,i=0,s=c.length;s>i;i++)o=c[i],this._nodesToBeRendered.has(o)?(this._nodesToBeRemoved||(this._nodesToBeRemoved=new Batman.SimpleSet),this._nodesToBeRemoved.add(o)):this._removeNode(o);if(this.nodes=[],t){for(e=document.createDocumentFragment(),n=a=0,u=t.length;u>a;n=++a)r=t[n],null==(l=this.nodes)&&(this.nodes=[]),this.nodes.push(o=this._newNodeForItem(r)),e.appendChild(o);this.parentNode().insertBefore(e,this.endNode)}},r.prototype._itemForNode=function(t){return Batman._data(t,""+this.iteratorName+"Item")},r.prototype._newNodeForItem=function(t){var e,n,r=this;return e=this.prototypeNode.cloneNode(!0),this._nodesToBeRendered||(this._nodesToBeRendered=new Batman.SimpleSet),this._nodesToBeRendered.add(e),Batman._data(e,""+this.iteratorName+"Item",t),this.parentRenderer.prevent("rendered"),n=new Batman.Renderer(e,this.renderContext.descend(t,this.iteratorName),this.parentRenderer.view),n.once("rendered",function(){var t;return r._nodesToBeRendered.remove(e),(null!=(t=r._nodesToBeRemoved)?t.has(e):void 0)?(r._nodesToBeRemoved.remove(e),r._removeNode(e)):(Batman.DOM.propagateBindingEvents(e),r.fire("nodeAdded",e)),r.parentRenderer.allowAndFire("rendered")}),e},r.prototype._removeNode=function(t){return Batman.DOM.destroyNode(t),this.fire("nodeRemoved",t)},r.prototype.die=function(){var t;return this._nodesToBeRendered&&!this._nodesToBeRendered.isEmpty()&&(this._nodesToBeRemoved||(this._nodesToBeRemoved=new Batman.SimpleSet),(t=this._nodesToBeRemoved).add.apply(t,this._nodesToBeRendered.toArray())),r.__super__.die.apply(this,arguments)},r}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Batman.DOM.ClassBinding=function(o){function i(){return this.handleArrayChanged=e(this.handleArrayChanged,this),t=i.__super__.constructor.apply(this,arguments)}return r(i,o),i.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,i.prototype.dataChange=function(t){return null!=t?(this.unbindCollection(),"string"==typeof t?this.node.className=t:(this.bindCollection(t),this.updateFromCollection())):void 0},i.prototype.updateFromCollection=function(){var t,e,r;return this.collection?(t=this.collection.map?this.collection.map(function(t){return t}):function(){var t,o;t=this.collection,o=[];for(e in t)n.call(t,e)&&(r=t[e],o.push(e));return o}.call(this),null!=t.toArray&&(t=t.toArray()),this.node.className=t.join(" ")):void 0},i.prototype.handleArrayChanged=function(){return this.updateFromCollection()},i}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ValidationError=function(t){function n(t,e){n.__super__.constructor.call(this,{attribute:t,message:e})}return e(n,t),n.accessor("fullMessage",function(){return Batman.t("errors.format",{attribute:Batman.helpers.humanize(this.attribute),message:this.message})}),n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.StorageAdapter=function(t){function r(t){var e;r.__super__.constructor.call(this,{model:t}),e=this.constructor,e.ModelMixin&&Batman.extend(t,e.ModelMixin),e.RecordMixin&&Batman.extend(t.prototype,e.RecordMixin)}return e(r,t),r.StorageError=function(t){function n(t){n.__super__.constructor.apply(this,arguments),this.message=t}return e(n,t),n.prototype.name="StorageError",n}(Error),r.RecordExistsError=function(t){function n(t){n.__super__.constructor.call(this,t||"Can't create this record because it already exists in the store!")}return e(n,t),n.prototype.name="RecordExistsError",n}(r.StorageError),r.NotFoundError=function(t){function n(t){n.__super__.constructor.call(this,t||"Record couldn't be found in storage!")}return e(n,t),n.prototype.name="NotFoundError",n}(r.StorageError),r.NotAllowedError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage operation denied access to the operation!")}return e(n,t),n.prototype.name="NotAllowedError",n}(r.StorageError),r.NotAcceptableError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage operation permitted but the request was malformed!")}return e(n,t),n.prototype.name="NotAcceptableError",n}(r.StorageError),r.UnprocessableRecordError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage adapter could not process the record!")}return e(n,t),n.prototype.name="UnprocessableRecordError",n}(r.StorageError),r.InternalStorageError=function(t){function n(t){n.__super__.constructor.call(this,t||"An error occurred during the storage operation!")}return e(n,t),n.prototype.name="InternalStorageError",n}(r.StorageError),r.NotImplementedError=function(t){function n(t){n.__super__.constructor.call(this,t||"This operation is not implemented by the storage adapter!")}return e(n,t),n.prototype.name="NotImplementedError",n}(r.StorageError),r.prototype.isStorageAdapter=!0,r.prototype.storageKey=function(t){var e;return e=(null!=t?t.constructor:void 0)||this.model,e.get("storageKey")||Batman.helpers.pluralize(Batman.helpers.underscore(e.get("resourceName")))},r.prototype.getRecordFromData=function(t,e){return null==e&&(e=this.model),e._makeOrFindRecordFromData(t)},r.skipIfError=function(t){return function(e,n){return null!=e.error?n():t.call(this,e,n)}},r.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(n.call(arguments)))},r.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(n.call(arguments)))},r.prototype._inheritFilters=function(){var t,e,n,r,o,i;if(!(this._batman.check(this)&&this._batman.filters||(r=this._batman.getFirst("filters"),this._batman.filters={before:{},after:{}},null==r))){i=[];for(o in r)t=r[o],i.push(function(){var r;r=[];for(n in t)e=t[n],r.push(this._batman.filters[o][n]=e.slice(0));return r}.call(this));return i}},r.prototype._addFilter=function(){var t,e,r,o,i,a,s,u;for(o=arguments[0],r=3<=arguments.length?n.call(arguments,1,a=arguments.length-1):(a=1,[]),t=arguments[a++],this._inheritFilters(),s=0,u=r.length;u>s;s++)e=r[s],(i=this._batman.filters[o])[e]||(i[e]=[]),this._batman.filters[o][e].push(t);return!0},r.prototype.runFilter=function(t,e,n,r){var o,i,a,s,u=this;return this._inheritFilters(),i=this._batman.filters[t].all||[],o=this._batman.filters[t][e]||[],n.action=e,a="before"===t?o.concat(i):i.concat(o),s=function(t){var e;return null!=t&&(n=t),null!=(e=a.shift())?e.call(u,n,s):r.call(u,n)},s()},r.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(n.call(arguments)))},r.prototype.runAfterFilter=function(t,e,n){return this.runFilter("after",t,e,this.exportResult(n))},r.prototype.exportResult=function(t){return function(e){return t(e.error,e.result,e)}},r.prototype._jsonToAttributes=function(t){return JSON.parse(t)},r.prototype.perform=function(t,e,n,r){var o,i,a=this;return n||(n={}),o={options:n,subject:e},i=function(e){return null!=e&&(o=e),a.runAfterFilter(t,o,r)},this.runBeforeFilter(t,o,function(e){return this[t](e,i)}),void 0},r}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice,r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.RestStorage=function(t){function o(){o.__super__.constructor.apply(this,arguments),this.defaultRequestOptions=Batman.extend({},this.defaultRequestOptions)}var i,a,s,u,c;for(e(o,t),o.CommunicationError=function(t){function n(t){n.__super__.constructor.call(this,t||"A communication error has occurred!")}return e(n,t),n.prototype.name="CommunicationError",n}(o.StorageError),o.JSONContentType="application/json",o.PostBodyContentType="application/x-www-form-urlencoded",o.BaseMixin={request:function(t,e,n){return n||(n=e,e={}),e.method||(e.method="GET"),e.action=t,this._doStorageOperation(e.method.toLowerCase(),e,n)}},o.ModelMixin=Batman.extend({},o.BaseMixin,{urlNestsUnder:function(){var t,e,r,o,i;for(e=1<=arguments.length?n.call(arguments,0):[],r={},o=0,i=e.length;i>o;o++)t=e[o],r[t+"_id"]=Batman.helpers.pluralize(t);return this.url=function(e){var n,o,i;n=Batman.helpers.pluralize(this.get("resourceName").toLowerCase());for(t in r)if(i=r[t],o=e.data[t])return delete e.data[t],""+i+"/"+o+"/"+n;return n},this.prototype.url=function(){var e,n,o,i,a;e=Batman.helpers.pluralize(this.constructor.get("resourceName").toLowerCase());for(t in r)if(i=r[t],o=this.get("dirtyKeys").get(t),void 0===o&&(o=this.get(t)),o){a=""+i+"/"+o+"/"+e;break}return a||(a=e),(n=this.get("id"))&&(a+="/"+n),a}}}),o.RecordMixin=Batman.extend({},o.BaseMixin),o.prototype.defaultRequestOptions={type:"json"},o.prototype._implicitActionNames=["create","read","update","destroy","readAll"],o.prototype.serializeAsForm=!0,o.prototype.recordJsonNamespace=function(t){return Batman.helpers.singularize(this.storageKey(t))},o.prototype.collectionJsonNamespace=function(t){return Batman.helpers.pluralize(this.storageKey(t.prototype))},o.prototype._execWithOptions=function(t,e,n,r){return null==r&&(r=t),"function"==typeof t[e]?t[e].call(r,n):t[e]},o.prototype._defaultCollectionUrl=function(t){return""+this.storageKey(t.prototype)},o.prototype._addParams=function(t,e){var n;return!e||!e.action||(n=e.action,r.call(this._implicitActionNames,n)>=0)||(t+="/"+e.action.toLowerCase()),t},o.prototype._addUrlAffixes=function(t,e,n){var r,o;return o=[t,this.urlSuffix(e,n)],"/"!==t.charAt(0)&&(r=this.urlPrefix(e,n),"/"!==r.charAt(r.length-1)&&o.unshift("/"),o.unshift(r)),o.join("")},o.prototype.urlPrefix=function(t,e){return this._execWithOptions(t,"urlPrefix",e.options)||""},o.prototype.urlSuffix=function(t,e){return this._execWithOptions(t,"urlSuffix",e.options)||""},o.prototype.urlForRecord=function(t,e){var n,r,o;if(null!=(o=e.options)?o.recordUrl:void 0)r=this._execWithOptions(e.options,"recordUrl",e.options,t);else if(t.url)r=this._execWithOptions(t,"url",e.options);else if(r=t.constructor.url?this._execWithOptions(t.constructor,"url",e.options):this._defaultCollectionUrl(t.constructor),"create"!==e.action){if(null==(n=t.get("id")))throw new this.constructor.StorageError("Couldn't get/set record primary key on "+e.action+"!");r=r+"/"+n}return this._addUrlAffixes(this._addParams(r,e.options),t,e)},o.prototype.urlForCollection=function(t,e){var n,r;return n=(null!=(r=e.options)?r.collectionUrl:void 0)?this._execWithOptions(e.options,"collectionUrl",e.options,e.options.urlContext):t.url?this._execWithOptions(t,"url",e.options):this._defaultCollectionUrl(t,e.options),this._addUrlAffixes(this._addParams(n,e.options),t,e)},o.prototype.request=function(t,e){var n;return n=Batman.extend(t.options,{autosend:!1,success:function(e){return t.data=e},error:function(e){return t.error=e},loaded:function(){return t.response=t.request.get("response"),e()}}),t.request=new Batman.Request(n),t.request.send()},o.prototype.perform=function(t,e,n,r){return n||(n={}),Batman.extend(n,this.defaultRequestOptions),o.__super__.perform.call(this,t,e,n,r)},o.prototype.before("all",o.skipIfError(function(t,e){var n;if(!t.options.url)try{t.options.url=t.subject.prototype?this.urlForCollection(t.subject,t):this.urlForRecord(t.subject,t)}catch(r){n=r,t.error=n}return e()})),o.prototype.before("get","put","post","delete",o.skipIfError(function(t,e){return t.options.method=t.action.toUpperCase(),e()})),o.prototype.before("create","update",o.skipIfError(function(t,e){var n,r,o;return r=t.subject.toJSON(),(o=this.recordJsonNamespace(t.subject))?(n={},n[o]=r):n=r,t.options.data=n,e()})),o.prototype.before("create","update","put","post",o.skipIfError(function(t,e){return this.serializeAsForm?t.options.contentType=this.constructor.PostBodyContentType:null!=t.options.data&&(t.options.data=JSON.stringify(t.options.data),t.options.contentType=this.constructor.JSONContentType),e()})),o.prototype.after("all",o.skipIfError(function(t,e){var n,r;if(null==t.data)return e();if("string"==typeof t.data){if(t.data.length>0)try{r=this._jsonToAttributes(t.data)}catch(o){return n=o,t.error=n,e()}}else"object"==typeof t.data&&(r=t.data);return null!=r&&(t.json=r),e()})),o.prototype.extractFromNamespace=function(t,e){return e&&null!=t[e]?t[e]:t},o.prototype.after("create","read","update",o.skipIfError(function(t,e){var n;return null!=t.json&&(n=this.extractFromNamespace(t.json,this.recordJsonNamespace(t.subject)),t.subject._withoutDirtyTracking(function(){return this.fromJSON(n)})),t.result=t.subject,e()})),o.prototype.after("readAll",o.skipIfError(function(t,e){var n,r;return r=this.collectionJsonNamespace(t.subject),t.recordsAttributes=this.extractFromNamespace(t.json,r),"Array"!==Batman.typeOf(t.recordsAttributes)&&(r=this.recordJsonNamespace(t.subject.prototype),t.recordsAttributes=[this.extractFromNamespace(t.json,r)]),t.result=t.records=function(){var e,r,o,i;for(o=t.recordsAttributes,i=[],e=0,r=o.length;r>e;e++)n=o[e],i.push(this.getRecordFromData(n,t.subject));return i}.call(this),e()})),o.prototype.after("get","put","post","delete",o.skipIfError(function(t,e){var n,r;return null!=t.json&&(n=t.json,r=t.subject.prototype?this.collectionJsonNamespace(t.subject):this.recordJsonNamespace(t.subject),t.result=r&&null!=t.json[r]?t.json[r]:t.json),e()})),o.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"},c=["create","read","update","destroy","readAll","get","post","put","delete"],a=function(t){return o.prototype[t]=o.skipIfError(function(e,n){var r;return(r=e.options).method||(r.method=this.constructor.HTTPMethods[t]),this.request(e,n)})},s=0,u=c.length;u>s;s++)i=c[s],a(i);return o.prototype.after("all",function(t,e){return t.error&&(t.error=this._errorFor(t.error,t)),e()}),o._statusCodeErrors={0:o.CommunicationError,403:o.NotAllowedError,404:o.NotFoundError,406:o.NotAcceptableError,409:o.RecordExistsError,422:o.UnprocessableRecordError,500:o.InternalStorageError,501:o.NotImplementedError},o.prototype._errorFor=function(t,e){var n,r;return t instanceof Error||null==t.request?t:((n=this.constructor._statusCodeErrors[t.request.status])&&(r=t.request,t=new n,t.request=r,t.env=e),t)},o}.call(this,Batman.StorageAdapter)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.LocalStorage=function(t){function n(){return"undefined"==typeof window.localStorage?null:(n.__super__.constructor.apply(this,arguments),this.storage=localStorage,void 0)}return e(n,t),n.prototype.storageRegExpForRecord=function(t){return new RegExp("^"+this.storageKey(t)+"(\\d+)$")},n.prototype.nextIdForRecord=function(t){var e,n;return n=this.storageRegExpForRecord(t),e=1,this._forAllStorageEntries(function(t){var r;return(r=n.exec(t))?e=Math.max(e,parseInt(r[1],10)+1):void 0}),e},n.prototype._forAllStorageEntries=function(t){var e,n,r,o;for(e=r=0,o=this.storage.length;o>=0?o>r:r>o;e=o>=0?++r:--r)n=this.storage.key(e),t.call(this,n,this.storage.getItem(n));return!0},n.prototype._storageEntriesMatching=function(t,e){var n,r;return n=this.storageRegExpForRecord(t.prototype),r=[],this._forAllStorageEntries(function(o,i){var a,s;return(s=n.exec(o))&&(a=this._jsonToAttributes(i),a[t.primaryKey]=s[1],this._dataMatches(e,a))?r.push(a):void 0}),r},n.prototype._dataMatches=function(t,e){var n,r,o;
r=!0;for(n in t)if(o=t[n],e[n]!==o){r=!1;break}return r},n.prototype.before("read","create","update","destroy",n.skipIfError(function(t,e){var n=this;return t.id="create"===t.action?t.subject.get("id")||t.subject._withoutDirtyTracking(function(){return t.subject.set("id",n.nextIdForRecord(t.subject))}):t.subject.get("id"),null==t.id?t.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+t.action+"!"):t.key=this.storageKey(t.subject)+t.id,e()})),n.prototype.before("create","update",n.skipIfError(function(t,e){return t.recordAttributes=JSON.stringify(t.subject),e()})),n.prototype.after("read",n.skipIfError(function(t,e){var n;if("string"==typeof t.recordAttributes)try{t.recordAttributes=this._jsonToAttributes(t.recordAttributes)}catch(r){return n=r,t.error=n,e()}return t.subject._withoutDirtyTracking(function(){return this.fromJSON(t.recordAttributes)}),e()})),n.prototype.after("read","create","update","destroy",n.skipIfError(function(t,e){return t.result=t.subject,e()})),n.prototype.after("readAll",n.skipIfError(function(t,e){var n;return t.result=t.records=function(){var e,r,o,i;for(o=t.recordsAttributes,i=[],e=0,r=o.length;r>e;e++)n=o[e],i.push(this.getRecordFromData(n,t.subject));return i}.call(this),e()})),n.prototype.read=n.skipIfError(function(t,e){return t.recordAttributes=this.storage.getItem(t.key),t.recordAttributes||(t.error=new this.constructor.NotFoundError),e()}),n.prototype.create=n.skipIfError(function(t,e){var n,r;return n=t.key,r=t.recordAttributes,this.storage.getItem(n)?arguments[0].error=new this.constructor.RecordExistsError:this.storage.setItem(n,r),e()}),n.prototype.update=n.skipIfError(function(t,e){var n,r;return n=t.key,r=t.recordAttributes,this.storage.setItem(n,r),e()}),n.prototype.destroy=n.skipIfError(function(t,e){var n;return n=t.key,this.storage.removeItem(n),e()}),n.prototype.readAll=n.skipIfError(function(t,e){var n;try{arguments[0].recordsAttributes=this._storageEntriesMatching(t.subject,t.options.data)}catch(r){n=r,arguments[0].error=n}return e()}),n}(Batman.StorageAdapter)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SessionStorage=function(t){function n(){return"undefined"==typeof window.sessionStorage?null:(n.__super__.constructor.apply(this,arguments),this.storage=sessionStorage,void 0)}return e(n,t),n}(Batman.LocalStorage)}.call(this),function(){Batman.Encoders=new Batman.Object}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ParamsReplacer=function(t){function n(t,e){this.navigator=t,this.params=e}return e(n,t),n.prototype.redirect=function(){return this.navigator.redirect(this.toObject(),!0)},n.prototype.replace=function(t){return this.params.replace(t),this.redirect()},n.prototype.update=function(t){return this.params.update(t),this.redirect()},n.prototype.clear=function(){return this.params.clear(),this.redirect()},n.prototype.toObject=function(){return this.params.toObject()},n.accessor({get:function(t){return this.params.get(t)},set:function(t,e){var n,r;return n=this.params.get(t),r=this.params.set(t,e),n!==e&&this.redirect(),r},unset:function(t){var e,n;return e=this.params.hasKey(t),n=this.params.unset(t),e&&this.redirect(),n}}),n}(Batman.Object)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ParamsPusher=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.redirect=function(){return this.navigator.redirect(this.toObject())},r}(Batman.ParamsReplacer)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.NamedRouteQuery=function(t){function n(t,e){var r;null==e&&(e=[]),n.__super__.constructor.call(this,{routeMap:t,args:e});for(r in this.get("routeMap").childrenByName)this[r]=this._queryAccess.bind(this,r)}return e(n,t),n.prototype.isNamedRouteQuery=!0,n.accessor("route",function(){var t,e,n,r,o,i,a;for(i=this.get("routeMap"),e=i.memberRoute,t=i.collectionRoute,a=[e,t],r=0,o=a.length;o>r;r++)if(n=a[r],null!=n&&n.namedArguments.length===this.get("args").length)return n;return t||e}),n.accessor("path",function(){return this.path()}),n.accessor("routeMap","args","cardinality","hashValue",Batman.Property.defaultAccessor),n.accessor({get:function(t){return null!=t?"string"==typeof t?this.nextQueryForName(t):this.nextQueryWithArgument(t):void 0},cache:!1}),n.accessor("withHash",function(){var t=this;return new Batman.Accessible(function(e){return t.withHash(e)})}),n.prototype.withHash=function(t){var e;return e=this.clone(),e.set("hashValue",t),e},n.prototype.nextQueryForName=function(t){var e;return(e=this.get("routeMap").childrenByName[t])?new Batman.NamedRouteQuery(e,this.args):Batman.developer.error("Couldn't find a route for the name "+t+"!")},n.prototype.nextQueryWithArgument=function(t){var e;return e=this.args.slice(0),e.push(t),this.clone(e)},n.prototype.path=function(){var t,e,n,r,o,i,a;for(o={},r=this.get("route.namedArguments"),n=i=0,a=r.length;a>i;n=++i)t=r[n],null!=(e=this.get("args")[n])&&(o[t]=this._toParam(e));return null!=this.get("hashValue")&&(o["#"]=this.get("hashValue")),this.get("route").pathFromParams(o)},n.prototype.toString=function(){return this.path()},n.prototype.clone=function(t){return null==t&&(t=this.args),new Batman.NamedRouteQuery(this.routeMap,t)},n.prototype._toParam=function(t){return t instanceof Batman.AssociationProxy&&(t=t.get("target")),null!=(null!=t?t.toParam:void 0)?t.toParam():t},n.prototype._queryAccess=function(t,e){var n;return n=this.nextQueryForName(t),null!=e&&(n=n.nextQueryWithArgument(e)),n},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Dispatcher=function(t){function n(t,e){n.__super__.constructor.call(this,{app:t,routeMap:e})}var r,o;return e(n,t),n.canInferRoute=function(t){return t instanceof Batman.Model||t instanceof Batman.AssociationProxy||t.prototype instanceof Batman.Model},n.paramsFromArgument=function(t){var e;return e=function(t){return Batman.helpers.camelize(Batman.helpers.pluralize(t.get("resourceName")),!0)},this.canInferRoute(t)?t instanceof Batman.Model||t instanceof Batman.AssociationProxy?(t.isProxy&&(t=t.get("target")),null!=t?{controller:e(t.constructor),action:"show",id:t.get("id")}:{}):t.prototype instanceof Batman.Model?{controller:e(t),action:"index"}:t:t},r=function(t){function n(){return o=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor("__app",Batman.Property.defaultAccessor),n.accessor(function(t){return this.get("__app."+Batman.helpers.capitalize(t)+"Controller.sharedController")}),n}(Batman.Object),n.accessor("controllers",function(){return new r({__app:this.get("app")})}),n.prototype.routeForParams=function(t){return t=this.constructor.paramsFromArgument(t),this.get("routeMap").routeForParams(t)},n.prototype.pathFromParams=function(t){var e;return"string"==typeof t?t:(t=this.constructor.paramsFromArgument(t),null!=(e=this.routeForParams(t))?e.pathFromParams(t):void 0)},n.prototype.dispatch=function(t,e){var n,r,o,i,a,s;if(r=this.constructor.paramsFromArgument(t),i=this.routeForParams(r))a=i.pathAndParamsFromArgument(r),o=a[0],t=a[1],e&&Batman.mixin(t,e),this.set("app.currentRoute",i),this.set("app.currentURL",o),this.get("app.currentParams").replace(t||{}),i.dispatch(t);else{if("Object"===Batman.typeOf(t)&&!this.constructor.canInferRoute(t))return this.get("app.currentParams").replace(t);if(this.get("app.currentParams").clear(),n={type:"404",isPrevented:!1,preventDefault:function(){return this.isPrevented=!0}},null!=(s=Batman.currentApp)&&s.fire("error",n),n.isPrevented)return t;if("/404"!==t)return Batman.redirect("/404")}return o},n}.call(this,Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Route=function(t){function n(t,e){var r,o,i,a,s,u,c,l,p,h;for(c=this.constructor.regexps,0!==t.indexOf("/")&&(t="/"+t),a=t.replace(c.escapeRegExp,"\\$&"),u=RegExp("^"+a.replace(c.openOptParam,"(?:").replace(c.closeOptParam,")?").replace(c.namedParam,"([^/]+)").replace(c.splatParam,"(.*?)")+c.queryParam+"$"),c.namedOrSplat.lastIndex=0,i=function(){var t;for(t=[];o=c.namedOrSplat.exec(a);)t.push(o[1]);return t}(),s={templatePath:t,pattern:a,regexp:u,namedArguments:i,baseParams:e},h=this.optionKeys,l=0,p=h.length;p>l;l++)r=h[l],s[r]=e[r],delete e[r];n.__super__.constructor.call(this,s)}return e(n,t),n.regexps={namedParam:/:([\w\d]+)/g,splatParam:/\*([\w\d]+)/g,queryParam:"(?:\\?.+)?",namedOrSplat:/[:|\*]([\w\d]+)/g,namePrefix:"[:|*]",escapeRegExp:/[-[\]{}+?.,\\^$|#\s]/g,openOptParam:/\(/g,closeOptParam:/\)/g},n.prototype.optionKeys=["member","collection"],n.prototype.testKeys=["controller","action"],n.prototype.isRoute=!0,n.prototype.paramsFromPath=function(t){var e,n,r,o,i,a,s,u,c;for(s=new Batman.URI(t),i=this.get("namedArguments"),a=Batman.extend({path:s.path},this.get("baseParams")),r=this.get("regexp").exec(s.path).slice(1),e=u=0,c=r.length;c>u;e=++u)n=r[e],o=i[e],a[o]=n;return Batman.extend(a,s.queryParams)},n.prototype.pathFromParams=function(t){var e,n,r,o,i,a,s,u,c,l,p,h,d,f,m;for(i=Batman.extend({},t),a=this.get("templatePath"),c=this.constructor.regexps,f=this.get("namedArguments"),l=0,h=f.length;h>l;l++)r=f[l],u=RegExp(""+c.namePrefix+r),o=a.replace(u,null!=i[r]?i[r]:""),o!==a&&(delete i[r],a=o);for(a=a.replace(c.openOptParam,"").replace(c.closeOptParam,"").replace(/([^\/])\/+$/,"$1"),m=this.testKeys,p=0,d=m.length;d>p;p++)n=m[p],delete i[n];return i["#"]&&(e=i["#"],delete i["#"]),s=Batman.URI.queryFromParams(i),s&&(a+="?"+s),e&&(a+="#"+e),a},n.prototype.test=function(t){var e,n,r,o,i,a;if("string"==typeof t)n=t;else if(null!=t.path)n=t.path;else for(n=this.pathFromParams(t),a=this.testKeys,o=0,i=a.length;i>o;o++)if(e=a[o],null!=(r=this.get(e))&&t[e]!==r)return!1;return this.get("regexp").test(n)},n.prototype.pathAndParamsFromArgument=function(t){var e,n;return"string"==typeof t?(e=this.paramsFromPath(t),n=t):(e=t,n=this.pathFromParams(t)),[n,e]},n.prototype.dispatch=function(t){return this.test(t)?this.get("callback")(t):!1},n.prototype.callback=function(){throw new Batman.DevelopmentError("Override callback in a Route subclass")},n}(Batman.Object)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ControllerActionRoute=function(e){function r(e,n){this.callback=t(this.callback,this);var o,i,a;n.signature&&(a=n.signature.split("#"),i=a[0],o=a[1],o||(o="index"),n.controller=i,n.action=o,delete n.signature),r.__super__.constructor.call(this,e,n)}return n(r,e),r.prototype.optionKeys=["member","collection","app","controller","action"],r.prototype.callback=function(t){var e;return e=this.get("app.dispatcher.controllers."+this.get("controller")),e.dispatch(this.get("action"),t)},r}(Batman.Route)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.CallbackActionRoute=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.optionKeys=["member","collection","callback","app"],r.prototype.controller=!1,r.prototype.action=!1,r}(Batman.Route)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.Hash=function(t){function r(){this.meta=new this.constructor.Metadata(this),Batman.SimpleHash.apply(this,arguments),r.__super__.constructor.apply(this,arguments)}var o,i,a,s,u,c,l,p;for(e(r,t),r.Metadata=function(t){function n(t){this.hash=t}return e(n,t),Batman.extend(n.prototype,Batman.Enumerable),n.accessor("length",function(){return this.hash.registerAsMutableSource(),this.hash.length}),n.accessor("isEmpty","keys","toArray",function(t){return this.hash.registerAsMutableSource(),this.hash[t]()}),n.prototype.forEach=function(){var t;return(t=this.hash).forEach.apply(t,arguments)},n}(Batman.Object),Batman.extend(r.prototype,Batman.Enumerable),r.prototype.propertyClass=Batman.Property,r.defaultAccessor={get:Batman.SimpleHash.prototype.get,set:r.mutation(function(t,e){var n;return n=Batman.SimpleHash.prototype.set.call(this,t,e),this.fire("itemsWereAdded",t),n}),unset:r.mutation(function(t){var e;return e=Batman.SimpleHash.prototype.unset.call(this,t),null!=e&&this.fire("itemsWereRemoved",t),e}),cache:!1},r.accessor(r.defaultAccessor),r.prototype._preventMutationEvents=function(t){this.prevent("change"),this.prevent("itemsWereAdded"),this.prevent("itemsWereRemoved");try{return t.call(this)}finally{this.allow("change"),this.allow("itemsWereAdded"),this.allow("itemsWereRemoved")}},r.prototype.clear=r.mutation(function(){var t,e;return t=this.keys(),this._preventMutationEvents(function(){var t=this;return this.forEach(function(e){return t.unset(e)})}),e=Batman.SimpleHash.prototype.clear.call(this),this.fire.apply(this,["itemsWereRemoved"].concat(n.call(t))),e}),r.prototype.update=r.mutation(function(t){var e;return e=[],this._preventMutationEvents(function(){var n=this;return Batman.forEach(t,function(t,r){return n.hasKey(t)||e.push(t),n.set(t,r)})}),e.length>0?this.fire.apply(this,["itemsWereAdded"].concat(n.call(e))):void 0}),r.prototype.replace=r.mutation(function(t){var e,r;return e=[],r=[],this._preventMutationEvents(function(){var n=this;return this.forEach(function(e){return Batman.objectHasKey(t,e)?void 0:(n.unset(e),r.push(e))}),Batman.forEach(t,function(t,r){return n.hasKey(t)||e.push(t),n.set(t,r)})}),e.length>0&&this.fire.apply(this,["itemsWereAdded"].concat(n.call(e))),r.length>0?this.fire.apply(this,["itemsWereRemoved"].concat(n.call(r))):void 0}),l=["equality","hashKeyFor","objectKey","prefixedKey","unprefixedKey"],a=0,u=l.length;u>a;a++)o=l[a],r.prototype[o]=Batman.SimpleHash.prototype[o];for(p=["hasKey","forEach","isEmpty","keys","toArray","merge","toJSON","toObject"],i=function(t){return r.prototype[t]=function(){return this.registerAsMutableSource(),Batman.SimpleHash.prototype[t].apply(this,arguments)}},s=0,c=p.length;c>s;s++)o=p[s],i(o);return r}.call(this,Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.RenderCache=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.keyQueue=[]}return e(n,t),n.prototype.maximumLength=4,n.prototype.viewForOptions=function(t){var e=this;return t.cache===!1||t.viewClass.prototype.cache===!1?this._newViewFromOptions(t):this.getOrSet(t,function(){return e._newViewFromOptions(Batman.extend({},t))})},n.prototype._newViewFromOptions=function(t){return new t.viewClass(t)},n.wrapAccessor(function(t){return{cache:!1,get:function(e){var n;return n=t.get.call(this,e),n&&this._addOrBubbleKey(e),n},set:function(e){var n;return n=t.set.apply(this,arguments),n.set("cached",!0),this._addOrBubbleKey(e),this._evictExpiredKeys(),n},unset:function(e){var n;return n=t.unset.apply(this,arguments),n.set("cached",!1),this._removeKeyFromQueue(e),n}}}),n.prototype.equality=function(t,e){var n;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(n in t)if("view"!==n&&t[n]!==e[n])return!1;return!0},n.prototype.reset=function(){var t,e,n,r,o;for(r=this.keyQueue.slice(0),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(this.unset(t));return o},n.prototype._addOrBubbleKey=function(t){return this._removeKeyFromQueue(t),this.keyQueue.unshift(t)},n.prototype._removeKeyFromQueue=function(t){var e,n,r,o,i;for(i=this.keyQueue,e=r=0,o=i.length;o>r;e=++r)if(n=i[e],this.equality(n,t)){this.keyQueue.splice(e,1);break}return t},n.prototype._evictExpiredKeys=function(){var t,e,n,r,o,i;if(this.length>this.maximumLength)for(t=this.keyQueue.slice(0),e=r=o=this.maximumLength,i=t.length;i>=o?i>r:r>i;e=i>=o?++r:--r)n=t[e],this.get(n).isInDOM()||this.unset(n)},n}(Batman.Hash)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice,o=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.Controller=function(e){function i(){this.redirect=t(this.redirect,this),this.handleError=t(this.handleError,this),this.errorHandler=t(this.errorHandler,this),i.__super__.constructor.apply(this,arguments),this._resetActionFrames()}var a;return n(i,e),i.singleton("sharedController"),i.wrapAccessor("routingKey",function(){return{get:function(){return null!=this.routingKey?this.routingKey:(Batman.config.minificationErrors&&Batman.developer.error("Please define `routingKey` on the prototype of "+Batman.functionName(this.constructor)+" in order for your controller to be minification safe."),Batman.functionName(this.constructor).replace(/Controller$/,""))}}}),i.accessor("_renderContext",function(){return Batman.RenderContext.root().descend(this)}),a=function(t,e){return e?"string"==typeof t?t={only:[t]}:(t.only&&"Array"!==Batman.typeOf(t.only)&&(t.only=[t.only]),t.except&&"Array"!==Batman.typeOf(t.except)&&(t.except=[t.except])):(e=t,t={}),t.block=e,t},i.beforeFilter=function(){var t,e,n;return Batman.initializeObject(this),e=a.apply(null,arguments),t=(n=this._batman).beforeFilters||(n.beforeFilters=[]),t.push(e)},i.afterFilter=function(){var t,e,n;return Batman.initializeObject(this),e=a.apply(null,arguments),t=(n=this._batman).afterFilters||(n.afterFilters=[]),t.push(e)},i.afterFilter(function(t){return this.autoScrollToHash&&null!=t["#"]?this.scrollToHash(t["#"]):void 0}),i.catchError=function(){var t,e,n,o,i,a,s,u,c,l;for(n=2<=arguments.length?r.call(arguments,0,s=arguments.length-1):(s=0,[]),i=arguments[s++],Batman.initializeObject(this),(a=this._batman).errorHandlers||(a.errorHandlers=new Batman.SimpleHash),o="Array"===Batman.typeOf(i["with"])?i["with"]:[i["with"]],l=[],u=0,c=n.length;c>u;u++)e=n[u],t=this._batman.errorHandlers.get(e)||[],l.push(this._batman.errorHandlers.set(e,t.concat(o)));return l},i.prototype.errorHandler=function(t){var e,n,r=this;return e=null!=(n=this._actionFrames)?n[this._actionFrames.length-1]:void 0,function(n,o,i){if(!n)return"function"==typeof t?t(o,i):void 0;if((null!=e?!e.error:!0)&&(null!=e&&(e.error=n),!r.handleError(n)))throw n}},i.prototype.handleError=function(t){var e,n,r=this;return e=!1,null!=(n=this.constructor._batman.getAll("errorHandlers"))&&n.forEach(function(n){return n.forEach(function(n,o){var i,a,s,u;if(t instanceof n){for(e=!0,u=[],a=0,s=o.length;s>a;a++)i=o[a],u.push(i.call(r,t));return u}})}),e},i.prototype.renderCache=new Batman.RenderCache,i.prototype.defaultRenderYield="main",i.prototype.autoScrollToHash=!0,i.prototype.dispatch=function(t,e){var n;return null==e&&(e={}),e.controller||(e.controller=this.get("routingKey")),e.action||(e.action=t),e.target||(e.target=this),this._resetActionFrames(),this.set("action",t),this.set("params",e),Batman.DOM.Yield.cycleAll(),this.executeAction(t,e),Batman.DOM.Yield.clearAllStale(),n=this._afterFilterRedirect,delete this._afterFilterRedirect,n?Batman.redirect(n):void 0},i.prototype.executeAction=function(t,e){var n,r,o,i,a,s,u=this;return null==e&&(e=this.get("params")),Batman.developer.assert(this[t],"Error! Controller action "+this.get("routingKey")+"."+t+" couldn't be found!"),o=this._actionFrames[this._actionFrames.length-1],n=new Batman.ControllerActionFrame({parentFrame:o,action:t},function(){var n;return u._afterFilterRedirect||u._runFilters(t,e,"afterFilters"),u._resetActionFrames(),null!=(n=Batman.navigator)?n.redirect=r:void 0}),this._actionFrames.push(n),n.startOperation({internal:!0}),r=null!=(a=Batman.navigator)?a.redirect:void 0,null!=(s=Batman.navigator)&&(s.redirect=this.redirect),this._runFilters(t,e,"beforeFilters"),this._afterFilterRedirect||(i=this[t](e)),n.operationOccurred||this.render(),n.finishOperation(),i},i.prototype.redirect=function(t){var e;return e=this._actionFrames[this._actionFrames.length-1],e?(e.operationOccurred&&Batman.developer.warn("Warning! Trying to redirect but an action has already been taken during "+this.get("routingKey")+"."+(e.action||this.get("action"))),e.startAndFinishOperation(),null!=this._afterFilterRedirect?Batman.developer.warn("Warning! Multiple actions trying to redirect!"):this._afterFilterRedirect=t):("Object"===Batman.typeOf(t)&&(t.controller||(t.controller=this)),Batman.redirect(t))},i.prototype.render=function(t){var e,n,r,o,i;return null==t&&(t={}),(n=null!=(o=this._actionFrames)?o[this._actionFrames.length-1]:void 0)&&n.startOperation(),t===!1?(n.finishOperation(),void 0):(e=(null!=n?n.action:void 0)||this.get("action"),t&&(t.into||(t.into=this.defaultRenderYield)),t.view?(r=t.view,t.view=null):(t.viewClass||(t.viewClass=this._viewClassForAction(e)),t.context||(t.context=this.get("_renderContext")),t.source||(t.source=Batman.helpers.underscore(this.get("routingKey")+"/"+e)),r=this.renderCache.viewForOptions(t)),r&&(null!=(i=Batman.currentApp)&&i.prevent("ready"),r.once("ready",function(){var e;return Batman.DOM.Yield.withName(t.into).replace(r.get("node")),null!=(e=Batman.currentApp)&&e.allowAndFire("ready"),null!=n?n.finishOperation():void 0})),r)},i.prototype.scrollToHash=function(t){return null==t&&(t=this.get("params")["#"]),Batman.DOM.scrollIntoView(t)},i.prototype._resetActionFrames=function(){return this._actionFrames=[]},i.prototype._viewClassForAction=function(t){var e,n;return e=this.get("routingKey").replace("/","_"),(null!=(n=Batman.currentApp)?n[Batman.helpers.camelize(""+e+"_"+t+"_view")]:void 0)||Batman.View},i.prototype._runFilters=function(t,e,n){var r,i,a,s,u;if(n=null!=(u=this.constructor._batman)?u.get(n):void 0)for(a=0,s=n.length;s>a;a++)if(i=n[a],!(i.only&&o.call(i.only,t)<0||i.except&&o.call(i.except,t)>=0)){if(this._afterFilterRedirect)return;r=i.block,"function"==typeof r?r.call(this,e):"function"==typeof this[r]&&this[r](e)}},i}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Set=function(t){function n(){Batman.SimpleSet.apply(this,arguments)}var r,o,i,a,s,u,c,l;for(e(n,t),Batman.extend(n.prototype,Batman.Enumerable),n._applySetAccessors=function(t){var e,n,r,o;n={first:function(){return this.toArray()[0]},last:function(){return this.toArray()[this.length-1]},isEmpty:function(){return this.isEmpty()},toArray:function(){return this.toArray()},length:function(){return this.registerAsMutableSource(),this.length},indexedBy:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.indexedBy(e)})},indexedByUnique:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.indexedByUnique(e)})},sortedBy:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.sortedBy(e)})},sortedByDescending:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.sortedBy(e,"desc")})}},o=[];for(r in n)e=n[r],o.push(t.accessor(r,e));return o},n._applySetAccessors(n),c=["add","remove","clear","replace","indexedBy","indexedByUnique","sortedBy","equality","_indexOfItem"],i=0,s=c.length;s>i;i++)r=c[i],n.prototype[r]=Batman.SimpleSet.prototype[r];for(l=["find","merge","forEach","toArray","isEmpty","has"],o=function(t){return n.prototype[t]=function(){return this.registerAsMutableSource(),Batman.SimpleSet.prototype[t].apply(this,arguments)}},a=0,u=l.length;u>a;a++)r=l[a],o(r);return n.prototype.toJSON=n.prototype.toArray,n}.call(this,Batman.Object)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ErrorsSet=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.accessor(function(t){return this.indexedBy("attribute").get(t)}),r.prototype.add=function(t,e){return r.__super__.add.call(this,new Batman.ValidationError(t,e))},r}(Batman.Set)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.SetProxy=function(t){function r(t){var e,o,i=this;this.base=t,r.__super__.constructor.call(this),this.length=this.base.length,"function"==typeof(e=this.base).on&&e.on("itemsWereAdded",function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],i.set("length",i.base.length),i.fire.apply(i,["itemsWereAdded"].concat(n.call(t)))}),"function"==typeof(o=this.base).on&&o.on("itemsWereRemoved",function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],i.set("length",i.base.length),i.fire.apply(i,["itemsWereRemoved"].concat(n.call(t)))})}var o,i,a,s,u;for(e(r,t),Batman.extend(r.prototype,Batman.Enumerable),r.prototype.filter=function(t){return this.reduce(function(e,n){return t(n)&&e.add(n),e},new Batman.Set)},r.prototype.replace=function(){var t,e;return t=this.property("length"),t.isolate(),e=this.base.replace.apply(this,arguments),t.expose(),e},Batman.Set._applySetAccessors(r),u=["add","remove","find","clear","has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy"],i=function(t){return r.prototype[t]=function(){var e;return(e=this.base)[t].apply(e,arguments)}},a=0,s=u.length;s>a;a++)o=u[a],i(o);return r.accessor("length",{get:function(){return this.registerAsMutableSource(),this.length},set:function(t,e){return this.length=e}}),r}.call(this,Batman.Object)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.BinarySetOperation=function(e){function o(e,n){this.left=e,this.right=n,this._setup=t(this._setup,this),o.__super__.constructor.call(this),this._setup(this.left,this.right),this._setup(this.right,this.left)}return n(o,e),o.prototype._setup=function(t,e){var n=this;return t.on("itemsWereAdded",function(){var o;return o=1<=arguments.length?r.call(arguments,0):[],n._itemsWereAddedToSource.apply(n,[t,e].concat(r.call(o)))}),t.on("itemsWereRemoved",function(){var o;return o=1<=arguments.length?r.call(arguments,0):[],n._itemsWereRemovedFromSource.apply(n,[t,e].concat(r.call(o)))}),this._itemsWereAddedToSource.apply(this,[t,e].concat(r.call(t.toArray())))},o.prototype.merge=function(){var t,e,n,o,i;for(e=1<=arguments.length?r.call(arguments,0):[],t=new Batman.Set,e.unshift(this),o=0,i=e.length;i>o;o++)n=e[o],n.forEach(function(e){return t.add(e)});return t},o.prototype.filter=Batman.SetProxy.prototype.filter,o}(Batman.Set)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.SetUnion=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype._itemsWereAddedToSource=function(){var t,e,n;return n=arguments[0],e=arguments[1],t=3<=arguments.length?r.call(arguments,2):[],this.add.apply(this,t)},o.prototype._itemsWereRemovedFromSource=function(){var t,e,n,o,i;return i=arguments[0],o=arguments[1],e=3<=arguments.length?r.call(arguments,2):[],n=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)||i.push(t);return i}(),this.remove.apply(this,n)},o}(Batman.BinarySetOperation)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.SetIntersection=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype._itemsWereAddedToSource=function(){var t,e,n,o,i;return i=arguments[0],o=arguments[1],e=3<=arguments.length?r.call(arguments,2):[],n=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)&&i.push(t);return i}(),n.length>0?this.add.apply(this,n):void 0},o.prototype._itemsWereRemovedFromSource=function(){var t,e,n;return n=arguments[0],e=arguments[1],t=3<=arguments.length?r.call(arguments,2):[],this.remove.apply(this,t)},o}(Batman.BinarySetOperation)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.SetComplement=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype._itemsWereAddedToSource=function(){var t,e,n,o,i,a;if(a=arguments[0],i=arguments[1],e=3<=arguments.length?r.call(arguments,2):[],a===this.left){if(n=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],i.has(t)||o.push(t);return o}(),n.length>0)return this.add.apply(this,n)}else if(o=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],i.has(t)&&o.push(t);return o}(),o.length>0)return this.remove.apply(this,o)},o.prototype._itemsWereRemovedFromSource=function(){var t,e,n,o,i;return i=arguments[0],o=arguments[1],e=3<=arguments.length?r.call(arguments,2):[],i===this.left?this.remove.apply(this,e):(n=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)&&i.push(t);return i}(),n.length>0?this.add.apply(this,n):void 0)},o.prototype._addComplement=function(t,e){var n,r;return r=function(){var r,o,i;for(i=[],r=0,o=t.length;o>r;r++)n=t[r],e.has(n)&&i.push(n);return i}(),r.length>0?this.add.apply(this,r):void 0},o}(Batman.BinarySetOperation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.StateMachine=function(t){function r(t){this.nextEvents=[],this.set("_state",t)}return e(r,t),r.InvalidTransitionError=function(t){this.message=null!=t?t:""},r.InvalidTransitionError.prototype=new Error,r.transitions=function(t){var e,r,o,i,a,s,u,c,l,p,h=this;for(o in t)c=t[o],c.from&&c.to&&(i={},c.from.forEach?c.from.forEach(function(t){return i[t]=c.to}):i[c.from]=c.to,t[o]=i);this.prototype.transitionTable=Batman.extend({},this.prototype.transitionTable,t),a=[],e=function(t){var e;return e="is"+Batman.helpers.capitalize(t),null==h.prototype[e]?(a.push(e),h.prototype[e]=function(){return this.get("state")===t}):void 0},p=this.prototype.transitionTable,l=function(t){return h.prototype[t]=function(){return this.startTransition(t)
}};for(o in p)if(u=p[o],!this.prototype[o]){l(o);for(r in u)s=u[r],e(r),e(s)}return a.length&&this.accessor.apply(this,n.call(a).concat([function(t){return this[t]()}])),this},r.accessor("state",function(){return this.get("_state")}),r.prototype.isTransitioning=!1,r.prototype.transitionTable={},r.prototype._transitionEvent=function(t,e){return""+t+"->"+e},r.prototype._enterEvent=function(t){return"enter "+t},r.prototype._exitEvent=function(t){return"exit "+t},r.prototype._beforeEvent=function(t){return"before "+t},r.prototype.onTransition=function(t,e,n){return this.on(this._transitionEvent(t,e),n)},r.prototype.onEnter=function(t,e){return this.on(this._enterEvent(t),e)},r.prototype.onExit=function(t,e){return this.on(this._exitEvent(t),e)},r.prototype.onBefore=function(t,e){return this.on(this._beforeEvent(t),e)},r.prototype.offTransition=function(t,e,n){return this.off(this._transitionEvent(t,e),n)},r.prototype.offEnter=function(t,e){return this.off(this._enterEvent(t),e)},r.prototype.offExit=function(t,e){return this.off(this._exitEvent(t),e)},r.prototype.offBefore=function(t,e){return this.off(this._beforeEvent(t),e)},r.prototype.startTransition=Batman.Property.wrapTrackingPrevention(function(t){var e,n;return this.isTransitioning?(this.nextEvents.push(t),void 0):(n=this.get("state"),(e=this.nextStateForEvent(t))?(this.fire(this._beforeEvent(e)),this.isTransitioning=!0,this.fire(this._exitEvent(n)),this.set("_state",e),this.fire(this._transitionEvent(n,e)),this.fire(this._enterEvent(e)),this.fire(t),this.isTransitioning=!1,this.nextEvents.length>0&&this.startTransition(this.nextEvents.shift()),!0):!1)}),r.prototype.canStartTransition=function(t,e){return null==e&&(e=this.get("state")),!!this.nextStateForEvent(t,e)},r.prototype.nextStateForEvent=function(t,e){var n;return null==e&&(e=this.get("state")),null!=(n=this.transitionTable[t])?n[e]:void 0},r}(Batman.Object),Batman.DelegatingStateMachine=function(t){function n(t,e){this.base=e,n.__super__.constructor.call(this,t)}return e(n,t),n.prototype.fire=function(){var t,e;return t=n.__super__.fire.apply(this,arguments),(e=this.base).fire.apply(e,arguments),t},n}(Batman.StateMachine)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.Model=function(t){function r(t){null==t&&(t={}),Batman.developer.assert(this instanceof Batman.Object,"constructors must be called with new"),"Object"===Batman.typeOf(t)?r.__super__.constructor.call(this,t):(r.__super__.constructor.call(this),this.set("id",t))}var o,i,a,s,u,c,l,p;for(e(r,t),r.storageKey=null,r.primaryKey="id",r.persist=function(){var t,e;return t=arguments[0],e=2<=arguments.length?n.call(arguments,1):[],Batman.initializeObject(this.prototype),t=t.isStorageAdapter?t:new t(this),e.length>0&&Batman.mixin.apply(Batman,[t].concat(n.call(e))),this.prototype._batman.storage=t,t},r.storageAdapter=function(){return Batman.initializeObject(this.prototype),this.prototype._batman.storage},r.encode=function(){var t,e,r,o,i,a,s,u,c;switch(i=2<=arguments.length?n.call(arguments,0,s=arguments.length-1):(s=0,[]),r=arguments[s++],Batman.initializeObject(this.prototype),(a=this.prototype._batman).encoders||(a.encoders=new Batman.SimpleHash),t={},Batman.typeOf(r)){case"String":i.push(r);break;case"Function":t.encode=r;break;default:t=r}for(u=0,c=i.length;c>u;u++)o=i[u],e=Batman.extend({as:o},this.defaultEncoder,t),this.prototype._batman.encoders.set(o,e)},r.defaultEncoder={encode:function(t){return t},decode:function(t){return t}},r.observeAndFire("primaryKey",function(t,e){return this.encode(e,{encode:!1,decode:!1}),this.encode(t,{encode:!1,decode:this.defaultEncoder.decode})}),r.validate=function(){var t,e,r,o,i,a,s,u,c,l,p;if(t=2<=arguments.length?n.call(arguments,0,s=arguments.length-1):(s=0,[]),r=arguments[s++],Batman.initializeObject(this.prototype),i=(a=this.prototype._batman).validators||(a.validators=[]),"function"==typeof r)return i.push({keys:t,callback:r});for(l=Batman.Validators,p=[],u=0,c=l.length;c>u;u++)o=l[u],(e=o.matches(r))?p.push(i.push({keys:t,validator:new o(e)})):p.push(void 0);return p},r.classAccessor("resourceName",{get:function(){return null!=this.resourceName?this.resourceName:null!=this.prototype.resourceName?(Batman.config.minificationErrors&&Batman.developer.error("Please define the resourceName property of the "+Batman.functionName(this)+" on the constructor and not the prototype."),this.prototype.resourceName):(Batman.config.minificationErrors&&Batman.developer.error("Please define "+Batman.functionName(this)+".resourceName in order for your model to be minification safe."),Batman.helpers.underscore(Batman.functionName(this)))}}),r.classAccessor("all",{get:function(){return this._batman.check(this),this.prototype.hasStorage()&&!this._batman.allLoadTriggered&&(this.load(),this._batman.allLoadTriggered=!0),this.get("loaded")},set:function(t,e){return this.set("loaded",e)}}),r.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new Batman.Set)},set:function(t,e){return this._loaded=e}}),r.classAccessor("first",function(){return this.get("all").toArray()[0]}),r.classAccessor("last",function(){var t;return t=this.get("all").toArray(),t[t.length-1]}),r.clear=function(){var t,e;return Batman.initializeObject(this),t=this.get("loaded").clear(),null!=(e=this._batman.get("associations"))&&e.reset(),this._resetPromises(),t},r.find=function(t,e){return this.findWithOptions(t,void 0,e)},r.findWithOptions=function(t,e,n){var r;return null==e&&(e={}),Batman.developer.assert(n,"Must call find with a callback!"),r=new this,r._withoutDirtyTracking(function(){return this.set("id",t)}),r.loadWithOptions(e,n),r},r.load=function(t,e){var n;return"function"==(n=typeof t)||"undefined"===n?(e=t,t={}):t={data:t},this.loadWithOptions(t,e)},r.loadWithOptions=function(t,e){var n=this;return this.fire("loading",t),this._doStorageOperation("readAll",t,function(t,r,o){var i;return null!=t?(n.fire("error",t),"function"==typeof e?e(t,[]):void 0):(i=n._mapIdentities(r),n.fire("loaded",i,o),"function"==typeof e?e(t,i,o):void 0)})},r.create=function(t,e){var n,r;return e||(r=[{},t],t=r[0],e=r[1]),n=new this(t),n.save(e),n},r.findOrCreate=function(t,e){var n,r;return r=new this(t),r.isNew()?r.save(e):(n=this._mapIdentity(r),e(void 0,n)),r},r.createFromJSON=function(t){var e;return e=new this,e._withoutDirtyTracking(function(){return this.fromJSON(t)}),this._mapIdentity(e)},r._mapIdentity=function(t){return this._mapIdentities([t])[0]},r._makeOrFindRecordFromData=function(t){var e,n,r;return(n=t[this.primaryKey])&&(e=this.get("loaded.indexedByUnique.id").get(n))?(e._withoutDirtyTracking(function(){return this.fromJSON(t)}),e):(r=new this,r._withoutDirtyTracking(function(){return this.fromJSON(t)}),this._mapIdentity(r),r)},r._mapIdentities=function(t){var e,n,r,o,i,a,s,u,c;for(o=[],r=a=0,s=t.length;s>a;r=++a)i=t[r],null!=(n=i.get("id"))&&((e=null!=(u=this.get("loaded.indexedBy.id").get(n))?u.toArray()[0]:void 0)?(e._withoutDirtyTracking(function(){var t;return this.updateAttributes((null!=(t=i.get("attributes"))?t.toObject():void 0)||{})}),t[r]=e):o.push(i));return o.length&&(c=this.get("loaded")).add.apply(c,o),t},r._doStorageOperation=function(t,e,n){var r;return Batman.developer.assert(this.prototype.hasStorage(),"Can't "+t+" model "+Batman.functionName(this.constructor)+" without any storage adapters!"),r=this.prototype._batman.get("storage"),r.perform(t,this,e,n)},c=["find","load","create"],i=0,s=c.length;s>i;i++)o=c[i],r[o]=Batman.Property.wrapTrackingPrevention(r[o]);for(r.InstanceLifecycleStateMachine=function(t){function n(){return l=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.transitions({load:{from:["dirty","clean"],to:"loading"},create:{from:["dirty","clean"],to:"creating"},save:{from:["dirty","clean"],to:"saving"},destroy:{from:["dirty","clean"],to:"destroying"},failedValidation:{from:["saving","creating"],to:"dirty"},loaded:{loading:"clean"},created:{creating:"clean"},saved:{saving:"clean"},destroyed:{destroying:"destroyed"},set:{from:["dirty","clean"],to:"dirty"},error:{from:["saving","creating","loading","destroying"],to:"error"}}),n}(Batman.DelegatingStateMachine),r.accessor("lifecycle",function(){return this.lifecycle||(this.lifecycle=new Batman.Model.InstanceLifecycleStateMachine("clean",this))}),r.accessor("attributes",function(){return this.attributes||(this.attributes=new Batman.Hash)}),r.accessor("dirtyKeys",function(){return this.dirtyKeys||(this.dirtyKeys=new Batman.Hash)}),r.accessor("_dirtiedKeys",function(){return this._dirtiedKeys||(this._dirtiedKeys=new Batman.SimpleSet)}),r.accessor("errors",function(){return this.errors||(this.errors=new Batman.ErrorsSet)}),r.accessor("isNew",function(){return this.isNew()}),r.accessor("isDirty",function(){return this.isDirty()}),r.accessor(r.defaultAccessor={get:function(t){return Batman.getPath(this,["attributes",t])},set:function(t,e){return this._willSet(t)?this.get("attributes").set(t,e):this.get(t)},unset:function(t){return this.get("attributes").unset(t)}}),r.wrapAccessor("id",function(t){return{get:function(){var e;return e=this.constructor.primaryKey,"id"===e?t.get.apply(this,arguments):this.get(e)},set:function(e,n){var r,o;return"string"==typeof n&&null===n.match(/[^0-9]/)&&""+(r=parseInt(n,10))===n&&(n=r),o=this.constructor.primaryKey,"id"===o?(this._willSet(e),t.set.apply(this,arguments)):this.set(o,n)}}}),r.prototype.isNew=function(){return"undefined"==typeof this.get("id")},r.prototype.isDirty=function(){return"dirty"===this.get("lifecycle.state")},r.prototype.updateAttributes=function(t){return this.mixin(t),this},r.prototype.toString=function(){return""+this.constructor.get("resourceName")+": "+this.get("id")},r.prototype.toParam=function(){return this.get("id")},r.prototype.toJSON=function(){var t,e,n=this;return e={},t=this._batman.get("encoders"),t&&!t.isEmpty()&&t.forEach(function(t,r){var o,i;return r.encode&&(i=n.get(t),"undefined"!=typeof i&&(o=r.encode(i,t,e,n),"undefined"!=typeof o))?e[r.as]=o:void 0}),e},r.prototype.fromJSON=function(t){var e,n,r,o,i=this;if(r={},e=this._batman.get("encoders"),e&&!e.isEmpty()&&e.some(function(t,e){return null!=e.decode}))e.forEach(function(e,n){return n.decode&&"undefined"!=typeof t[n.as]?r[e]=n.decode(t[n.as],n.as,t,r,i):void 0});else for(n in t)o=t[n],r[n]=o;return"id"!==this.constructor.primaryKey&&(r.id=t[this.constructor.primaryKey]),Batman.developer["do"](function(){return!e||e.length<=1?Batman.developer.warn("Warning: Model "+Batman.functionName(i.constructor)+" has suspiciously few decoders!"):void 0}),this.mixin(r)},r.prototype.hasStorage=function(){return null!=this._batman.get("storage")},r.prototype.load=function(t,e){var n;return e?t={data:t}:(n=[{},t],t=n[0],e=n[1]),this.loadWithOptions(t,e)},r.prototype.loadWithOptions=function(t,e){var n,r,o,i=this;return r=0!==Object.keys(t).length,"destroying"===(o=this.get("lifecycle.state"))||"destroyed"===o?("function"==typeof e&&e(new Error("Can't load a destroyed record!")),void 0):this.get("lifecycle").load()?(n=[],null!=e&&n.push(e),r||(this._currentLoad=n),this._doStorageOperation("read",t,function(t,o,a){var s,u;for(t?i.get("lifecycle").error():(i.get("lifecycle").loaded(),o=i.constructor._mapIdentity(o)),r||(i._currentLoad=null),s=0,u=n.length;u>s;s++)e=n[s],e(t,o,a)})):"loading"!==this.get("lifecycle.state")||r?"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't load while in state "+this.get("lifecycle.state"))):void 0:null!=e?this._currentLoad.push(e):void 0},r.prototype.save=function(t,e){var n,r,o,i,a,s,u=this;return e||(a=[{},t],t=a[0],e=a[1]),r=this.isNew(),s=r?["create","create","created"]:["save","update","saved"],o=s[0],i=s[1],n=s[2],this.get("lifecycle").startTransition(o)?this.validate(function(r,o){var a;return r||o.length?(u.get("lifecycle").failedValidation(),"function"==typeof e?e(r||o,u):void 0):(a=u.constructor._batman.get("associations"),u._withoutDirtyTracking(function(){var t,e=this;return null!=a?null!=(t=a.getByType("belongsTo"))?t.forEach(function(t){return t.apply(e)}):void 0:void 0}),u._doStorageOperation(i,{data:t},function(t,r,o){return t?t instanceof Batman.ErrorsSet?u.get("lifecycle").failedValidation():u.get("lifecycle").error():(u.get("dirtyKeys").clear(),u.get("_dirtiedKeys").clear(),a&&r._withoutDirtyTracking(function(){var e,n;return null!=(e=a.getByType("hasOne"))&&e.forEach(function(e){return e.apply(t,r)}),null!=(n=a.getByType("hasMany"))?n.forEach(function(e){return e.apply(t,r)}):void 0}),r=u.constructor._mapIdentity(r),u.get("lifecycle").startTransition(n)),"function"==typeof e?e(t,r||u,o):void 0}))}):"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't save while in state "+this.get("lifecycle.state"))):void 0},r.prototype.destroy=function(t,e){var n,r=this;return e||(n=[{},t],t=n[0],e=n[1]),this.get("lifecycle").destroy()?this._doStorageOperation("destroy",{data:t},function(t,n,o){return t?r.get("lifecycle").error():(r.constructor.get("loaded").remove(r),r.get("lifecycle").destroyed()),"function"==typeof e?e(t,n,o):void 0}):"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't destroy while in state "+this.get("lifecycle.state"))):void 0},r.prototype.validate=function(t){var e,n,r,o,i,a,s,u,c,l,p,h,d;if(o=this.get("errors"),o.clear(),u=this._batman.get("validators")||[],!u||0===u.length)return"function"==typeof t&&t(void 0,o),!0;for(n=u.reduce(function(t,e){return t+e.keys.length},0),i=function(){return 0===--n?"function"==typeof t?t(void 0,o):void 0:void 0},c=0,p=u.length;p>c;c++)for(s=u[c],d=s.keys,l=0,h=d.length;h>l;l++){a=d[l],e=[o,this,a,i];try{s.validator?s.validator.validateEach.apply(s.validator,e):s.callback.apply(s,e)}catch(f){r=f,"function"==typeof t&&t(r,o)}}},r.prototype.associationProxy=function(t){var e,n,r;return Batman.initializeObject(this),e=(n=this._batman).associationProxies||(n.associationProxies={}),e[r=t.label]||(e[r]=new t.proxyClass(t,this)),e[t.label]},r.prototype._willSet=function(t){return this._pauseDirtyTracking?!0:this.get("lifecycle").startTransition("set")?(this.get("_dirtiedKeys").has(t)||(this.set("dirtyKeys."+t,this.get(t)),this.get("_dirtiedKeys").add(t)),!0):!1},r.prototype._doStorageOperation=function(t,e,n){var r;return Batman.developer.assert(this.hasStorage(),"Can't "+t+" model "+Batman.functionName(this.constructor)+" without any storage adapters!"),r=this._batman.get("storage"),r.perform(t,this,e,function(){return n.apply(null,arguments)})},r.prototype._withoutDirtyTracking=function(t){var e;return this._pauseDirtyTracking=!0,e=t.call(this),this._pauseDirtyTracking=!1,e},p=["load","save","validate","destroy"],a=0,u=p.length;u>a;a++)o=p[a],r.prototype[o]=Batman.Property.wrapTrackingPrevention(r.prototype[o]);return r}.call(this,Batman.Object)}.call(this),function(){var t,e,n,r,o;for(o=Batman.AssociationCurator.availableAssociations,e=function(t){return Batman.Model[t]=function(e,n){var r,o;return Batman.initializeObject(this),r=(o=this._batman).associations||(o.associations=new Batman.AssociationCurator(this)),r.add(new(Batman[""+Batman.helpers.capitalize(t)+"Association"])(this,e,n))}},n=0,r=o.length;r>n;n++)t=o[n],e(t)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Proxy=function(t){function n(t){n.__super__.constructor.call(this),null!=t&&this.set("target",t)}return e(n,t),n.prototype.isProxy=!0,n.accessor("target",Batman.Property.defaultAccessor),n.accessor({get:function(t){var e;return null!=(e=this.get("target"))?e.get(t):void 0},set:function(t,e){var n;return null!=(n=this.get("target"))?n.set(t,e):void 0},unset:function(t){var e;return null!=(e=this.get("target"))?e.unset(t):void 0}}),n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.AssociationProxy=function(t){function n(t,e){this.association=t,this.model=e,n.__super__.constructor.call(this)}return e(n,t),n.prototype.loaded=!1,n.prototype.toJSON=function(){var t;return t=this.get("target"),null!=t?this.get("target").toJSON():void 0},n.prototype.load=function(t){var e=this;return this.fetch(function(n,r){return n||e._setTarget(r),"function"==typeof t?t(n,r):void 0}),this.get("target")},n.prototype.loadFromLocal=function(){var t;if(this._canLoad())return(t=this.fetchFromLocal())&&this._setTarget(t),t},n.prototype.fetch=function(t){var e;return this._canLoad()?(e=this.fetchFromLocal(),e?t(void 0,e):this.fetchFromRemote(t)):t(void 0,void 0)},n.accessor("loaded",Batman.Property.defaultAccessor),n.accessor("target",{get:function(){return this.fetchFromLocal()},set:function(t,e){return e}}),n.prototype._canLoad=function(){return null!=(this.get("foreignValue")||this.get("primaryValue"))},n.prototype._setTarget=function(t){return this.set("target",t),this.set("loaded",!0),this.fire("loaded",t)},n}(Batman.Proxy)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.HasOneProxy=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.accessor("primaryValue",function(){return this.model.get(this.association.primaryKey)}),r.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("primaryValue"))},r.prototype.fetchFromRemote=function(t){var e;return e={data:{}},e.data[this.association.foreignKey]=this.get("primaryValue"),this.association.options.url&&(e.collectionUrl=this.association.options.url,e.urlContext=this.model),this.association.getRelatedModel().loadWithOptions(e,function(e,n){if(e)throw e;return!n||n.length<=0?t(new Error("Couldn't find related record!"),void 0):t(void 0,n[0])})},r}(Batman.AssociationProxy)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.BelongsToProxy=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.accessor("foreignValue",function(){return this.model.get(this.association.foreignKey)}),r.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("foreignValue"))},r.prototype.fetchFromRemote=function(t){var e;return e={},this.association.options.url&&(e.recordUrl=this.association.options.url),this.association.getRelatedModel().findWithOptions(this.get("foreignValue"),e,function(e,n){if(e)throw e;return t(void 0,n)})},r}(Batman.AssociationProxy)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PolymorphicBelongsToProxy=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.accessor("foreignTypeValue",function(){return this.model.get(this.association.foreignTypeKey)}),r.prototype.fetchFromLocal=function(){return this.association.setIndexForType(this.get("foreignTypeValue")).get(this.get("foreignValue"))},r.prototype.fetchFromRemote=function(t){var e;return e={},this.association.options.url&&(e.recordUrl=this.association.options.url),this.association.getRelatedModelForType(this.get("foreignTypeValue")).findWithOptions(this.get("foreignValue"),e,function(e,n){if(e)throw e;return t(void 0,n)})},r}(Batman.BelongsToProxy)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Accessible=function(t){function e(){this.accessor.apply(this,arguments)}return n(e,t),e}(Batman.Object),Batman.TerminalAccessible=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.propertyClass=Batman.Property,r}(Batman.Accessible)}.call(this),function(){Batman.mixins=new Batman.Object}.call(this),function(){Batman.URI=function(){function t(t){var n,r;for(r=h.exec(t),n=14;n--;)this[e[n]]=r[n]||"";this.queryParams=this.constructor.paramsFromQuery(this.query),delete this.authority,delete this.userInfo,delete this.relative,delete this.directory,delete this.file,delete this.query}var e,n,r,o,i,a,s,u,c,l,p,h;return h=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","hostname","port","relative","path","directory","file","query","hash"],t.prototype.queryString=function(){return this.constructor.queryFromParams(this.queryParams)},t.prototype.toString=function(){return[this.protocol?""+this.protocol+":":void 0,this.authority()?"//":void 0,this.authority(),this.relative()].join("")},t.prototype.userInfo=function(){return[this.user,this.password?":"+this.password:void 0].join("")},t.prototype.authority=function(){return[this.userInfo(),this.user||this.password?"@":void 0,this.hostname,this.port?":"+this.port:void 0].join("")},t.prototype.relative=function(){var t;return t=this.queryString(),[this.path,t?"?"+t:void 0,this.hash?"#"+this.hash:void 0].join("")},t.prototype.directory=function(){var t;return t=this.path.split("/"),t.length>1?t.slice(0,t.length-1).join("/")+"/":""},t.prototype.file=function(){var t;return t=this.path.split("/"),t[t.length-1]},t.paramsFromQuery=function(t){var e,n,o,i,s,c;for(n={},c=t.split("&"),i=0,s=c.length;s>i;i++)o=c[i],(e=o.match(a))?u(n,r(e[1]),r(e[2])):u(n,r(o),null);return n},t.decodeQueryComponent=r=function(t){return decodeURIComponent(t.replace(c,"%20"))},s=/^[\[\]]*([^\[\]]+)\]*(.*)/,n=[/^\[\]\[([^\[\]]+)\]$/,/^\[\](.+)$/],c=/\+/g,p=/%20/g,a=/^([^=]*)=(.*)/,u=function(t,e,r){var o,i,a,c,l,p,h,d;if(l=e.match(s)){if(a=l[1],o=l[2],""===o)t[a]=r;else if("[]"===o){if(null==(p=t[a])&&(t[a]=[]),"Array"!==Batman.typeOf(t[a]))throw new Error("expected Array (got "+Batman.typeOf(t[a])+') for param "'+a+'"');t[a].push(r)}else if(l=o.match(n[0])||o.match(n[1])){if(i=l[1],null==(h=t[a])&&(t[a]=[]),"Array"!==Batman.typeOf(t[a]))throw new Error("expected Array (got "+Batman.typeOf(t[a])+') for param "'+a+'"');c=t[a][t[a].length-1],"Object"!==Batman.typeOf(c)||i in c?t[a].push(u({},i,r)):u(c,i,r)}else{if(null==(d=t[a])&&(t[a]={}),"Object"!==Batman.typeOf(t[a]))throw new Error("expected Object (got "+Batman.typeOf(t[a])+') for param "'+a+'"');t[a]=u(t[a],o,r)}return t}},t.queryFromParams=l=function(t,e){var n,r,o,a;if(null==t)return e;if(a=Batman.typeOf(t),null==e&&"Object"!==a)throw new Error("value must be an Object");switch(a){case"Array":return function(){var r,i;if(n=[],0===t.length)n.push(l(null,""+e+"[]"));else for(r=0,i=t.length;i>r;r++)o=t[r],n.push(l(o,""+e+"[]"));return n}().join("&");case"Object":return function(){var n;n=[];for(r in t)o=t[r],n.push(l(o,e?""+e+"["+i(r)+"]":i(r)));return n}().join("&");default:return null!=e?""+e+"="+i(t):i(t)}},t.encodeComponent=o=function(t){return null!=t?encodeURIComponent(t):""},t.encodeQueryComponent=i=function(t){return o(t).replace(p,"+")},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Request=function(t){function n(t){var e,r,o,i;r={};for(o in t)e=t[o],("success"===o||"error"===o||"loading"===o||"loaded"===o)&&(r[o]=e,delete t[o]);n.__super__.constructor.call(this,t);for(o in r)e=r[o],this.on(o,e);(null!=(i=this.get("url"))?i.length:void 0)>0?this.autosend&&this.send():this.observe("url",function(t){return null!=t?this.send():void 0})}var r;return e(n,t),n.objectToFormData=function(t){var e,n,r,o,i,a,s,u;for(r=function(t,e,n){var o,i,a;return null==n&&(n=!1),e instanceof Batman.container.File?[[t,e]]:i=function(){switch(Batman.typeOf(e)){case"Object":return i=function(){var i;i=[];for(o in e)a=e[o],i.push(r(n?o:""+t+"["+o+"]",a));return i}(),i.reduce(function(t,e){return t.concat(e)},[]);case"Array":return e.reduce(function(e,n){return e.concat(r(""+t+"[]",n))},[]);default:return[[t,null!=e?e:""]]}}()},e=new Batman.container.FormData,s=r("",t,!0),i=0,a=s.length;a>i;i++)u=s[i],n=u[0],o=u[1],e.append(n,o);return e},n.dataHasFileUploads=r=function(t){var e,n,o,i,a;if("undefined"!=typeof File&&null!==File&&t instanceof File)return!0;switch(n=Batman.typeOf(t)){case"Object":for(e in t)if(o=t[e],r(o))return!0;break;case"Array":for(i=0,a=t.length;a>i;i++)if(o=t[i],r(o))return!0}return!1},n.wrapAccessor("method",function(t){return{set:function(e,n){return t.set.call(this,e,null!=n?"function"==typeof n.toUpperCase?n.toUpperCase():void 0:void 0)}}}),n.prototype.method="GET",n.prototype.hasFileUploads=function(){return r(this.data)},n.prototype.contentType="application/x-www-form-urlencoded",n.prototype.autosend=!0,n.prototype.send=function(){return Batman.developer.error("Please source a dependency file for a request implementation")},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.SetObserver=function(t){function r(t){var e=this;this.base=t,this._itemObservers=new Batman.SimpleHash,this._setObservers=new Batman.SimpleHash,this._setObservers.set("itemsWereAdded",function(){return e.fire.apply(e,["itemsWereAdded"].concat(n.call(arguments)))}),this._setObservers.set("itemsWereRemoved",function(){return e.fire.apply(e,["itemsWereRemoved"].concat(n.call(arguments)))}),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}return e(r,t),r.prototype.observedItemKeys=[],r.prototype.observerForItemAndKey=function(){},r.prototype._getOrSetObserverForItemAndKey=function(t,e){var n=this;return this._itemObservers.getOrSet(t,function(){var r;return r=new Batman.SimpleHash,r.getOrSet(e,function(){return n.observerForItemAndKey(t,e)})})},r.prototype.startObserving=function(){return this._manageItemObservers("observe"),this._manageSetObservers("addHandler")},r.prototype.stopObserving=function(){return this._manageItemObservers("forget"),this._manageSetObservers("removeHandler")},r.prototype.startObservingItems=function(){var t,e,r,o,i;for(e=1<=arguments.length?n.call(arguments,0):[],i=[],r=0,o=e.length;o>r;r++)t=e[r],i.push(this._manageObserversForItem(t,"observe"));return i},r.prototype.stopObservingItems=function(){var t,e,r,o,i;for(e=1<=arguments.length?n.call(arguments,0):[],i=[],r=0,o=e.length;o>r;r++)t=e[r],i.push(this._manageObserversForItem(t,"forget"));return i},r.prototype._manageObserversForItem=function(t,e){var n,r,o,i;if(t.isObservable){for(i=this.observedItemKeys,r=0,o=i.length;o>r;r++)n=i[r],t[e](n,this._getOrSetObserverForItemAndKey(t,n));return"forget"===e?this._itemObservers.unset(t):void 0}},r.prototype._manageItemObservers=function(t){var e=this;return this.base.forEach(function(n){return e._manageObserversForItem(n,t)})},r.prototype._manageSetObservers=function(t){var e=this;if(this.base.isObservable)return this._setObservers.forEach(function(n,r){return e.base.event(n)[t](r)})},r}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SetSort=function(t){function n(t,e,r){var o,i=this;this.key=e,null==r&&(r="asc"),n.__super__.constructor.call(this,t),this.descending="desc"===r.toLowerCase(),this.base.isObservable&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],o=function(){return i._reIndex()},this._setObserver.observerForItemAndKey=function(){return o},this._setObserver.on("itemsWereAdded",o),this._setObserver.on("itemsWereRemoved",o),this.startObserving()),this._reIndex()}return e(n,t),n.prototype.startObserving=function(){var t;return null!=(t=this._setObserver)?t.startObserving():void 0},n.prototype.stopObserving=function(){var t;return null!=(t=this._setObserver)?t.stopObserving():void 0},n.prototype.toArray=function(){return this.get("_storage")},n.prototype.forEach=function(t,e){var n,r,o,i,a,s;for(a=this.get("_storage"),s=[],r=o=0,i=a.length;i>o;r=++o)n=a[r],s.push(t.call(e,n,r,this));return s},n.prototype.find=function(t){var e,n,r,o;for(this.base.registerAsMutableSource(),o=this.get("_storage"),n=0,r=o.length;r>n;n++)if(e=o[n],t(e))return e},n.prototype.merge=function(t){return this.base.registerAsMutableSource(),function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(Batman.Set,this._storage,function(){}).merge(t).sortedBy(this.key,this.order)},n.prototype.compare=function(t,e){return t===e?0:void 0===t?1:void 0===e?-1:null===t?1:null===e?-1:t===!1?1:e===!1?-1:t===!0?1:e===!0?-1:t!==t?e!==e?0:1:e!==e?-1:t>e?1:e>t?-1:0},n.prototype._reIndex=function(){var t,e,n=this;return t=this.base.toArray().sort(function(t,e){var r,o,i;return o=Batman.get(t,n.key),"function"==typeof o&&(o=o.call(t)),null!=o&&(o=o.valueOf()),i=Batman.get(e,n.key),"function"==typeof i&&(i=i.call(e)),null!=i&&(i=i.valueOf()),r=n.descending?-1:1,n.compare.call(n,o,i)*r}),null!=(e=this._setObserver)&&e.startObservingItems.apply(e,t),this.set("_storage",t)},n}(Batman.SetProxy)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.AssociationSet=function(t){function n(t,e){var r;this.foreignKeyValue=t,this.association=e,r=new Batman.Set,n.__super__.constructor.call(this,r,"_batmanID")}return e(n,t),n.prototype.loaded=!1,n.prototype.load=function(t){var e=this;return null==this.foreignKeyValue?t(void 0,this):this.association.getRelatedModel().loadWithOptions(this._getLoadOptions(),function(n){return n||e.markAsLoaded(),t(n,e)})},n.prototype._getLoadOptions=function(){var t;return t={data:{}},t.data[this.association.foreignKey]=this.foreignKeyValue,this.association.options.url&&(t.collectionUrl=this.association.options.url,t.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),t},n.accessor("loaded",Batman.Property.defaultAccessor),n.prototype.markAsLoaded=function(){return this.set("loaded",!0),this.fire("loaded")},n}(Batman.SetSort)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicAssociationSet=function(t){function n(t,e,r){this.foreignKeyValue=t,this.foreignTypeKeyValue=e,this.association=r,n.__super__.constructor.call(this,this.foreignKeyValue,this.association)}return e(n,t),n.prototype._getLoadOptions=function(){var t;return t={data:{}},t.data[this.association.foreignKey]=this.foreignKeyValue,t.data[this.association.foreignTypeKey]=this.foreignTypeKeyValue,this.association.options.url&&(t.collectionUrl=this.association.options.url,t.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),t},n}(Batman.AssociationSet)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e
},n=[].slice;Batman.SetIndex=function(t){function r(t,e){var o=this;this.base=t,this.key=e,r.__super__.constructor.call(this),this._storage=new Batman.Hash,this.base.isEventEmitter&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",function(){var t,e,r,i,a;for(e=1<=arguments.length?n.call(arguments,0):[],a=[],r=0,i=e.length;i>r;r++)t=e[r],a.push(o._addItem(t));return a}),this._setObserver.on("itemsWereRemoved",function(){var t,e,r,i,a;for(e=1<=arguments.length?n.call(arguments,0):[],a=[],r=0,i=e.length;i>r;r++)t=e[r],a.push(o._removeItem(t));return a})),this.base.forEach(this._addItem.bind(this)),this.startObserving()}return e(r,t),r.accessor("toArray",function(){return this.toArray()}),Batman.extend(r.prototype,Batman.Enumerable),r.prototype.propertyClass=Batman.Property,r.accessor(function(t){return this._resultSetForKey(t)}),r.prototype.startObserving=function(){var t;return null!=(t=this._setObserver)?t.startObserving():void 0},r.prototype.stopObserving=function(){var t;return null!=(t=this._setObserver)?t.stopObserving():void 0},r.prototype.observerForItemAndKey=function(t){var e=this;return function(n,r){return e._removeItemFromKey(t,r),e._addItemToKey(t,n)}},r.prototype.forEach=function(t,e){var n=this;return this._storage.forEach(function(r,o){return o.get("length")>0?t.call(e,r,o,n):void 0})},r.prototype.toArray=function(){var t;return t=[],this._storage.forEach(function(e,n){return n.get("length")>0?t.push(e):void 0}),t},r.prototype._addItem=function(t){return this._addItemToKey(t,this._keyForItem(t))},r.prototype._addItemToKey=function(t,e){return this._resultSetForKey(e).add(t)},r.prototype._removeItem=function(t){return this._removeItemFromKey(t,this._keyForItem(t))},r.prototype._removeItemFromKey=function(t,e){return this._resultSetForKey(e).remove(t)},r.prototype._resultSetForKey=function(t){return this._storage.getOrSet(t,function(){return new Batman.Set})},r.prototype._keyForItem=function(t){return Batman.Keypath.forBaseAndKey(t,this.key).getValue()},r}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicAssociationSetIndex=function(t){function n(t,e,r){this.association=t,this.type=e,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),r)}return e(n,t),n.prototype._resultSetForKey=function(t){return this.association.setForKey(t)},n.prototype._addItem=function(t){return this.association.modelType()===t.get(this.association.foreignTypeKey)?n.__super__._addItem.apply(this,arguments):void 0},n.prototype._removeItem=function(t){return this.association.modelType()===t.get(this.association.foreignTypeKey)?n.__super__._removeItem.apply(this,arguments):void 0},n}(Batman.SetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.AssociationSetIndex=function(t){function n(t,e){this.association=t,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),e)}return e(n,t),n.prototype._resultSetForKey=function(t){return this.association.setForKey(t)},n.prototype.forEach=function(t,e){var n=this;return this.association.proxies.forEach(function(r,o){var i;return i=n.association.indexValueForRecord(r),o.get("length")>0?t.call(e,i,o,n):void 0})},n.prototype.toArray=function(){var t;return t=[],this.forEach(function(e){return t.push(e)}),t},n}(Batman.SetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.UniqueSetIndex=function(t){function n(){this._uniqueIndex=new Batman.Hash,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor(function(t){return this._uniqueIndex.get(t)}),n.prototype._addItemToKey=function(t,e){return this._resultSetForKey(e).add(t),this._uniqueIndex.hasKey(e)?void 0:this._uniqueIndex.set(e,t)},n.prototype._removeItemFromKey=function(t,e){var r;return r=this._resultSetForKey(e),n.__super__._removeItemFromKey.apply(this,arguments),r.isEmpty()?this._uniqueIndex.unset(e):this._uniqueIndex.set(e,r.toArray()[0])},n}(Batman.SetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.UniqueAssociationSetIndex=function(t){function n(t,e){this.association=t,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),e)}return e(n,t),n}(Batman.UniqueSetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicUniqueAssociationSetIndex=function(t){function n(t,e,r){this.association=t,this.type=e,n.__super__.constructor.call(this,this.association.getRelatedModelForType(e).get("loaded"),r)}return e(n,t),n}(Batman.UniqueSetIndex)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].slice;Batman.Navigator=function(){function n(e){this.app=e,this.handleCurrentLocation=t(this.handleCurrentLocation,this)}return n.forApp=function(t){return new(this.defaultClass())(t)},n.defaultClass=function(){return Batman.config.usePushState&&Batman.PushStateNavigator.isSupported()?Batman.PushStateNavigator:Batman.HashbangNavigator},n.prototype.start=function(){var t=this;if("undefined"!=typeof window&&!this.started)return this.started=!0,this.startWatching(),Batman.currentApp.prevent("ready"),Batman.setImmediate(function(){return t.started&&Batman.currentApp?(t.checkInitialHash(),t.handleCurrentLocation(),Batman.currentApp.allowAndFire("ready")):void 0})},n.prototype.stop=function(){return this.stopWatching(),this.started=!1},n.prototype.checkInitialHash=function(t){var e,n,r;return null==t&&(t=window.location),r=Batman.HashbangNavigator.prototype.hashPrefix,e=t.hash,e.length>r.length&&e.substr(0,r.length)!==r?this.initialHash=e.substr(r.length-1):-1!==(n=e.indexOf("##BATMAN##"))?(this.initialHash=e.substr(n+10),this.replaceState(null,"",e.substr(r.length,n-r.length),t)):void 0},n.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},n.prototype.handleLocation=function(t){var e;return e=this.pathFromLocation(t),e!==this.cachedPath?this.dispatch(e):void 0},n.prototype.dispatch=function(t){var e,n;return e=this.app.get("dispatcher"),this.cachedPath=this.initialHash?(n={initialHash:this.initialHash},delete this.initialHash,e.dispatch(t,n)):e.dispatch(t),this.cachedPath},n.prototype.redirect=function(t,e){var n,r,o;return null==e&&(e=!1),r="function"==typeof(o=this.app.get("dispatcher")).pathFromParams?o.pathFromParams(t):void 0,r&&(this._lastRedirect=r),n=this.dispatch(t),this._lastRedirect&&(this.cachedPath=this._lastRedirect),this._lastRedirect&&this._lastRedirect!==n||this[e?"replaceState":"pushState"](null,"",n),n},n.prototype.push=function(t){return Batman.developer.deprecated("Navigator::push","Please use Batman.redirect({}) instead."),this.redirect(t)},n.prototype.replace=function(t){return Batman.developer.deprecated("Navigator::replace","Please use Batman.redirect({}, true) instead."),this.redirect(t,!0)},n.prototype.normalizePath=function(){var t,n,r;return r=1<=arguments.length?e.call(arguments,0):[],r=function(){var e,o,i;for(i=[],t=e=0,o=r.length;o>e;t=++e)n=r[t],i.push((""+n).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return i}(),r.join("")||"/"},n.normalizePath=n.prototype.normalizePath,n}()}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PushStateNavigator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.isSupported=function(){var t;return null!=("undefined"!=typeof window&&null!==window?null!=(t=window.history)?t.pushState:void 0:void 0)},r.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"popstate",this.handleCurrentLocation)},r.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"popstate",this.handleCurrentLocation)},r.prototype.pushState=function(t,e,n){return n!==this.pathFromLocation(window.location)?window.history.pushState(t,e,this.linkTo(n)):void 0},r.prototype.replaceState=function(t,e,n){return n!==this.pathFromLocation(window.location)?window.history.replaceState(t,e,this.linkTo(n)):void 0},r.prototype.linkTo=function(t){return this.normalizePath(Batman.config.pathToApp,t)},r.prototype.pathFromLocation=function(t){var e,n;return e=""+(t.pathname||"")+(t.search||""),n=new RegExp("^"+this.normalizePath(Batman.config.pathToApp)),this.normalizePath(e.replace(n,""))},r.prototype.handleLocation=function(t){var e,n;return n=this.pathFromLocation(t),e=Batman.HashbangNavigator.prototype.pathFromLocation(t),"/"===n&&"/"!==e?this.redirect(e,!0):r.__super__.handleLocation.apply(this,arguments)},r}(Batman.Navigator)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Batman.HashbangNavigator=function(n){function o(){return this.detectHashChange=e(this.detectHashChange,this),this.handleHashChange=e(this.handleHashChange,this),t=o.__super__.constructor.apply(this,arguments)}return r(o,n),o.prototype.hashPrefix="#!","undefined"!=typeof window&&null!==window&&"onhashchange"in window?(o.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"hashchange",this.handleHashChange)},o.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"hashchange",this.handleHashChange)}):(o.prototype.startWatching=function(){return this.interval=setInterval(this.detectHashChange,100)},o.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}),o.prototype.handleHashChange=function(){return this.ignoreHashChange?this.ignoreHashChange=!1:this.handleCurrentLocation()},o.prototype.detectHashChange=function(){return this.previousHash!==window.location.hash?(this.previousHash=window.location.hash,this.handleHashChange()):void 0},o.prototype.pushState=function(t,e,n){var r;return r=this.linkTo(n),r!==window.location.hash?(this.ignoreHashChange=!0,window.location.hash=r):void 0},o.prototype.replaceState=function(t,e,n,r){var o;return null==r&&(r=window.location),o=this.linkTo(n),o!==r.hash?(this.ignoreHashChange=!0,r.replace(""+(r.pathname||"")+(r.search||"")+(o||""))):void 0},o.prototype.linkTo=function(t){return this.hashPrefix+t},o.prototype.pathFromLocation=function(t){var e,n;return e=t.hash,n=this.hashPrefix.length,(null!=e?e.substr(0,n):void 0)===this.hashPrefix?this.normalizePath(e.substr(n)):"/"},o.prototype.handleLocation=function(t){var e;return Batman.config.usePushState?(e=Batman.PushStateNavigator.prototype.pathFromLocation(t),"/"!==e?t.replace(this.normalizePath(""+Batman.config.pathToApp+this.linkTo(e)+(this.initialHash?"##BATMAN##"+this.initialHash:""))):o.__super__.handleLocation.apply(this,arguments)):o.__super__.handleLocation.apply(this,arguments)},o}(Batman.Navigator)}.call(this),function(){Batman.RouteMap=function(){function t(){this.childrenByOrder=[],this.childrenByName={}}return t.prototype.memberRoute=null,t.prototype.collectionRoute=null,t.prototype.routeForParams=function(t){var e,n,r,o,i;if(this._cachedRoutes||(this._cachedRoutes={}),e=this.cacheKey(t),this._cachedRoutes[e])return this._cachedRoutes[e];for(i=this.childrenByOrder,r=0,o=i.length;o>r;r++)if(n=i[r],n.test(t))return this._cachedRoutes[e]=n},t.prototype.addRoute=function(t,e){var n,r,o=this;return this.childrenByOrder.push(e),t.length>0&&(r=t.split(".")).length>0?(n=r.shift(),this.childrenByName[n]||(this.childrenByName[n]=new Batman.RouteMap),this.childrenByName[n].addRoute(r.join("."),e)):e.get("member")?(Batman.developer["do"](function(){return o.memberRoute?Batman.developer.error("Member route with name "+t+" already exists!"):void 0}),this.memberRoute=e):(Batman.developer["do"](function(){return o.collectionRoute?Batman.developer.error("Collection route with name "+t+" already exists!"):void 0}),this.collectionRoute=e),!0},t.prototype.cacheKey=function(t){return"string"==typeof t?t:null!=t.path?t.path:""+t.controller+"#"+t.action},t}()}.call(this),function(){var t=[].slice;Batman.RouteMapBuilder=function(){function e(t,e,n,r){this.app=t,this.routeMap=e,this.parent=n,this.baseOptions=null!=r?r:{},this.parent?(this.rootPath=this.parent._nestingPath(),this.rootName=this.parent._nestingName()):(this.rootPath="",this.rootName="")}return e.BUILDER_FUNCTIONS=["resources","member","collection","route","root"],e.ROUTES={index:{cardinality:"collection",path:function(t){return t},name:function(t){return t}},"new":{cardinality:"collection",path:function(t){return""+t+"/new"},name:function(t){return""+t+".new"}},show:{cardinality:"member",path:function(t){return""+t+"/:id"},name:function(t){return t}},edit:{cardinality:"member",path:function(t){return""+t+"/:id/edit"},name:function(t){return""+t+".edit"}},collection:{cardinality:"collection",path:function(t,e){return""+t+"/"+e},name:function(t,e){return""+t+"."+e}},member:{cardinality:"member",path:function(t,e){return""+t+"/:id/"+e},name:function(t,e){return""+t+"."+e}}},e.prototype.resources=function(){var e,n,r,o,i,a,s,u,c,l,p,h,d,f,m,y,g,v,_,B,b,O,w,x,A,S;if(o=1<=arguments.length?t.call(arguments,0):[],f=function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)r=o[t],"string"==typeof r&&n.push(r);return n}(),"function"==typeof o[o.length-1]&&(a=o.pop()),p="object"==typeof o[o.length-1]?o.pop():{},n={index:!0,"new":!0,show:!0,edit:!0},p.except){for(A=p.except,_=0,O=A.length;O>_;_++)l=A[_],n[l]=!1;delete p.except}else if(p.only){for(l in n)v=n[l],n[l]=!1;for(S=p.only,B=0,w=S.length;w>B;B++)l=S[B],n[l]=!0;delete p.only}for(b=0,x=f.length;x>b;b++){d=f[b],m=Batman.helpers.pluralize(d),u=Batman.helpers.camelize(m,!0),s=this._childBuilder({controller:u}),null!=a&&a.call(s);for(e in n)c=n[e],c&&(g=this.constructor.ROUTES[e],i=g.name(m),h=g.path(m),y=Batman.extend({controller:u,action:e,path:h,as:i},p),s[g.cardinality](e,y))}return!0},e.prototype.member=function(){return this._addRoutesWithCardinality.apply(this,["member"].concat(t.call(arguments)))},e.prototype.collection=function(){return this._addRoutesWithCardinality.apply(this,["collection"].concat(t.call(arguments)))},e.prototype.root=function(t,e){return this.route("/",t,e)},e.prototype.route=function(t,e,n,r){return r||("function"==typeof n?(r=n,n=void 0):"function"==typeof e&&(r=e,e=void 0)),n?e&&(n.signature=e):(n="string"==typeof e?{signature:e}:e,n||(n={})),r&&(n.callback=r),n.as||(n.as=this._nameFromPath(t)),n.path=t,this._addRoute(n)},e.prototype._addRoutesWithCardinality=function(){var e,n,r,o,i,a,s,u,c,l;for(e=arguments[0],r=3<=arguments.length?t.call(arguments,1,u=arguments.length-1):(u=1,[]),o=arguments[u++],"string"==typeof o&&(r.push(o),o={}),o=Batman.extend({},this.baseOptions,o),o[e]=!0,s=this.constructor.ROUTES[e],i=Batman.helpers.underscore(o.controller),c=0,l=r.length;l>c;c++)n=r[c],a=Batman.extend({action:n},o),null==a.path&&(a.path=s.path(i,n)),null==a.as&&(a.as=s.name(i,n)),this._addRoute(a);return!0},e.prototype._addRoute=function(t){var e,n,r,o;return null==t&&(t={}),r=this.rootPath+t.path,n=this.rootName+Batman.helpers.camelize(t.as,!0),delete t.as,delete t.path,e=t.callback?Batman.CallbackActionRoute:Batman.ControllerActionRoute,t.app=this.app,o=new e(r,t),this.routeMap.addRoute(n,o)},e.prototype._nameFromPath=function(t){return t=t.replace(Batman.Route.regexps.namedOrSplat,"").replace(/\/+/g,".").replace(/(^\.)|(\.$)/g,"")},e.prototype._nestingPath=function(){var t,e;return this.parent?(t=":"+Batman.helpers.singularize(this.baseOptions.controller)+"Id",e=Batman.helpers.underscore(this.baseOptions.controller),""+this.parent._nestingPath()+e+"/"+t+"/"):""},e.prototype._nestingName=function(){return this.parent?this.parent._nestingName()+this.baseOptions.controller+".":""},e.prototype._childBuilder=function(t){return null==t&&(t={}),new Batman.RouteMapBuilder(this.app,this.routeMap,this,t)},e}()}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.App=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}var i,a,s,u,c;for(n(o,e),o.classAccessor("currentParams",{get:function(){return new Batman.Hash},"final":!0}),o.classAccessor("paramsManager",{get:function(){var t,e;if(t=this.get("navigator"))return e=this.get("currentParams"),e.replacer=new Batman.ParamsReplacer(t,e)},"final":!0}),o.classAccessor("paramsPusher",{get:function(){var t,e;if(t=this.get("navigator"))return e=this.get("currentParams"),e.pusher=new Batman.ParamsPusher(t,e)},"final":!0}),o.classAccessor("routes",function(){return new Batman.NamedRouteQuery(this.get("routeMap"))}),o.classAccessor("routeMap",function(){return new Batman.RouteMap}),o.classAccessor("routeMapBuilder",function(){return new Batman.RouteMapBuilder(this,this.get("routeMap"))}),o.classAccessor("dispatcher",function(){return new Batman.Dispatcher(this,this.get("routeMap"))}),o.classAccessor("controllers",function(){return this.get("dispatcher.controllers")}),o.classAccessor("_renderContext",function(){return Batman.RenderContext.base.descend(this)}),o.requirePath="",Batman.developer["do"](function(){var t;return t="Please use whatever means you'd like to load your code before calling App.run.",o.require=function(){var e,n,o,i,a,s,u=this;for(i=arguments[0],o=2<=arguments.length?r.call(arguments,1):[],Batman.developer.deprecated("App.require",t),e=this.requirePath+i,a=0,s=o.length;s>a;a++)n=o[a],this.prevent("run"),i=e+"/"+n+".coffee",new Batman.Request({url:i,type:"html",success:function(t){return CoffeeScript.eval(t),u.allow("run"),u.isPrevented("run")||u.fire("loaded"),u.wantsToRun?u.run():void 0}});return this},o.controller=function(){var e;return e=1<=arguments.length?r.call(arguments,0):[],Batman.developer.deprecated("App.controller",t),e=e.map(function(t){return t+"_controller"}),this.require.apply(this,["controllers"].concat(r.call(e)))},o.model=function(){return Batman.developer.deprecated("App.model",t),this.require.apply(this,["models"].concat(r.call(arguments)))},o.view=function(){return Batman.developer.deprecated("App.view",t),this.require.apply(this,["views"].concat(r.call(arguments)))}}),o.layout=void 0,o.shouldAllowEvent={},c=Batman.RouteMapBuilder.BUILDER_FUNCTIONS,a=function(t){return o[t]=function(){var e;return(e=this.get("routeMapBuilder"))[t].apply(e,arguments)}},s=0,u=c.length;u>s;s++)i=c[s],a(i);return o.event("ready").oneShot=!0,o.event("run").oneShot=!0,o.run=function(){var t,e,n=this;if(Batman.currentApp){if(Batman.currentApp===this)return;Batman.currentApp.stop()}return this.hasRun?!1:this.isPrevented("run")?(this.wantsToRun=!0,!1):(delete this.wantsToRun,Batman.currentApp=this,Batman.App.set("current",this),null==this.get("dispatcher")&&(this.set("dispatcher",new Batman.Dispatcher(this,this.get("routeMap"))),this.set("controllers",this.get("dispatcher.controllers"))),null==this.get("navigator")&&(this.set("navigator",Batman.Navigator.forApp(this)),this.on("run",function(){return Batman.navigator=n.get("navigator"),Object.keys(n.get("dispatcher").routeMap).length>0?Batman.navigator.start():void 0})),this.observe("layout",function(t){return null!=t?t.on("ready",function(){return n.fire("ready")}):void 0}),t=this.get("layout"),t?"string"==typeof t&&(e=this[Batman.helpers.camelize(t)+"View"]):null!==t&&(e=Batman.View),e&&(t=this.set("layout",new e({context:this,node:document}))),this.hasRun=!0,this.fire("run"),this)},o.event("ready").oneShot=!0,o.event("stop").oneShot=!0,o.stop=function(){var t;return null!=(t=this.navigator)&&t.stop(),Batman.navigator=null,this.hasRun=!1,this.fire("stop"),this},o}.call(this,Batman.Object)}.call(this),function(){Batman.Association=function(){function t(t,e,n){var r,o,i,a,s;this.model=t,this.label=e,null==n&&(n={}),r={namespace:Batman.currentApp,name:Batman.helpers.camelize(Batman.helpers.singularize(this.label))},this.options=Batman.extend(r,this.defaultOptions,n),this.options.nestUrl&&(null==this.model.urlNestsUnder&&Batman.developer.error("You must persist the the model "+this.model.constructor.name+" to use the url helpers on an association"),this.model.urlNestsUnder(Batman.helpers.underscore(this.getRelatedModel().get("resourceName")))),null!=this.options.extend&&Batman.extend(this,this.options.extend),o={encode:this.options.saveInline?this.encoder():!1,decode:this.decoder()},i=n.encoderKey||this.label,this.model.encode(i,o),s=this,a=function(){return s.getAccessor.call(this,s,this.model,this.label)},this.model.accessor(this.label,{get:a,set:t.defaultAccessor.set,unset:t.defaultAccessor.unset})}return t.prototype.associationType="",t.prototype.isPolymorphic=!1,t.prototype.defaultOptions={saveInline:!0,autoload:!0,nestUrl:!1},t.prototype.getRelatedModel=function(){var t,e,n;return n=this.options.namespace||Batman.currentApp,t=this.options.name,e=null!=n?n[t]:void 0,Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" hasn't loaded yet.")}),e},t.prototype.getFromAttributes=function(t){return t.get("attributes."+this.label)},t.prototype.setIntoAttributes=function(t,e){return t.get("attributes").set(this.label,e)},t.prototype.inverse=function(){var t,e,n=this;return(e=this.getRelatedModel()._batman.get("associations"))?this.options.inverseOf?e.getByLabel(this.options.inverseOf):(t=null,e.forEach(function(e,r){return r.getRelatedModel()===n.model?t=r:void 0}),t):void 0},t.prototype.reset=function(){return delete this.index,!0},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PluralAssociation=function(t){function n(){n.__super__.constructor.apply(this,arguments),this._resetSetHashes()}return e(n,t),n.prototype.proxyClass=Batman.AssociationSet,n.prototype.isSingular=!1,n.prototype.setForRecord=function(t){var e,n,r=this;return n=this.indexValueForRecord(t),e=this.setIndex(),Batman.Property.withoutTracking(function(){return r._setsByRecord.getOrSet(t,function(){var t,e;return null!=n&&(t=r._setsByValue.get(n),null!=t)?t:(e=r.proxyClassInstanceForKey(n),null!=n&&r._setsByValue.set(n,e),e)})}),null!=n?e.get(n):this._setsByRecord.get(t)},n.prototype.setForKey=Batman.Property.wrapTrackingPrevention(function(t){var e,n=this;return e=void 0,this._setsByRecord.forEach(function(r,o){return null==e?n.indexValueForRecord(r)===t?e=o:void 0:void 0}),null!=e?(e.foreignKeyValue=t,e):this._setsByValue.getOrSet(t,function(){return n.proxyClassInstanceForKey(t)})}),n.prototype.proxyClassInstanceForKey=function(t){return new this.proxyClass(t,this)},n.prototype.getAccessor=function(t){var e,n,r=this;if(t.getRelatedModel())return(n=t.getFromAttributes(this))?n:(e=t.setForRecord(this),t.setIntoAttributes(this,e),Batman.Property.withoutTracking(function(){return!t.options.autoload||r.isNew()||e.loaded?void 0:e.load(function(t){if(t)throw t})}),e)},n.prototype.parentSetIndex=function(){return this.parentIndex||(this.parentIndex=this.model.get("loaded").indexedByUnique(this.primaryKey)),this.parentIndex},n.prototype.setIndex=function(){return this.index||(this.index=new Batman.AssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},n.prototype.indexValueForRecord=function(t){return t.get(this.primaryKey)},n.prototype.reset=function(){return n.__super__.reset.apply(this,arguments),this._resetSetHashes()},n.prototype._resetSetHashes=function(){return this._setsByRecord=new Batman.SimpleHash,this._setsByValue=new Batman.SimpleHash},n}(Batman.Association)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HasManyAssociation=function(t){function n(t,e,r){return(null!=r?r.as:void 0)?function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(Batman.PolymorphicHasManyAssociation,arguments,function(){}):(n.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(t.get("resourceName"))+"_id",void 0)}return e(n,t),n.prototype.associationType="hasMany",n.prototype.indexRelatedModelOn="foreignKey",n.prototype.apply=function(t,e){var n,r,o=this;return t||((n=this.getFromAttributes(e))&&n.forEach(function(t){return t.set(o.foreignKey,e.get(o.primaryKey))}),e.set(this.label,r=this.setForRecord(e)),"creating"!==e.lifecycle.get("state"))?void 0:r.markAsLoaded()},n.prototype.encoder=function(){var t;return t=this,function(e,n,r,o){var i;return null!=e&&(i=[],e.forEach(function(e){var n;return n=e.toJSON(),(!t.inverse()||t.inverse().options.encodeForeignKey)&&(n[t.foreignKey]=o.get(t.primaryKey)),i.push(n)})),i}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u,c,l,p,h,d,f,m;if(!(h=t.getRelatedModel()))return Batman.developer.error("Can't decode model "+t.options.name+" because it hasn't been loaded yet!"),void 0;for(s=t.setForRecord(i),l=s.filter(function(t){return t.isNew()}).toArray(),f=0,m=e.length;m>f;f++)c=e[f],u=c[h.primaryKey],a=h.get("loaded.indexedByUnique.id").get(u),null!=a?(a._withoutDirtyTracking(function(){return this.fromJSON(c)}),p=a):l.length>0?(d=l.shift(),d._withoutDirtyTracking(function(){return this.fromJSON(c)}),p=h._mapIdentity(d)):p=h._makeOrFindRecordFromData(c),s.add(p),t.options.inverseOf&&p.set(t.options.inverseOf,i);return s.markAsLoaded(),s}},n}(Batman.PluralAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicHasManyAssociation=function(t){function n(t,e,r){r.inverseOf=this.foreignLabel=r.as,delete r.as,r.foreignKey||(r.foreignKey=""+this.foreignLabel+"_id"),n.__super__.constructor.call(this,t,e,r),this.foreignTypeKey=r.foreignTypeKey||""+this.foreignLabel+"_type",this.model.encode(this.foreignTypeKey)}return e(n,t),n.prototype.proxyClass=Batman.PolymorphicAssociationSet,n.prototype.isPolymorphic=!0,n.prototype.apply=function(t,e){var r,o=this;return t||(r=this.getFromAttributes(e))&&(n.__super__.apply.apply(this,arguments),r.forEach(function(t){return t.set(o.foreignTypeKey,o.modelType())})),!0},n.prototype.proxyClassInstanceForKey=function(t){return new this.proxyClass(t,this.modelType(),this)},n.prototype.getRelatedModelForType=function(t){var e,n;return n=this.options.namespace||Batman.currentApp,t?(e=null!=n?n[t]:void 0,e||(e=null!=n?n[Batman.helpers.camelize(t)]:void 0)):e=this.getRelatedModel(),Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" for polymorphic association not found.")}),e},n.prototype.modelType=function(){return this.model.get("resourceName")},n.prototype.setIndex=function(){return this.typeIndex||(this.typeIndex=new Batman.PolymorphicAssociationSetIndex(this,this.modelType(),this[this.indexRelatedModelOn])),this.typeIndex},n.prototype.encoder=function(){var t;return t=this,function(e,n,r,o){var i;return null!=e&&(i=[],e.forEach(function(e){var n;return n=e.toJSON(),n[t.foreignKey]=o.get(t.primaryKey),n[t.foreignTypeKey]=t.modelType(),i.push(n)})),i}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u,c,l,p,h,d,f,m,y;for(s=t.getFromAttributes(i)||t.setForRecord(i),l=s.filter(function(t){return t.isNew()}).toArray(),m=0,y=e.length;y>m;m++){if(c=e[m],f=c[t.options.foreignTypeKey],!(h=t.getRelatedModelForType(f)))return Batman.developer.error("Can't decode model "+t.options.name+" because it hasn't been loaded yet!"),void 0;u=c[h.primaryKey],a=h.get("loaded.indexedByUnique.id").get(u),null!=a?(a._withoutDirtyTracking(function(){return this.fromJSON(c)}),p=a):l.length>0?(d=l.shift(),d._withoutDirtyTracking(function(){return this.fromJSON(c)}),p=h._mapIdentity(d)):p=h._makeOrFindRecordFromData(c),s.add(p),t.options.inverseOf&&p.set(t.options.inverseOf,i)}return s.markAsLoaded(),s}},n}(Batman.HasManyAssociation)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.SingularAssociation=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.isSingular=!0,r.prototype.getAccessor=function(t){var e,n,r,o,i;return(o=t.getFromAttributes(this))?o:t.getRelatedModel()?(n=this.associationProxy(t),r=!1,e=this,null==(i=n._loadSetter)&&(n._loadSetter=n.once("loaded",function(n){return e._withoutDirtyTracking(function(){return this.set(t.label,n)})})),Batman.Property.withoutTracking(function(){return n.get("loaded")})||(t.options.autoload?Batman.Property.withoutTracking(function(){return n.load()}):r=n.loadFromLocal()),r||n):void 0},r.prototype.setIndex=function(){return this.index||(this.index=new Batman.UniqueAssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},r}(Batman.Association)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HasOneAssociation=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(this.model.get("resourceName"))+"_id"}return e(n,t),n.prototype.associationType="hasOne",n.prototype.proxyClass=Batman.HasOneProxy,n.prototype.indexRelatedModelOn="foreignKey",n.prototype.apply=function(t,e){var n;return(n=this.getFromAttributes(e))?n.set(this.foreignKey,e.get(this.primaryKey)):void 0},n.prototype.encoder=function(){var t;return t=this,function(e,n,r,o){var i;if(t.options.saveInline)return(i=e.toJSON())&&(i[t.foreignKey]=o.get(t.primaryKey)),i}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s;if(e)return s=t.getRelatedModel(),a=s.createFromJSON(e),t.options.inverseOf&&a.set(t.options.inverseOf,i),a}},n}(Batman.SingularAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.BelongsToAssociation=function(t){function n(t,e,r){return(null!=r?r.polymorphic:void 0)?(delete r.polymorphic,function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(Batman.PolymorphicBelongsToAssociation,arguments,function(){})):(n.__super__.constructor.apply(this,arguments),this.foreignKey=this.options.foreignKey||""+this.label+"_id",this.primaryKey=this.options.primaryKey||"id",this.options.encodeForeignKey&&this.model.encode(this.foreignKey),void 0)
}return e(n,t),n.prototype.associationType="belongsTo",n.prototype.proxyClass=Batman.BelongsToProxy,n.prototype.indexRelatedModelOn="primaryKey",n.prototype.defaultOptions={saveInline:!1,autoload:!0,encodeForeignKey:!0},n.prototype.encoder=function(){return function(t){return t.toJSON()}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u;return u=t.getRelatedModel(),s=u.createFromJSON(e),t.options.inverseOf&&(a=t.inverse())&&(a instanceof Batman.HasManyAssociation?i.set(t.foreignKey,s.get(t.primaryKey)):s.set(a.label,i)),i.set(t.label,s),s}},n.prototype.apply=function(t){var e,n;return(n=t.get(this.label))&&(e=n.get(this.primaryKey),void 0!==e)?t.set(this.foreignKey,e):void 0},n}(Batman.SingularAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicBelongsToAssociation=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.foreignTypeKey=this.options.foreignTypeKey||""+this.label+"_type",this.options.encodeForeignTypeKey&&this.model.encode(this.foreignTypeKey),this.typeIndicies={}}return e(n,t),n.prototype.isPolymorphic=!0,n.prototype.proxyClass=Batman.PolymorphicBelongsToProxy,n.prototype.defaultOptions=Batman.mixin({},Batman.BelongsToAssociation.prototype.defaultOptions,{encodeForeignTypeKey:!0}),n.prototype.getRelatedModel=!1,n.prototype.setIndex=!1,n.prototype.inverse=!1,n.prototype.apply=function(t){var e,r;return n.__super__.apply.apply(this,arguments),(r=t.get(this.label))?(e=r instanceof Batman.PolymorphicBelongsToProxy?r.get("foreignTypeValue"):r.constructor.get("resourceName"),t.set(this.foreignTypeKey,e)):void 0},n.prototype.getAccessor=function(t){var e,n;return(n=t.getFromAttributes(this))?n:t.getRelatedModelForType(this.get(t.foreignTypeKey))?(e=this.associationProxy(t),Batman.Property.withoutTracking(function(){return!e.get("loaded")&&t.options.autoload?e.load():void 0}),e):void 0},n.prototype.url=function(t){var e,n,r,o,i,a,s,u;return a=null!=(s=t.data)?s[this.foreignTypeKey]:void 0,a&&(o=this.inverseForType(a))?(i=Batman.helpers.pluralize(a).toLowerCase(),r=null!=(u=t.data)?u[this.foreignKey]:void 0,n=o.isSingular?"singularize":"pluralize",e=Batman.helpers[n](o.label),"/"+i+"/"+r+"/"+e):void 0},n.prototype.getRelatedModelForType=function(t){var e,n;return n=this.options.namespace||Batman.currentApp,t&&(e=null!=n?n[t]:void 0,e||(e=null!=n?n[Batman.helpers.camelize(t)]:void 0)),Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" for polymorphic association not found.")}),e},n.prototype.setIndexForType=function(t){var e;return(e=this.typeIndicies)[t]||(e[t]=new Batman.PolymorphicUniqueAssociationSetIndex(this,t,this.primaryKey)),this.typeIndicies[t]},n.prototype.inverseForType=function(t){var e,n,r,o=this;return(n=null!=(r=this.getRelatedModelForType(t))?r._batman.get("associations"):void 0)?this.options.inverseOf?n.getByLabel(this.options.inverseOf):(e=null,n.forEach(function(t,n){return n.getRelatedModel()===o.model?e=n:void 0}),e):void 0},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u,c;return a=r[t.foreignTypeKey]||i.get(t.foreignTypeKey),c=t.getRelatedModelForType(a),u=c.createFromJSON(e),t.options.inverseOf&&(s=t.inverseForType(a))&&(s instanceof Batman.PolymorphicHasManyAssociation?(i.set(t.foreignKey,u.get(t.primaryKey)),i.set(t.foreignTypeKey,a)):u.set(s.label,i)),i.set(t.label,u),u}},n}(Batman.BelongsToAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.Validator=function(t){function r(){var t,e;e=arguments[0],t=2<=arguments.length?n.call(arguments,1):[],this.options=e,r.__super__.constructor.apply(this,t)}return e(r,t),r.triggers=function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],null!=this._triggers?this._triggers.concat(t):this._triggers=t},r.options=function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],null!=this._options?this._options.concat(t):this._options=t},r.matches=function(t){var e,n,r,o,i,a;n={},r=!1;for(e in t)o=t[e],~(null!=(i=this._options)?i.indexOf(e):void 0)&&(n[e]=o),~(null!=(a=this._triggers)?a.indexOf(e):void 0)&&(n[e]=o,r=!0);return r?n:void 0},r.prototype.validate=function(){return Batman.developer.error("You must override validate in Batman.Validator subclasses.")},r.prototype.format=function(t,e,n){return Batman.t("errors.messages."+e,n)},r.prototype.handleBlank=function(t){return this.options.allowBlank&&!Batman.PresenceValidator.prototype.isPresent(t)?!0:void 0},r}(Batman.Object)}.call(this),function(){Batman.Validators=[],Batman.extend(Batman.translate.messages,{errors:{format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank",not_numeric:"must be a number",greater_than:"must be greater than %{count}",greater_than_or_equal_to:"must be greater than or equal to %{count}",equal_to:"must be equal to %{count}",less_than:"must be less than %{count}",less_than_or_equal_to:"must be less than or equal to %{count}",not_matching:"is not valid",invalid_association:"is not valid",not_included_in_list:"is not included in the list",included_in_list:"is included in the list"}}})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.RegExpValidator=function(t){function n(t){var e;this.regexp=null!=(e=t.regexp)?e:t.pattern,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("regexp","pattern"),n.options("allowBlank"),n.prototype.validateEach=function(t,e,n,r){var o;return o=e.get(n),this.handleBlank(o)?r():(null!=o&&""!==o&&this.regexp.test(o)||t.add(n,this.format(n,"not_matching")),r())},n}(Batman.Validator),Batman.Validators.push(Batman.RegExpValidator)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PresenceValidator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.triggers("presence"),r.prototype.validateEach=function(t,e,n,r){var o;return o=e.get(n),this.isPresent(o)||t.add(n,this.format(n,"blank")),r()},r.prototype.isPresent=function(t){return null!=t&&""!==t},r}(Batman.Validator),Batman.Validators.push(Batman.PresenceValidator)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.NumericValidator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.triggers("numeric","greaterThan","greaterThanOrEqualTo","equalTo","lessThan","lessThanOrEqualTo"),r.options("allowBlank"),r.prototype.validateEach=function(t,e,n,r){var o,i;return o=this.options,i=e.get(n),this.handleBlank(i)?r():(null==i||!this.isNumeric(i)&&!this.canCoerceToNumeric(i)?t.add(n,this.format(n,"not_numeric")):(o.greaterThan&&i<=o.greaterThan&&t.add(n,this.format(n,"greater_than",{count:o.greaterThan})),o.greaterThanOrEqualTo&&i<o.greaterThanOrEqualTo&&t.add(n,this.format(n,"greater_than_or_equal_to",{count:o.greaterThanOrEqualTo})),o.equalTo&&i!==o.equalTo&&t.add(n,this.format(n,"equal_to",{count:o.equalTo})),o.lessThan&&i>=o.lessThan&&t.add(n,this.format(n,"less_than",{count:o.lessThan})),o.lessThanOrEqualTo&&i>o.lessThanOrEqualTo&&t.add(n,this.format(n,"less_than_or_equal_to",{count:o.lessThanOrEqualTo}))),r())},r.prototype.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},r.prototype.canCoerceToNumeric=function(t){return t-0==t&&t.length>0},r}(Batman.Validator),Batman.Validators.push(Batman.NumericValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.LengthValidator=function(t){function n(t){var e;(e=t.lengthIn||t.lengthWithin)&&(t.minLength=e[0],t.maxLength=e[1]||-1,delete t.lengthWithin,delete t.lengthIn),n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("minLength","maxLength","length","lengthWithin","lengthIn"),n.options("allowBlank"),n.prototype.validateEach=function(t,e,n,r){var o,i;return o=this.options,i=e.get(n),""!==i&&this.handleBlank(i)?r():(null==i&&(i=[]),o.minLength&&i.length<o.minLength&&t.add(n,this.format(n,"too_short",{count:o.minLength})),o.maxLength&&i.length>o.maxLength&&t.add(n,this.format(n,"too_long",{count:o.maxLength})),o.length&&i.length!==o.length&&t.add(n,this.format(n,"wrong_length",{count:o.length})),r())},n}(Batman.Validator),Batman.Validators.push(Batman.LengthValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.InclusionValidator=function(t){function n(t){this.acceptableValues=t.inclusion["in"],n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("inclusion"),n.prototype.validateEach=function(t,e,n,r){return-1===this.acceptableValues.indexOf(e.get(n))&&t.add(n,this.format(n,"not_included_in_list")),r()},n}(Batman.Validator),Batman.Validators.push(Batman.InclusionValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ExclusionValidator=function(t){function n(t){this.unacceptableValues=t.exclusion["in"],n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("exclusion"),n.prototype.validateEach=function(t,e,n,r){return this.unacceptableValues.indexOf(e.get(n))>=0&&t.add(n,this.format(n,"included_in_list")),r()},n}(Batman.Validator),Batman.Validators.push(Batman.ExclusionValidator)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.AssociatedValidator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.triggers("associated"),r.prototype.validateEach=function(t,e,n,r){var o,i,a,s=this;return a=e.get(n),null!=a?(a instanceof Batman.AssociationProxy&&(a="function"==typeof a.get?a.get("target"):void 0),i=1,o=function(e,o){return o.length>0&&t.add(n,s.format(n,"invalid_association")),0===--i?r():void 0},null!=(null!=a?a.forEach:void 0)?a.forEach(function(t){return i+=1,t.validate(o)}):null!=(null!=a?a.validate:void 0)&&(i+=1,a.validate(o)),o(null,[])):r()},r}(Batman.Validator),Batman.Validators.push(Batman.AssociatedValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ControllerActionFrame=function(t){function n(t,e){n.__super__.constructor.call(this,t),this.once("complete",e)}return e(n,t),n.prototype.operationOccurred=!1,n.prototype.remainingOperations=0,n.prototype.event("complete").oneShot=!0,n.prototype.startOperation=function(t){return null==t&&(t={}),t.internal||(this.operationOccurred=!0),this._changeOperationsCounter(1),!0},n.prototype.finishOperation=function(){return this._changeOperationsCounter(-1),!0},n.prototype.startAndFinishOperation=function(t){return this.startOperation(t),this.finishOperation(t),!0},n.prototype._changeOperationsCounter=function(t){var e;this.remainingOperations+=t,0===this.remainingOperations&&this.fire("complete"),null!=(e=this.parentFrame)&&e._changeOperationsCounter(t)},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.InsertionBinding=function(t){function n(t){var e=this;this.invert=t.invert,this.placeholderNode=document.createComment("detached node "+this.get("_batmanID")),n.__super__.constructor.apply(this,arguments),Batman.DOM.onParseExit(this.node,function(){return e.bind(),null!=e.placeholderNode?Batman.DOM.trackBinding(e,e.placeholderNode):void 0})}return e(n,t),n.prototype.isTwoWay=!1,n.prototype.bindImmediately=!1,n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){var e;if(e=this.placeholderNode.parentNode||this.node.parentNode,!!t==!this.invert){if(null==this.node.parentNode)return Batman.DOM.insertBefore(e,this.node,this.placeholderNode),e.removeChild(this.placeholderNode)}else if(null!=this.node.parentNode)return e.insertBefore(this.placeholderNode,this.node),Batman.DOM.removeNode(this.node)},n.prototype.die=function(){var t,e,r;if(!this.dead)return e=this.node,r=this.placeholderNode,t=this.get("filteredValue"),n.__super__.die.apply(this,arguments),!!t==!this.invert?Batman.DOM.destroyNode(r):Batman.DOM.destroyNode(e)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t;t=function(t){var e;for(e in t)return!1;return!0},Batman.extend(Batman,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:function(){var t,e;try{return t=document.createElement("div"),delete t.test}catch(n){return e=n,Batman.canDeleteExpando=!1}}(),noData:{embed:!0,EMBED:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",OBJECT:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0,APPLET:!0},hasData:function(e){return e=e.nodeType?Batman.cache[e[Batman.expando]]:e[Batman.expando],!!e&&!t(e)},data:function(t,e,n,r){var o,i,a,s,u,c;if(Batman.acceptData(t)&&(s=Batman.expando,i="string"==typeof e,o=Batman.cache,a=t[Batman.expando],!(!a||r&&a&&o[a]&&!o[a][s])||!i||void 0!==n))return a||(3!==t.nodeType?t[Batman.expando]=a=++Batman.uuid:a=Batman.expando),o[a]||(o[a]={}),("object"==typeof e||"function"==typeof e)&&(r?o[a][s]=Batman.extend(o[a][s],e):o[a]=Batman.extend(o[a],e)),c=o[a],r&&(c[s]||(c[s]={}),c=c[s]),void 0!==n&&(c[e]=n),u=i?c[e]:c},removeData:function(e,n,r,o){var i,a,s,u,c,l;if(Batman.acceptData(e)&&(u=Batman.expando,c=e.nodeType,i=Batman.cache,a=e[Batman.expando],i[a]&&!(n&&(l=r?i[a][u]:i[a],l&&(delete l[n],!t(l)))||r&&(delete i[a][u],!t(i[a])))))return s=i[a][u],Batman.canDeleteExpando||!i.setInterval?delete i[a]:i[a]=null,s&&!o?(i[a]={},i[a][u]=s):Batman.canDeleteExpando?delete e[Batman.expando]:e.removeAttribute?e.removeAttribute(Batman.expando):e[Batman.expando]=null},_data:function(t,e,n){return Batman.data(t,e,n,!0)},acceptData:function(t){var e;return t.___acceptData||(t.___acceptData=t.nodeName?(e=Batman.noData[t.nodeName],e?!(e===!0||t.getAttribute("classid")!==e):!0):!0)}})}.call(this),function(){var t,e,n=[].slice;t=function(t){return function(e){return null==e?void 0:t.apply(this,arguments)}},e=function(t,e){return t||e},Batman.Filters={raw:t(function(t,e){return e.escapeValue=!1,t}),get:t(function(t,e){return null!=t.get?t.get(e):t[e]}),equals:t(function(t,e){return t===e}),and:function(t,e){return t&&e},or:function(t,e){return t||e},not:function(t){return!t},trim:t(function(t){return t.trim()}),matches:t(function(t,e){return-1!==t.indexOf(e)}),truncate:t(function(t,e,n,r){return null==n&&(n="..."),r||(r=n,n="..."),t.length>e&&(t=t.substr(0,e-n.length)+n),t}),"default":function(t,e){return null!=t&&""!==t?t:e},prepend:function(t,e){return(null!=e?e:"")+(null!=t?t:"")},append:function(t,e){return(null!=t?t:"")+(null!=e?e:"")},replace:t(function(t,e,n,r,o){return o||(o=r,r=void 0),void 0===r?t.replace(e,n):t.replace(e,n,r)}),downcase:t(function(t){return t.toLowerCase()}),upcase:t(function(t){return t.toUpperCase()}),pluralize:t(function(t,e,n,r){return r||(r=n,n=!0,r||(r=e,e=void 0)),null!=e?Batman.helpers.pluralize(e,t,void 0,n):Batman.helpers.pluralize(t)}),humanize:t(function(t){return Batman.helpers.humanize(t)}),join:t(function(t,e,n){return null==e&&(e=""),n||(n=e,e=""),t.join(e)}),sort:t(function(t){return t.sort()}),map:t(function(t,e){return t.map(function(t){return Batman.get(t,e)})}),has:function(t,e){return null==t?!1:Batman.contains(t,e)},first:t(function(t){return t[0]}),meta:t(function(t,e){return Batman.developer.assert(t.meta,"Error, value doesn't have a meta to filter on!"),t.meta.get(e)}),interpolate:function(t,e,n){var r,o,i;if(n||(n=e,e=void 0),t){i={};for(r in e)o=e[r],i[r]=this.get(o),null==i[r]&&(Batman.developer.warn("Warning! Undefined interpolation key "+r+" for interpolation",t),i[r]="");return Batman.helpers.interpolate(t,i)}},withArguments:function(){var t,e,r,o;return e=arguments[0],r=3<=arguments.length?n.call(arguments,1,o=arguments.length-1):(o=1,[]),t=arguments[o++],e?function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.call.apply(e,[this].concat(n.call(r),n.call(t)))}:void 0},routeToAction:t(function(t,e){var n;return n=Batman.Dispatcher.paramsFromArgument(t),n.action=e,n}),escape:t(Batman.escapeHTML)},function(){var e,n,r,o,i;for(o=["capitalize","singularize","underscore","camelize"],i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push(Batman.Filters[e]=t(Batman.helpers[e]));return i}(),Batman.developer.addFilters()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HTMLStore=function(t){function n(){n.__super__.constructor.apply(this,arguments),this._htmlContents={},this._requestedPaths=new Batman.SimpleSet}return e(n,t),n.prototype.propertyClass=Batman.Property,n.prototype.fetchHTML=function(t){var e=this;return new Batman.Request({url:Batman.Navigator.normalizePath(Batman.config.pathToHTML,""+t+".html"),type:"html",success:function(n){return e.set(t,n)},error:function(){throw new Error("Could not load html from "+t)}})},n.accessor({"final":!0,get:function(t){var e;if("/"!==t.charAt(0))return this.get("/"+t);if(this._htmlContents[t])return this._htmlContents[t];if(!this._requestedPaths.has(t)){if(e=this._sourceFromDOM(t))return e;if(!Batman.config.fetchRemoteHTML)throw new Error("Couldn't find html source for '"+t+"'!");this.fetchHTML(t)}},set:function(t,e){return"/"!==t.charAt(0)?this.set("/"+t,e):(this._requestedPaths.add(t),this._htmlContents[t]=e)}}),n.prototype.prefetch=function(t){return this.get(t),!0},n.prototype._sourceFromDOM=function(t){var e,n;return n=t.slice(1),(e=Batman.DOM.querySelector(document,"[data-defineview*='"+n+"']"))?(Batman.setImmediate(function(){var t;return null!=(t=e.parentNode)?t.removeChild(e):void 0}),Batman.DOM.defineView(t,e)):void 0},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.View=function(t){function r(t){var e,n=this;null==t&&(t={}),e=t.context,e?e instanceof Batman.RenderContext||(e=Batman.RenderContext.root().descend(e)):e=Batman.RenderContext.root(),t.context=e.descend(this),r.__super__.constructor.call(this,t),Batman.Property.withoutTracking(function(){return n.observeAndFire("readyToRender",function(t){return t?n.render():void 0})})}var o;return e(r,t),r.YieldStorage=function(t){function n(){return o=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.wrapAccessor(function(t){return{get:function(e){var n;return n=t.get.call(this,e),null==n&&(n=this.set(e,[])),n}}}),n}(Batman.Hash),r.store=new Batman.HTMLStore,r.option=function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],this.accessor.apply(this,n.call(t).concat([{get:function(t){var e;return null!=(e=this.get("argumentBindings."+t))?e.get("filteredValue"):void 0},set:function(t,e){var n;return null!=(n=this.get("argumentBindings."+t))?n.set("filteredValue",e):void 0},unset:function(t){var e;return null!=(e=this.get("argumentBindings."+t))?e.unset("filteredValue"):void 0}}]))},r.prototype.isView=!0,r.prototype.cache=!0,r.prototype._rendered=!1,r.prototype.node=null,r.prototype.event("ready").oneShot=!0,r.accessor("argumentBindings",function(){var t=this;return new Batman.TerminalAccessible(function(e){var n,r,o,i,a,s;if((a=t.get("node"))&&(r=t.get("context"))&&(i=a.getAttribute(("data-view-"+e).toLowerCase()),null!=i))return n="_argumentBinding"+e,null!=(s=t[n])&&s.die(),o=new Batman.DOM.ReaderBindingDefinition(a,i,r),t[n]=new Batman.DOM.ViewArgumentBinding(o)})}),r.accessor("html",{get:function(){var t;if(this.html&&this.html.length>0)return this.html;if(t=this.get("source"))return t=Batman.Navigator.normalizePath(t),this.html=this.constructor.store.get(t)},set:function(t,e){return this.html=e}}),r.accessor("node",{get:function(){var t;if(null==this.node){if(t=this.get("html"),!(t&&t.length>0))return;this.node=document.createElement("div"),this._setNodeOwner(this.node),Batman.DOM.setInnerHTML(this.node,t)}return this.node},set:function(t,e){var n,r=this;return this.node=e,this._setNodeOwner(e),n=function(t){return null!=t?(Batman.DOM.setInnerHTML(r.node,t),r.forget("html",n)):void 0},this.observeAndFire("html",n),e}}),r.accessor("yields",function(){return new this.constructor.YieldStorage}),r.accessor("fetched?",function(){return null!=this.get("source")}),r.accessor("readyToRender",function(){var t;return this.get("node")&&(this.get("fetched?")?(null!=(t=this.get("html"))?t.length:void 0)>0:!0)}),r.prototype.render=function(){var t,e=this;if(!this._rendered)return this._rendered=!0,this._renderer=new Batman.Renderer(t=this.get("node"),this.get("context"),this),this._renderer.once("rendered",function(){return e.fire("ready",t)})},r.prototype.isInDOM=function(){var t;return(t=this.get("node"))?null!=t.parentNode||this.get("yields").some(function(e,n){var r,o;for(r=0,o=n.length;o>r;r++)if(t=n[r].node,null!=t.parentNode)return!0;return!1}):!1},r.prototype.die=function(){var t;return this.fire("destroy",this.node),this.forget(),null!=(t=this._batman.properties)&&t.forEach(function(t,e){return e.die()}),this.get("yields").forEach(function(t,e){var n,r,o,i;for(i=[],r=0,o=e.length;o>r;r++)n=e[r].node,i.push(Batman.DOM.didDestroyNode(n));return i})},r.prototype.applyYields=function(){return this.get("yields").forEach(function(t,e){var n,r,o,i,a,s,u;for(o=Batman.DOM.Yield.withName(t),u=[],i=0,a=e.length;a>i;i++)s=e[i],r=s.node,n=s.action,u.push(o[n](r));return u})},r.prototype.retractYields=function(){return this.get("yields").forEach(function(t,e){var n,r,o,i,a;for(a=[],r=0,o=e.length;o>r;r++)n=e[r].node,a.push(null!=(i=n.parentNode)?i.removeChild(n):void 0);return a})},r.prototype.pushYieldAction=function(t,e,n){return this._setNodeYielder(n),this.get("yields").get(t).push({node:n,action:e})},r.prototype._setNodeOwner=function(t){return Batman._data(t,"view",this)},r.prototype._setNodeYielder=function(t){return Batman._data(t,"yielder",this)},r.prototype.on("ready",function(){return"function"==typeof this.ready?this.ready.apply(this,arguments):void 0}),r.prototype.on("appear",function(){return"function"==typeof this.viewDidAppear?this.viewDidAppear.apply(this,arguments):void 0}),r.prototype.on("disappear",function(){return"function"==typeof this.viewDidDisappear?this.viewDidDisappear.apply(this,arguments):void 0}),r.prototype.on("beforeAppear",function(){return"function"==typeof this.viewWillAppear?this.viewWillAppear.apply(this,arguments):void 0}),r.prototype.on("beforeDisappear",function(){return"function"==typeof this.viewWillDisappear?this.viewWillDisappear.apply(this,arguments):void 0}),r}.call(this,Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.RenderContext=function(){function t(t,e){this.object=t,this.parent=e}var n;return t.deProxy=function(t){return null!=t&&t.isContextProxy?t.get("proxiedObject"):t},t.root=function(){var t;return null!=Batman.currentApp&&(t=Batman.currentApp.get("_renderContext")),null!=t?t:t=this.base},t.prototype.windowWrapper={window:Batman.container},t.prototype.findKey=function(t){var e,n,r;for(e=t.split(".")[0].split("|")[0].trim(),n=this;n;){if(r=Batman.get(n.object,e),"undefined"!=typeof r)return r=Batman.get(n.object,t),[r,n.object].map(this.constructor.deProxy);n=n.parent}return[Batman.get(this.windowWrapper,t),this.windowWrapper]},t.prototype.get=function(t){return this.findKey(t)[0]},t.prototype.contextForKey=function(t){return this.findKey(t)[1]},t.prototype.descend=function(t,e){var n;return e&&(n=t,t=new Batman.Object,t[e]=n),new this.constructor(t,this)},t.prototype.descendWithDefinition=function(t){var e;return e=new n(t),this.descend(e,t.attr)},t.prototype.chain=function(){var t,e;for(e=[],t=this;t;)e.push(t.object),t=t.parent;return e},t.ContextProxy=n=function(t){function n(t){this.binding=new Batman.DOM.AbstractBinding(t)}return e(n,t),n.prototype.isContextProxy=!0,n.accessor("proxiedObject",function(){return this.binding.get("filteredValue")}),n.accessor({get:function(t){return this.get("proxiedObject."+t)},set:function(t,e){return this.set("proxiedObject."+t,e)},unset:function(t){return this.unset("proxiedObject."+t)}}),n}(Batman.Object),t}.call(this),Batman.RenderContext.base=new Batman.RenderContext(Batman.RenderContext.prototype.windowWrapper)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.DOM.Yield=t=function(t){function e(){this.cycle()}return n(e,t),e.yields={},e.queued=function(t){return function(){var e,n,o=this;return e=1<=arguments.length?r.call(arguments,0):[],null!=this.containerNode?t.apply(this,e):n=this.observe("containerNode",function(){var r;return r=t.apply(o,e),o.forget("containerNode",n),r})}},e.reset=function(){return this.yields={}},e.withName=function(t){var e;return(e=this.yields)[t]||(e[t]=new this({name:t})),this.yields[t]},e.forEach=function(t){var e,n,r;r=this.yields;for(e in r)n=r[e],t(n)},e.clearAll=function(){return this.forEach(function(t){return t.clear()})},e.cycleAll=function(){return this.forEach(function(t){return t.cycle()})},e.clearAllStale=function(){return this.forEach(function(t){return t.clearStale()})},e.prototype.cycle=function(){return this.currentVersionNodes=[]},e.prototype.clear=e.queued(function(){var t,e,n,r,o;for(this.cycle(),r=function(){var e,n,r,o;for(r=this.containerNode.childNodes,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(t);return o}.call(this),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(Batman.DOM.removeOrDestroyNode(t));return o}),e.prototype.clearStale=e.queued(function(){var t,e,n,r,o;for(r=function(){var e,n,r,o;for(r=this.containerNode.childNodes,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(t);return o}.call(this),o=[],e=0,n=r.length;n>e;e++)t=r[e],~this.currentVersionNodes.indexOf(t)||o.push(Batman.DOM.removeOrDestroyNode(t));return o}),e.prototype.append=e.queued(function(t){return this.currentVersionNodes.push(t),Batman.DOM.appendChild(this.containerNode,t,!0)}),e.prototype.replace=e.queued(function(t){return this.clear(),this.append(t)}),e}(Batman.Object)}.call(this),function(){}.call(this),function(){Batman.extend(Batman.DOM,{querySelectorAll:function(t,e){return jQuery(e,t)},querySelector:function(t,e){return jQuery(e,t)[0]},setInnerHTML:function(t,e){var n,r,o,i,a,s,u;for(r=function(){var e,r,o,i;for(o=t.childNodes,i=[],e=0,r=o.length;r>e;e++)n=o[e],i.push(n);return i}(),i=0,s=r.length;s>i;i++)n=r[i],Batman.DOM.willRemoveNode(n);for(o=jQuery(t).html(e),a=0,u=r.length;u>a;a++)n=r[a],Batman.DOM.didRemoveNode(n);return o},removeNode:function(t){var e;return Batman.DOM.willRemoveNode(t),null!=(e=t.parentNode)&&e.removeChild(t),Batman.DOM.didRemoveNode(t)},destroyNode:function(t){return Batman.DOM.willDestroyNode(t),Batman.DOM.willRemoveNode(t),jQuery(t).remove(),Batman.DOM.didRemoveNode(t),Batman.DOM.didDestroyNode(t)},appendChild:function(t,e){return Batman.DOM.willInsertNode(e),jQuery(t).append(e),Batman.DOM.didInsertNode(e)},textContent:function(t){return jQuery(t).text()}}),Batman.Request.prototype._parseResponseHeaders=function(t){var e;return e=t.getAllResponseHeaders().split("\n").reduce(function(t,e){var n,r,o;return(r=e.match(/([^:]*):\s*(.*)/))&&(n=r[1],o=r[2],t[n]=o),t},{})},Batman.Request.prototype._prepareOptions=function(t){var e,n,r=this;return e={url:this.get("url"),type:this.get("method"),dataType:this.get("type"),data:t||this.get("data"),username:this.get("username"),password:this.get("password"),headers:this.get("headers"),beforeSend:function(){return r.fire("loading")},success:function(t,e,n){return r.mixin({xhr:n,status:n.status,response:t,responseHeaders:r._parseResponseHeaders(n)}),r.fire("success",t)},error:function(t){return r.mixin({xhr:t,status:t.status,response:t.responseText,responseHeaders:r._parseResponseHeaders(t)}),t.request=r,r.fire("error",t)},complete:function(){return r.fire("loaded")}},("PUT"===(n=this.get("method"))||"POST"===n)&&(this.hasFileUploads()?(e.contentType=!1,e.processData=!1,e.data=this.constructor.objectToFormData(e.data)):(e.contentType=this.get("contentType"),"object"==typeof e.data&&(e.processData=!1,e.data=Batman.URI.queryFromParams(e.data)))),e},Batman.Request.prototype.send=function(t){return jQuery.ajax(this._prepareOptions(t))}}.call(this),function(){}.call(this);